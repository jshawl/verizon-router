var from="#/advanced";
angular.module("advanced.controllers",[]).controller("basicAdvancedCtrl",["$scope","$route","$routeParams","$location",function(a,b,c,d){a.tab=b.current.tab;a.section=b.current.section;a.warning=!1;null!=c.warn&&(a.warning=!0);a.acceptWarning=function(){d.search({});d.replace()}}]).controller("dhcpCtrl",["$scope","$route","$routeParams","DhcpSettings","NetworkConnections","$location",function(a,b,c,d,e,f){a.tab=b.current.tab;a.section=b.current.section;null!=c.from&&(from="#/"+c.from.replace(RegExp("_",
"g"),"/"));a.returnLink=from;a.dhcpSettings=d.get(function(){a.dhcpSettings.connection=e.get({id:0},function(){a.dhcpSettings.connection.displayName=unescape(a.dhcpSettings.connection.name)})});a.keyPress=function(a){13==a.keyCode&&"/advanced/dhcp"==f.path()&&window.history.back()}}]).controller("dhcpEditCtrl",["$scope","$route","$routeParams","$location","DhcpSettings","DhcpOptions","NetworkConnections",function(a,b,c,d,e,f,g){a.tab=b.current.tab;a.section=b.current.section;a.runFocus=!1;a.dhcpOptions=
f.query();a.dhcpSettings=e.get(function(){a.connection=g.get({id:0},function(){a.connection.name=unescape(a.connection.name)});a.dhcpStartIpAddress=splitIpArr(a.dhcpSettings.startIpAddress);a.dhcpEndIpAddress=splitIpArr(a.dhcpSettings.endIpAddress);var b=a.dhcpSettings.winsServer;0==b.length&&(b="0.0.0.0");a.dhcpWinsServer=splitIpArr(b)});a.errorPageOk=function(){a.showErrorPage=!1;window.scrollTo(0,0)};a.save=function(){a.dhcpSettings.mode=parseInt(a.dhcpSettings.mode);if(2==a.dhcpSettings.mode&&
(a.errorMessages=validateIPv4DhcpSettings(splitIpArr(a.connection.ipAddress),a.dhcpStartIpAddress,a.dhcpEndIpAddress,splitIpArr(a.connection.subnetMask),a.dhcpWinsServer,a.dhcpSettings.leaseTime,null,null,null,null,!0),0!=a.errorMessages.length)){a.showErrorPage=!0;window.scrollTo(0,0);return}var b=getIpString(a.dhcpWinsServer);a.dhcpSettings.winsServer="0.0.0.0"!=b&&0!=a.dhcpSettings.mode?b:"";a.dhcpSettings.startIpAddress=getIpString(a.dhcpStartIpAddress);a.dhcpSettings.endIpAddress=getIpString(a.dhcpEndIpAddress);
a.dhcpSettings.$update(function(){d.path("/advanced/dhcp")})};a.selectOpt=function(){a.runFocus=!0};a.keyPress=function(b){13==b.keyCode&&"/advanced/dhcp/edit"==d.path()&&a.save()}}]).controller("dhcpConnectionsCtrl",["$scope","$route","$location","DhcpConnections","NetworkConnections","Diagnostics","DhcpSettings","securityTips",function(a,b,c,d,e,f,g,h){a.tab=b.current.tab;a.section=b.current.section;a.showErrorPage=!1;a.adding=!1;a.showSettings=!1;a.lanIp="0.0.0.0";a.runFocus=!1;a.addStaticConnection=
function(){a.name="new-host";a.ipAddress=[0,0,0,0];a.macAddress="00 00 00 00 00 00".split(" ");a.adding=!0;a.editing=!1;a.showSettings=!0;a.useStaticIp=!0;a.runFocus=!0};a.errorPageOk=function(){a.showErrorPage=!1;window.scrollTo(0,0)};a.saveStaticConnection=function(){a.errorMessages=[];a.runFocus=!0;var b=!1;0!=a.name.length?validateHostNameDHCPConnections(a.name)||(b=!0):b=!0;b&&a.errorMessages.push("Host Name: Name may not contain spaces. Only letters, digits and the special characters dash (-), underscore (_) and dot (.) may be used. These special characters may not appear at the beginning or at the end of a name. The maximum length of a label (text between two dots) is 63.");
for(var c=getMacString(a.macAddress),e=getIpString(a.ipAddress),b=splitIpArr(a.lanIp),g=0;g<a.devices.length;g++)if((a.editIndex!=g||!a.editing)&&e===a.devices[g].ipAddress){a.errorMessages.push("IP Address: IP address already exists in Wireless Broadband Router's database.");break}"00:00:00:00:00:00"==c&&a.errorMessages.push("MAC Address: MAC address must consist of 6 fields. Each field's value must be between 00 and FF (in hexadecimal representation), without any spaces. The LSB of the first byte must be zero.");
checkMacAddress(a,a.macAddress);"0.0.0.0"==e?a.errorMessages.push("IP Address: IP address may not be 0.0.0.0. IP address must consist of 4 fields. Each field's value must be between 0 and 255, without any spaces. At least one of the values must be greater than 0."):validateIp(a.ipAddress)||a.errorMessages.push("IP Address: IP address must consist of 4 fields. Each field's value must be between 0 and 255, without any spaces.");a.lanIp==e&&a.errorMessages.push("IP Address: The IP address "+e+" conflicts with Subnet connection's IP.");
if(0==a.errorMessages.length){g=!0;if((a.ipAddress[0]&a.subnetMask[0])!=(b[0]&a.subnetMask[0])||(a.ipAddress[1]&a.subnetMask[1])!=(b[1]&a.subnetMask[1])||(a.ipAddress[2]&a.subnetMask[2])!=(b[2]&a.subnetMask[2])||(a.ipAddress[3]&a.subnetMask[3])!=(b[3]&a.subnetMask[3]))g=!1;g||a.errorMessages.push("IP Address: The IP address "+e+" is illegal for any of the connections subnets.")}0!=a.errorMessages.length||validateMac(c)||a.errorMessages.push("MAC Address: MAC address must consist of 6 fields. Each field's value must be between 00 and FF (in hexadecimal representation), without any spaces. The LSB of the first byte must be zero.");
if(0==a.errorMessages.length){for(g=0;g<a.devices.length;g++)if((!a.editing||g!=a.editIndex)&&String(a.name).toLowerCase()===String(a.devices[g].name).toLowerCase()){a.errorMessages.push("Name: Name already exists in Wireless Broadband Router's database.");a.errorMessages.push('If you are trying to make changes to the lease type on this interface, please edit the host name to make it unique (e.g. "Hostname-Ethernet" or "Hostname-WiFi")');break}for(g=0;g<a.devices.length;g++)if((!a.editing||g!=a.editIndex)&&
c===a.devices[g].mac){a.errorMessages.push("MAC Address: MAC Address already exists in Wireless Broadband Router's database.");break}}0<a.errorMessages.length?(a.showErrorPage=!0,window.scrollTo(0,0)):(a.useStaticIp&&a.showSettings&&a.ipAdd!=e&&!a.useStaticIp&&h.showMessage("DHCP Connection Update Warning","Changes to the DHCP connections table IP addresses won\u2019t take effect on the actual host table until the client device renews its DHCP lease. You can either wait until the lease expires and is renewed by the client, or you can manually renew the lease on the client."),
a.editing&&c!=a.devices[a.editIndex].mac?d.remove({clientId:a.editIndex},function(){d.save({},{name:a.name,ipAddress:e,mac:c,staticAddress:a.useStaticIp},function(){a.adding=!1;a.refresh()})}):d.save({},{name:a.name,ipAddress:e,mac:c,staticAddress:a.useStaticIp},function(){a.adding=!1;a.refresh()}))};a.doPingTest=function(b){f.save({destination:a.devices[b].ipAddress,count:4},function(){c.path("/advanced/diagnostics")})};a.editConnection=function(b){a.adding=!0;a.editing=!0;a.editIndex=b;b=a.devices[b];
a.name=b.name;a.ipAddress=splitIpArr(b.ipAddress);a.ipAdd=b.ipAddress;a.macAddress=splitMacArr(b.mac);a.macAdd=b.mac;a.useStaticIp=b.staticCheckbox;a.showSettings=b.staticCheckbox};a.cancelStaticConnection=function(){a.adding=!1;a.showSettings=!1};a.deleteConnection=function(b){d.remove({id:0,clientId:b},function(){a.refresh()})};a.refresh=function(){var b=g.get(function(){a.startAddress=splitIpArr(b.startIpAddress);a.endAddress=splitIpArr(b.endIpAddress)});a.conn=e.get({id:0},function(){a.lanIp=
a.conn.ipAddress;a.subnetMask=splitIpArr(a.conn.subnetMask);a.conn.displayName=unescape(a.conn.name)});a.devices=d.query(function(){a.devices=filterOutGuest(a.devices)})};a.keyPress=function(b){13==b.keyCode&&"/advanced/dhcp/connections"==c.path()&&(a.adding||a.showErrorPage?a.adding&&!a.showErrorPage&&a.saveStaticConnection():c.path("/advanced/dhcp"))};a.refresh()}]).controller("fwUpgradeCtrl",["$scope","$route","FirmwareUpgrade","Reboot","SystemSettings","$location","$templateCache","$timeout",
"securityTips",function(a,b,c,d,e,f,g,h,k){a.tab=b.current.tab;a.section=b.current.section;a.page=0;a.restarting=!1;a.inputfile=null;a.runFocus=!1;a.fakeTimer=null;a.fakeCount=0;a.fake_percent=0;a.$on("$destroy",function(){clearTimeout(a.fakeTimer)});a.fakeTimerFunction=function(){clearTimeout(a.fakeTimer);a.fakeCount++;60<a.fakeCount&&(a.fakeCount=0);a.fake_percent=a.fakeCount/60*100;a.fake_percent=Math.round(a.fake_percent);a.fakeTimer=window.setTimeout(a.fakeTimerFunction,1E3);a.$apply()};a.refresh=
function(){a.stats=c.get()};a.refresh();a.errorPageOk=function(){a.runFocus=!0;a.showErrorPage=!1;a.page=0;window.scrollTo(0,0)};window.uploadDone=function(){a.isFileSubmitted&&(a.stats=c.get(function(){""==a.stats.standbyVersion||null==a.stats.standbyVersion?(a.errorMessages=["Invalid Firmware"],a.showErrorPage=!0):a.page=2;window.scrollTo(0,0)}))};a.applyFirmware=function(){c.save({executeUpdate:!0});d.save(function(){window.setTimeout(a.testConnection,0)});a.page=3;a.fakeTimerFunction();window.scrollTo(0,
0)};a.cancelFirmwareUpdate=function(){a.page=0;window.scrollTo(0,0)};a.submittingFile=function(){a.isFileSubmitted=!0};a.fileUpgradePage=function(){h(function(){document.getElementById("submitting").focus()},1E3);a.inputfile=null;a.page=1;window.scrollTo(0,0)};a.testConnection=function(){e.get(function(){window.setTimeout(a.testConnection,3E3)},function(b){401==b.status?(a.restarting=!0,g.removeAll(),clearTimeout(a.fakeTimer),window.location="/redirect.html?v=v1.0.184"):window.setTimeout(a.testConnection,
3E3)})};a.chooseFile=function(){h(function(){document.getElementById("submitting").focus()},1E3)};a.setFocus=function(){h(function(){document.getElementById("submitting").focus()},500)};a.keyPress=function(b){13==b.keyCode&&"/advanced/fwupgrade"==f.path()&&0==a.page&&a.fileUpgradePage()}}]).controller("fwRestoreCtrl",["$scope","$route","FirmwareUpgrade","Reboot","SystemSettings","$location","$templateCache","securityTips",function(a,b,c,d,e,f,g,h){a.tab=b.current.tab;a.section=b.current.section;a.valid=
!1;a.restarting=!1;a.stats=c.get(function(){a.valid=""!==a.stats.restoreVersion});a.apply=function(){c.save({executeRestore:!0});d.save(function(){window.setTimeout(a.testConnection,0)});a.page=3};a.testConnection=function(){e.get(function(){window.setTimeout(a.testConnection,3E3)},function(b){401==b.status?(a.restarting=!0,g.removeAll(),window.location="/redirect.html?v=v1.0.184"):window.setTimeout(a.testConnection,3E3)})}}]).controller("localAdminCtrl",["$scope","$route","$location","LocalAdmin",
"SystemSettings",function(a,b,c,d,e){a.tab=b.current.tab;a.section=b.current.section;a.sysSettings=e.get();a.locAdmin=d.get();a.save=function(){a.locAdmin.$update(function(){c.path("/advanced")})};a.keyPress=function(b){13==b.keyCode&&"/advanced/localadmin"==c.path()&&a.save()}}]).controller("remoteAdminCtrl",["$scope","$route","$routeParams","$location","RemoteAdmin","SystemSettings",function(a,b,c,d,e,f){a.tab=b.current.tab;a.section=b.current.section;a.sysSettings=f.get();a.remAdmin=e.get();a.fromString=
"?from=ad";b="";a.prev="";a.back="/advanced";a.comingFrom="";if(null!=c.from){a.comingFrom=c.from;a.fromString="?from="+c.from+"-ad";a.back="/advanced/settings";c=c.from.split("-");for(e=0;e<c.length-1;e++)0!=e&&(b+="-"),b+=c[e];""!==b&&(a.prev="?from="+b)}else a.back="/advanced";a.save=function(){a.remAdmin.$update(function(){""==a.oldFrom?d.path(a.back).search({}):"settings"==a.comingFrom?location.reload():d.path(a.back).search({from:a.oldFrom})})};a.keyPress=function(b){13==b.keyCode&&"/advanced/remoteadmin"==
d.path()&&a.save()}}]).controller("systemSettingsCtrl",["$scope","$route","$routeParams","$location","SystemSettings","securityTips",function(a,b,c,d,e,f){a.tab=b.current.tab;a.section=b.current.section;a.showErrorPage=!1;a.fromString="?from=settings";a.oldFrom="";a.prev="";a.oldDomainName="";if(null!=c.from){a.fromString="?from="+c.from+"-settings";b=c.from.split("-");"fw"==b[b.length-1]?a.back="/firewall/remoteadmin":"ad"==b[b.length-1]&&(a.back="/advanced/remoteadmin");for(c=0;c<b.length-1;c++)0!=
c&&(a.oldFrom+="-"),a.oldFrom+=b[c];""!==a.oldFrom&&(a.prev="?from="+a.oldFrom)}else a.back="/advanced";a.sysSettings=e.get(function(){a.systemIpAddress=splitIpArr(a.sysSettings.systemRemoteHost);a.securityIpAddress=splitIpArr(a.sysSettings.securityRemoteHost);a.oldDomainName=a.sysSettings.localDomain});a.errorPageOk=function(){a.showErrorPage=!1;window.scrollTo(0,0)};a.save=function(){a.errorMessages=[];validateLocalDomains(a.sysSettings.localDomain)||a.errorMessages.push("Domain Name: Name may not contain spaces. Only letters, digits and the special characters dash (-), underscore (_) and dot (.) may be used. These special characters may not appear at the beginning or at the end of a name. The maximum length of a label (text between two dots) is 63");
/^[a-z0-9]$|^[a-z0-9][a-z0-9\-\_]{0,}[a-z0-9]$/i.test(a.sysSettings.routerHostname)||a.errorMessages.push("Wireless Broadband Router's Hostname: Host name may contain only letters, digits and the special characters dash (-) and underscore (_), without any spaces. The special characters cannot appear at the beginning or the end of the name.");(isNaN(a.sysSettings.sessionLifetime)||60>a.sysSettings.sessionLifetime||7200<a.sysSettings.sessionLifetime)&&a.errorMessages.push("Session Lifetime: Please enter a numeric value between 60 and 7200.");
for(var b=[{title:"Primary HTTPS Management Port",port:parseInt(a.sysSettings.primaryHttpsPort)},{title:"Secondary HTTPS Management Port",port:parseInt(a.sysSettings.secondaryHttpsPort)},{title:"Primary ssh Port",port:parseInt(a.sysSettings.primarySshPort)},{title:"Secondary ssh Port",port:parseInt(a.sysSettings.secondarySshPort)}],c=0;c<b.length;c++)(isNaN(b[c].port)||1>b[c].port||65535<b[c].port)&&a.errorMessages.push(b[c].title+": Please enter a numeric value between 1 and 65535.");if(0==a.errorMessages.length)for(c=
0;c<b.length;c++)for(var d=c+1;d<b.length;d++)b[c].port==b[d].port&&a.errorMessages.push("Remote Administration: Port "+b[c].port+' cannot be used for both "'+b[c].title+'" and "'+b[d].title+'".');0==a.sysSettings.systemRemoteNotifyLevel||validateIp(a.systemIpAddress)?0!=a.sysSettings.systemRemoteNotifyLevel&&"0.0.0.0"===getIpString(a.systemIpAddress)&&a.errorMessages.push("Remote System Host IP Address: IP address may not be 0.0.0.0. IP address must consist of 4 fields. Each field's value must be between 0 and 255, without any spaces. At least one of the values must be greater than 0."):
a.errorMessages.push("Remote System Host IP Address: IP address must consist of 4 fields. Each field's value must be between 0 and 255, without any spaces.");0==a.sysSettings.securityRemoteNotifyLevel||validateIp(a.securityIpAddress)?0!=a.sysSettings.securityRemoteNotifyLevel&&"0.0.0.0"===getIpString(a.securityIpAddress)&&a.errorMessages.push("Remote Security Host IP Address: IP address may not be 0.0.0.0. IP address must consist of 4 fields. Each field's value must be between 0 and 255, without any spaces. At least one of the values must be greater than 0."):
a.errorMessages.push("Remote Security Host IP Address: IP address must consist of 4 fields. Each field's value must be between 0 and 255, without any spaces.");b=!/^[0-9]+$/.test(a.sysSettings.autoWanDhcpTimeout);c=parseInt(a.sysSettings.autoWanDhcpTimeout);(""===c||isNaN(c)||0>c||b)&&a.errorMessages.push("DHCP Timeout: Please enter a numeric value between 0 and 4294967295.");0<a.errorMessages.length?(a.showErrorPage=!0,window.scrollTo(0,0)):(a.sysSettings.autoWanDhcpTimeout=parseInt(a.sysSettings.autoWanDhcpTimeout),
a.sysSettings.concurrentUsers=parseInt(a.sysSettings.concurrentUsers),a.sysSettings.securityRemoteNotifyLevel=parseInt(a.sysSettings.securityRemoteNotifyLevel),a.sysSettings.systemRemoteNotifyLevel=parseInt(a.sysSettings.systemRemoteNotifyLevel),0!=a.sysSettings.systemRemoteNotifyLevel&&(a.sysSettings.systemRemoteHost=getIpString(a.systemIpAddress)),0!=a.sysSettings.securityRemoteNotifyLevel&&(a.sysSettings.securityRemoteHost=getIpString(a.securityIpAddress)),a.sysSettings.$update(function(){systemSettings=
a.sysSettings;a.oldDomainName==a.sysSettings.localDomain?a.redirect():f.showCustomMessage3("Warning",["You have changed the gateway's Local Domain Name. It may take several minutes for all of the clients on your network to be updated with the new domain name, and during that time they may not be able to communicate with each other by hostname.","If you desire immediate resolution, you can perform an ip address release and renew on each of your networked client devices or restart them."]).then(function(b){"ok"!=
b&&void 0!=b||a.redirect()})}))};a.redirect=function(){""==a.oldFrom?d.path(a.back).search({}):d.path(a.back).search({from:a.oldFrom})};a.systemLowCapacityChanged=function(){a.sysSettings.systemLowCapacityNotificationEnabled||(a.sysSettings.securityLowCapacityNotificationEnabled=!0)};a.securityLowCapacityChanged=function(){a.sysSettings.securityLowCapacityNotificationEnabled||(a.sysSettings.systemLowCapacityNotificationEnabled=!0)};a.keyPress=function(b){13==b.keyCode&&"/advanced/settings"==d.path()&&
a.save()}}]).controller("dateTimeCtrl",["$scope","$route","$routeParams","$location","DateTimeSettings",function(a,b,c,d,e){a.tab=b.current.tab;a.section=b.current.section;var f=function(){a.dateTimeSettings=e.get(function(){a.checkTime();a.checkTempDateObj();for(var b=0;b<a.dateTimeSettings.servers.length;b++){var c={};c.name=a.dateTimeSettings.servers[b];c.id=b;a.dateTimeSettings.servers[b]=c}a.timezone=parseInt(a.dateTimeSettings.timeZone)})};f();a.pageToShow=0;a.serverName="Name";a.showErrorPage=
!1;a.tempDateObj=null;a.errorPageOk=function(){a.showErrorPage=!1;window.scrollTo(0,0)};a.syncNow=function(){};a.refresh=function(){void 0!=window?window.location.reload(!0):location.reload(!0)};a.togglePage=function(b){a.pageToShow=b;window.scrollTo(0,0)};a.save=function(){for(var b=0;b<a.dateTimeSettings.servers.length;b++)a.dateTimeSettings.servers[b].hasOwnProperty("name")&&(a.dateTimeSettings.servers[b]=a.dateTimeSettings.servers[b].name);a.dateTimeSettings.timeZone=parseInt(a.dateTimeSettings.timeZone);
b={autoTimeUpdate:a.dateTimeSettings.autoTimeUpdate,localTime:a.dateTimeSettings.localTime,timeZone:parseInt(a.dateTimeSettings.timeZone),offset:parseInt(a.dateTimeSettings.offset),servers:a.dateTimeSettings.servers};e.update(b,function(){a.dateTimeSettings=e.get(function(){for(var b=0;b<a.dateTimeSettings.servers.length;b++){var c={};c.name=a.dateTimeSettings.servers[b];c.id=b;a.dateTimeSettings.servers[b]=c}})})};a.offsetToZone=function(){var b=a.offset/60;0==b?a.dateTimeSettings.timeZone=0:-5>=
b&&-10<=b&&(a.dateTimeSettings.timeZone=b)};a.checkTime=function(){null!=c.tz&&(a.dateTimeSettings.timeZone=c.tz);a.offset=0;a.localTimeMoment=findTimeNow(a.dateTimeSettings);a.localTimeFormatted=a.localTimeMoment.format("MMM DD, YYYY HH:mm:ss")};a.checkTempDateObj=function(){null!=c.tmplocalTime&&(a.tempDateObj={localTime:c.tmplocalTime},a.tempDateObj.timeZone=a.dateTimeSettings.timeZone,a.dateTimeSettings.autoTimeUpdate=!1,a.localTimeMoment=findTimeNow(a.tempDateObj),a.localTimeFormatted=a.localTimeMoment.format("MMM DD, YYYY HH:mm:ss"),
a.tempDateObj.month=a.localTimeMoment.month(),a.tempDateObj.day=a.localTimeMoment.date(),a.tempDateObj.year=a.localTimeMoment.year(),a.tempDateObj.hours=a.localTimeMoment.hour(),a.tempDateObj.minutes=a.localTimeMoment.minute(),a.tempDateObj.seconds=a.localTimeMoment.second())};a.checkTempObj=function(){a.dateTimeSettings.autoTimeUpdate&&(a.tempDateObj=null)};a.setTimeZone=function(){null==a.tempDateObj?d.path("/advanced/datetime").search({tz:a.dateTimeSettings.timeZone}):d.path("/advanced/datetime").search({tz:a.dateTimeSettings.timeZone,
tmplocalTime:a.tempDateObj.localTime});d.replace();a.checkTime();a.checkTempDateObj()};a.setClock=function(){null==a.tempDateObj&&(a.tempDateObj={month:a.localTimeMoment.month(),day:a.localTimeMoment.date(),year:a.localTimeMoment.year(),hours:a.localTimeMoment.hour(),minutes:a.localTimeMoment.minute(),seconds:a.localTimeMoment.second(),timeZone:a.dateTimeSettings.timeZone});10>a.tempDateObj.hours&&2>a.tempDateObj.hours.toString().length&&(a.tempDateObj.hours="0"+a.tempDateObj.hours);10>a.tempDateObj.minutes&&
2>a.tempDateObj.minutes.toString().length&&(a.tempDateObj.minutes="0"+a.tempDateObj.minutes);10>a.tempDateObj.seconds&&2>a.tempDateObj.seconds.toString().length&&(a.tempDateObj.seconds="0"+a.tempDateObj.seconds);a.togglePage(2)};a.calDate=function(){var b=a.tempDateObj.hours,c=a.tempDateObj.minutes,d=a.tempDateObj.year+"-"+(parseInt(a.tempDateObj.month)+1)+"-"+a.tempDateObj.day+"-"+a.tempDateObj.hours+"-"+a.tempDateObj.minutes+"-"+a.tempDateObj.seconds,e=-11==a.tempDateObj.timeZone?-7:a.tempDateObj.timeZone,
d=moment.unix(moment.utc(moment(d,"YYYY-MM-DD-HH-mm-ss")).unix()-60*(new Date).getTimezoneOffset()-3600*e),f={};f.localTime=d.unix();f.timeZone=a.tempDateObj.timeZone;var f=findTimeNow(f),e=f.format("HH"),f=f.format("mm"),m=!1,n=0,m=0;if(m=Number(e)==Number(b)&&Number(f)==Number(c)?!1:!0)m=4>b&&20<e?Number(b)-Number(e-24):20<b&&4>e?Number(b-24)-Number(e):Number(b)-Number(e),0!=m&&(n=3600*m),m=Number(c)-Number(f),0!=m&&(n+=60*m);a.tempDateObj.localTime=d.unix()+n;a.localTimeMoment=findTimeNow(a.tempDateObj);
a.localTimeFormatted=a.localTimeMoment.format("MMM DD, YYYY HH:mm:ss")};a.applySetClock=function(){a.errorMessages=[];var b=a.tempDateObj.hours,c=a.tempDateObj.minutes,d=a.tempDateObj.seconds,f=moment(a.tempDateObj.year+"-"+(parseInt(a.tempDateObj.month)+1)+"-"+a.tempDateObj.day,"YYYY-MM-DD");(""===b||isNaN(b)||0>b||23<b||!checksForWholeNumber(b))&&a.errorMessages.push("Hours: Please enter a numeric value between 0 and 23.");(""===c||isNaN(c)||0>c||59<c||!checksForWholeNumber(c))&&a.errorMessages.push("Minutes: Please enter a numeric value between 0 and 59.");
(""===d||isNaN(d)||0>d||59<d||!checksForWholeNumber(d))&&a.errorMessages.push("Seconds: Please enter a numeric value between 0 and 59.");f.isValid()||a.errorMessages.push("Local Date and Time:  Entered time or date value are incorrect.");0<a.errorMessages.length?(a.showErrorPage=!0,window.scrollTo(0,0)):(a.calDate(),e.update({localTime:a.tempDateObj.localTime},function(){a.dateTimeSettings.localTime=a.tempDateObj.localTime;a.togglePage(0)}))};a.cancelSetClock=function(){a.tempDateObj=null;a.togglePage(0)};
a.saveServer=function(){a.errorMessages=[];a.showError=!1;validateIpDomainDatetime(a.serverName)||isAddressValidIPPattern(a.serverName)||(a.showError=!0);if(a.showError)a.errorMessages.push("Server Address: The value must be a valid IP address or a valid domain name."),a.showErrorPage=!0,window.scrollTo(0,0);else{for(var b=0;b<a.dateTimeSettings.servers.length;b++)a.dateTimeSettings.servers[b]=a.dateTimeSettings.servers[b].name;-1==a.editing?a.dateTimeSettings.servers.push(a.serverName):a.dateTimeSettings.servers[a.editing]=
a.serverName;e.update({autoTimeUpdate:a.dateTimeSettings.autoTimeUpdate,servers:a.dateTimeSettings.servers},function(){f()});a.togglePage(0)}};a.addServer=function(){a.serverName="";a.editing=-1;a.togglePage(1);window.scrollTo(0,0)};a.editServer=function(b){a.serverName=a.dateTimeSettings.servers[b].name;a.editing=b;a.togglePage(1);window.scrollTo(0,0)};a.removeServer=function(b){for(var c=0;c<a.dateTimeSettings.servers.length;c++)a.dateTimeSettings.servers[c]=a.dateTimeSettings.servers[c].name;a.dateTimeSettings.servers.splice(b,
1);e.update({autoTimeUpdate:a.dateTimeSettings.autoTimeUpdate,servers:a.dateTimeSettings.servers},function(){f()})};a.keyPress=function(b){13==b.keyCode&&"/advanced/datetime"==d.path()&&(0!=a.pageToShow||a.showErrorPage?1!=a.pageToShow||a.showErrorPage||a.saveServer():a.save())}}]).controller("configFileCtrl",["$scope","$route","$location","ConfigInfo","Reboot","Login","SystemSettings","$templateCache","$timeout","securityTips",function(a,b,c,d,e,f,g,h,k,l){a.tab=b.current.tab;a.section=b.current.section;
a.loadFile=!1;a.completed=!1;a.showErrorPage=!1;a.inputFile=null;a.restarting=!1;a.isFileSubmitted=!1;window.uploadDone=function(){if(a.isFileSubmitted&&a.loadFile)var b=d.get(function(){b.successful?(e.save(function(){window.setTimeout(a.testConnection,0)}),a.completed=!0):(a.errorMessages=["Configuration File: Bad format of configuration file."],a.showErrorPage=!0)})};a.testConnection=function(){g.get(function(){window.setTimeout(a.testConnection,3E3)},function(b){401==b.status?(a.restarting=!0,
h.removeAll(),window.location="/redirect.html?v=v1.0.184"):window.setTimeout(a.testConnection,3E3)})};a.toggleShow=function(b){k(function(){document.getElementById("submitting").focus()},1E3);a.loadFile=!a.loadFile;0==b&&(a.inputFile=null)};a.errorPageOk=function(){a.showErrorPage=!1;a.loadFile=!1;a.completed=!1;a.isFileSubmitted=!1;window.scrollTo(0,0)};a.submittingFile=function(){a.isFileSubmitted=!0;document.getElementById("submitForm").submit()};a.saving=function(){f.get(function(a){window.location=
"/api/settings/configfile"})};a.loadConfig=function(){document.getElementById("submitting").focus()};a.setFocus=function(){k(function(){document.getElementById("submitting").focus()},500)};a.keyPress=function(b){13==b.keyCode&&"/advanced/configfile"==c.path()&&(a.loadFile||c.path("/advanced"))}}]).controller("diagnosticsCtrl",["$scope","$route","$rootScope","Diagnostics","$location",function(a,b,c,d,e){a.tab=b.current.tab;a.section=b.current.section;a.destination="";a.pingCount=4;a.showErrorPage=
!1;a.previousPath=c.pre_path;-1!=String(c.pre_path).indexOf("login")?a.previousPath="/advanced":-1!=String(c.pre_path).indexOf("diagnostics")&&(a.previousPath="/advanced");a.isCancelled=!1;a.errorPageOk=function(){a.showErrorPage=!1;window.scrollTo(0,0)};a.refresh=function(){var b=d.get(function(){a.destination=b.destination;a.pingCount=b.count;a.total=b.count;a.status=b.running?1:0;a.testRan=!0;null==b.transmitted?b.running?window.setTimeout(a.refresh,1E3):a.testRan=!1:(a.sent=b.transmitted,a.received=
b.received,0==a.received&&0==a.sent&&0==a.status&&(a.status=""==b.destination?-1:5),0==a.status&&a.sent!=a.total&&(a.status=4),0==a.status&&a.sent==a.total&&a.received!=a.sent&&(a.status=2),a.loss=0<a.sent?Math.floor((a.sent-a.received)/a.sent*100):0,a.isCancelled&&(a.status=4),0<a.received?(a.min=b.min.toFixed(2),a.max=b.max.toFixed(2),a.average=b.average.toFixed(2),a.hasResults=!0):a.hasResults=!1,1==a.status&&b.transmitted!=b.count&&window.setTimeout(a.refresh,1E3))})};a.goButton=function(){a.isCancelled=
!1;a.errorMessages=[];var b=a.destination.split("."),c=!1;(c=validateIp(b))||(c=validateIPv6(a.destination));b=validateGivenHostName(a.destination);c||b||a.errorMessages.push("Destination: The value must be a valid IP address or a valid domain name.");(isNaN(a.pingCount)||1>a.pingCount||999<a.pingCount)&&a.errorMessages.push("Number of pings: Please enter a numeric value between 1 and 999.");0<a.errorMessages.length?(a.showErrorPage=!0,window.scrollTo(0,0)):(a.status=-1,a.total=4,a.sent=0,a.received=
0,a.loss=0,a.hasResults=!1,d.save({destination:a.destination,count:parseInt(a.pingCount)},function(){a.status=-1;a.refresh()}))};a.cancel=function(){a.isCancelled=!0;d.remove({})};a.keyPress=function(b){13==b.keyCode&&"/advanced/diagnostics"==e.path()&&a.goButton()};a.refresh()}]).controller("defaultsCtrl",["$scope","$route","Defaults","Login","Reboot","SystemSettings","$location","$templateCache","securityTips",function(a,b,c,d,e,f,g,h,k){a.tab=b.current.tab;a.section=b.current.section;a.restDefaults=
0;a.resetType=0;a.restarting=!1;a.defaults=function(){a.restDefaults=1};a.cancel=function(){a.restDefaults=0};a.restoreDefaults=function(){a.restDefaults=2;c.save({resetType:parseInt(a.resetType)},function(){e.save(function(){window.setTimeout(a.testConnection,0)})})};a.saving=function(){d.get(function(a){window.location="/api/settings/configfile"})};a.testConnection=function(){f.get(function(){window.setTimeout(a.testConnection,3E3)},function(b){401==b.status?(a.restarting=!0,h.removeAll(),window.location=
0==a.resetType?"/redirectSetup.html?v=v1.0.184":"/redirect.html?v=v1.0.184"):window.setTimeout(a.testConnection,3E3)})}}]).controller("rebootCtrl",["$scope","$route","Reboot","SystemSettings","Login","$location","$templateCache","securityTips",function(a,b,c,d,e,f,g,h){a.tab=b.current.tab;a.section=b.current.section;a.sysSettings=d.get();a.rebooting=!1;a.restarting=!1;a.reboot=function(){a.rebooting=!0;c.save(function(){window.setTimeout(a.testConnection,0)})};a.testConnection=function(){d.get(function(){window.setTimeout(a.testConnection,
3E3)},function(b){401==b.status?(a.restarting=!0,g.removeAll(),window.location="/redirect.html?v=v1.0.184"):window.setTimeout(a.testConnection,3E3)})};a.keyPress=function(b){13==b.keyCode&&"/advanced/reboot"==f.path()&&a.reboot()}}]).controller("macCloningCtrl",["$scope","$route","$location","MacCloning",function(a,b,c,d){a.tab=b.current.tab;a.section=b.current.section;a.showErrorPage=!1;a.macCloning=d.get(function(){a.macAddress=splitMacArr(a.macCloning.mac)});a.errorPageOk=function(){a.showErrorPage=
!1;window.scrollTo(0,0)};a.save=function(){a.errorMessages=[];a.macCloning.mac=getMacString(a.macAddress);if(!validateMac(a.macCloning.mac))a.errorMessages=["MAC Address: MAC address must consist of 6 fields. Each field's value must be between 00 and FF (in hexadecimal representation), without any spaces. The LSB of the first byte must be zero."];else if(/[f\:]{17}$/i.test(a.macCloning.mac))a.errorMessages.push("MAC Address: MAC FF:FF:FF:FF:FF:FF is reserved for broadcast.");else if(!validateMac(a.macCloning.mac)||
/[0\:]{17}$/i.test(a.macCloning.mac)||1==(parseInt(a.macAddress[0],16)&1))a.errorMessages=["MAC Address: MAC address must consist of 6 fields. Each field's value must be between 00 and FF (in hexadecimal representation), without any spaces. The LSB of the first byte must be zero."];0<a.errorMessages.length?(a.showErrorPage=!0,window.scrollTo(0,0)):a.macCloning.$update(function(){c.path("/advanced")})};a.restore=function(){a.macAddress=splitMacArr(a.macCloning.defaultMac)};a.keyPress=function(b){13==
b.keyCode&&"/advanced/maccloning"==c.path()&&a.save()}}]).controller("usersCtrl",["$scope","$route","$routeParams","$location","Users","SystemSettings",function(a,b,c,d,e,f){a.tab=b.current.tab;a.section=b.current.section;a.sysSettings=f.get();a.updateContent=function(){a.userObj=e.get(function(){a.user=a.userObj.users[0];a.userObj.users[0].fullName=unescape(a.userObj.users[0].fullName);null!=c.edit&&a.edit(0)})};a.updateContent();a.pageToShow=0;a.editing=-1;a.showErrorPage=!1;a.setPassword=!1;a.showPassword=
!1;a.userObjs=null;a.newPass=!1;a.errorPageOk=function(){a.showErrorPage=!1;window.scrollTo(0,0)};a.save=function(){a.errorMessages=[];var b=Number(a.userObj.maxLoginAttempts);(isNaN(b)||1>b||99<b)&&a.errorMessages.push("Maximum Unsuccessful Login Attempts: Please enter a numeric value between 1 and 99.");0<a.errorMessages.length?(a.showErrorPage=!0,window.scrollTo(0,0)):e.update({maxLoginAttempts:b},function(){void 0!=window?window.location.reload(!0):location.reload(!0)})};a.togglePage=function(b){0==
b?null!=c.frommain?d.url(d.path("/main")):(a.pageToShow=b,a.updateContent()):a.pageToShow=b;window.scrollTo(0,0)};a.edit=function(b){a.newName=a.userObj.users[0].fullName;a.newPassword="";a.rtNewPassword="";a.setPassword=!1;a.editing=b;a.togglePage(1)};a.saveUserCfm=function(){e.update({users:[a.userObjs]},function(){a.userObj.users[0].fullName=unescape(a.userObj.users[0].fullName);a.newPass?d.path("/logout"):a.togglePage(0)})};a.saveUser=function(){a.userObjs={id:0};a.errorMessages=[];""==a.newName&&
a.errorMessages.push("Full Name: A string must be specified.");a.newPass=!1;a.setPassword&&(0==a.newPassword.length&&0==a.rtNewPassword.length&&a.errorMessages.push("New Password: A password must be specified."),a.newPassword!=a.rtNewPassword&&a.errorMessages.push("Incorrect New Password: Entered passwords mismatch."),0==a.errorMessages.length&&(a.user.password=a.newPassword),a.userObjs.salt=uuid(),a.userObjs.password=CryptoJS.SHA512(a.newPassword+a.userObjs.salt).toString(),a.newPass=!0);0<a.errorMessages.length?
(a.showErrorPage=!0,window.scrollTo(0,0)):(a.userObjs.fullName=escape(a.newName).replace(/\+/g,"%2B"),a.newPass?!0==a.sysSettings.warnBeforeChanges?a.togglePage(2):a.saveUserCfm():a.saveUserCfm())};a.keyPress=function(b){13==b.keyCode&&"/advanced/users"==d.path()&&(1!=a.pageToShow||a.showErrorPage?a.save():a.saveUser())}}]).controller("schedulerCtrl",["$scope","$route","Schedules","DateTimeSettings","$location","AccessControl","PortForward",function(a,b,c,d,e,f,g){a.tab=b.current.tab;a.section=b.current.section;
a.runFocus=!1;init_schedules(a);a.pageToShow=0;a.editing=!1;a.showErrorPage=!1;a.errorPageOk=function(){a.showErrorPage=!1;window.scrollTo(0,0)};a.save=function(){a.schedules.$update(function(){void 0!=window?window.location.reload(!0):location.reload(!0)})};a.refresh=function(){a.schedules=c.query(function(){for(var b=0;b<a.schedules.length;b++)a.schedules[b].name=unescape(a.schedules[b].name);a.printSchedArr=[];printSchedule(0,a.schedules,a.printSchedArr);a.dateTimeSettings=d.get(function(){a.localTimeMoment=
findTimeNow(a.dateTimeSettings);for(var b=0;b<a.schedules.length;b++)a.schedules[b].status=isScheduleActive(a.schedules[b],a.localTimeMoment)})})};a.refresh();a.togglePage=function(b){a.pageToShow=b;window.scrollTo(0,0)};a.removeSchedule=function(b){var c=!1;a.toDeleteIndex=b;a.portForward=g.query(function(){a.accessControl=f.query(function(){for(var b=0;b<a.accessControl.length;b++)if(null!=a.accessControl[b].schedule&&unescape(a.accessControl[b].schedule.name)==a.schedules[a.toDeleteIndex].name){c=
!0;break}for(b=0;b<a.portForward.length;b++)if(null!=a.portForward[b].schedule&&unescape(a.portForward[b].schedule)==a.schedules[a.toDeleteIndex].name){c=!0;break}c?a.togglePage(8):a.removeScheduleNow(a.toDeleteIndex)})})};a.updateAccessControlBeforeRemove=function(){var b=!0;a.portForward=g.query(function(){a.accessControl=f.query(function(){for(var c=0;c<a.accessControl.length;c++)if(null!=a.accessControl[c].schedule&&unescape(a.accessControl[c].schedule.name)==a.schedules[a.toDeleteIndex].name){a.accessControl[c].schedule=
"";a.accessControl[c].schedule1={};f.update({id:a.accessControl[c].id},a.accessControl[c],function(){a.updateAccessControlBeforeRemove()});b=!1;break}if(b)for(c=0;c<a.portForward.length;c++)if(null!=a.portForward[c].schedule&&unescape(a.portForward[c].schedule)==a.schedules[a.toDeleteIndex].name){a.portForward[c].schedule="Always";g.remove({id:a.portForward[c].id},function(){a.portForward[c].id="";g.save(a.portForward[c],function(){a.updateAccessControlBeforeRemove()})});b=!1;break}b&&a.removeScheduleNow(a.toDeleteIndex)})})};
a.removeScheduleNow=function(b){c.remove({id:a.schedules[b].id},function(){a.togglePage(0);a.refresh()})};a.applyRuleScheduler=function(){a.errorMessages=[];""===a.schedule.name&&a.errorMessages.push("Description: A string must be specified.");for(var b=0;b<a.schedules.length;b++)if(b!=a.editingRuleSchedule&&a.schedules[b].name==a.schedule.name){a.errorMessages.push("Name: This name is already used by another scheduler rule.");break}0==a.schedule.timeSegments.length&&a.errorMessages.push("Rule Schedule: At least one time segment should be defined.");
if(0<a.errorMessages.length)a.showErrorPage=!0,window.scrollTo(0,0);else{var d={};copySchedule(d,a.schedule);for(b=0;b<d.timeSegments.length;b++)for(var e=0;e<d.timeSegments[b].hourRanges.length;e++)d.timeSegments[b].hourRanges[e].startTimeHour=parseInt(d.timeSegments[b].hourRanges[e].startTimeHour),d.timeSegments[b].hourRanges[e].startTimeMinute=parseInt(d.timeSegments[b].hourRanges[e].startTimeMinute),d.timeSegments[b].hourRanges[e].endTimeHour=parseInt(d.timeSegments[b].hourRanges[e].endTimeHour),
d.timeSegments[b].hourRanges[e].endTimeMinute=parseInt(d.timeSegments[b].hourRanges[e].endTimeMinute);d.name=escape(a.schedule.name).replace(/\+/g,"%2B");-1==a.editingRuleSchedule?c.save(d,function(){a.refresh()}):(d.id=a.schedules[a.editingRuleSchedule].id,c.update(d,function(){a.refresh()}));a.togglePage(0);init_schedules(a)}};a.formatTimeString=function(a,b){return(10>a?"0"+a:a)+":"+(10>b?"0"+b:b)};a.applyTimeSegment=function(){a.errorMessages=[];for(var b=!1,c=0;c<a.daysOfTheWeek.length;c++)a.daysOfTheWeek[c]&&
(b=!0);b||a.errorMessages.push("Days of Week: At least one day must be selected.");0==a.hourRanges.length&&a.errorMessages.push("Hours Range: At least one hour range must be set.");0<a.errorMessages.length?a.showErrorPage=!0:applyTimeSegment(a);window.scrollTo(0,0)};a.applyHourRange=function(){a.runFocus=!0;a.errorMessages=[];var b=a.hourRange.startTimeHour,c=a.hourRange.endTimeHour,d=a.hourRange.startTimeMinute,e=a.hourRange.endTimeMinute;(""===b||isNaN(b)||0>b||23<b||!checksForWholeNumber(b))&&
a.errorMessages.push("Start Time Hour: Please enter a numeric value between 0 and 23.");(""===c||isNaN(c)||0>c||23<c||!checksForWholeNumber(c))&&a.errorMessages.push("End Time Hour: Please enter a numeric value between 0 and 23.");(""===d||isNaN(d)||0>d||59<d||!checksForWholeNumber(d))&&a.errorMessages.push("Start Time Minutes: Please enter a numeric value between 0 and 59.");(""===e||isNaN(e)||0>e||59<e||!checksForWholeNumber(e))&&a.errorMessages.push("End Time Minutes: Please enter a numeric value between 0 and 59.");
0<a.errorMessages.length?(a.showErrorPage=!0,window.scrollTo(0,0)):(a.hourRange.startTimeHour=parseInt(a.hourRange.startTimeHour),a.hourRange.startTimeMinute=parseInt(a.hourRange.startTimeMinute),a.hourRange.endTimeHour=parseInt(a.hourRange.endTimeHour),a.hourRange.endTimeMinute=parseInt(a.hourRange.endTimeMinute),applyHourRange(a))};a.cancelRuleScheduler=function(){cancelRuleScheduler(a)};a.cancelTimeSegment=function(){cancelTimeSegment(a)};a.cancelHourRange=function(){cancelHourRange(a)};a.editSchedule=
function(b){editRuleScheduler(a,a.schedules,b)};a.editTimeSegment=function(b){editTimeSegment(a,b)};a.editHourRange=function(b){editHourRange(a,b)};a.removeTimeSegment=function(b){removeObject(a.schedule.timeSegments,b)};a.removeHourRange=function(b){removeObject(a.hourRanges,b)};a.keyPress=function(b){13==b.keyCode&&"/advanced/scheduler"==e.path()&&(0==a.pageToShow?e.path("/advanced"):5!=a.pageToShow||a.showErrorPage?6!=a.pageToShow||a.showErrorPage?7!=a.pageToShow||a.showErrorPage||a.applyHourRange():
a.applyTimeSegment():a.applyRuleScheduler())}}]).controller("networkObjectCtrl",["$scope","$route","NetworkObjects","Devices","$location","AccessControl",function(a,b,c,d,e,f){a.tab=b.current.tab;a.section=b.current.section;a.runFocus=!1;a.networkObjects=c.query(function(){for(var b=0;b<a.networkObjects.length;b++)a.networkObjects[b].name=unescape(a.networkObjects[b].name);a.printAddArr=[];printAddresses(1,a.networkObjects,a.printAddArr)});init_networkObjs(a);a.pageToShow=0;a.editing=-1;a.errorPageOk=
function(){a.showErrorPage=!1;window.scrollTo(0,0)};a.togglePage=function(b){a.pageToShow=b};a.addNetworkObject=function(){init_networkObjs(a);a.togglePage(1);a.editing=-1};a.loadDeviceData=function(b){a.devices=d.query();a.macSelect=-1;a.togglePage(2)};a.copyMacAddress=function(){var b=macSelecter.value;a.rule.mac=-1!=b?splitMacArr(a.devices[b].mac):splitMacArr("00:00:00:00:00:00");a.rule.macMask=splitMacArr("ff:ff:ff:ff:ff:ff")};a.applyNetworkObj=function(){a.errorMessages=[];if(""===a.networkObj.name)a.errorMessages.push("Description: A string must be specified.");
else for(var b=0;b<a.networkObjects.length;b++)a.editingNetworkObj!=b&&a.networkObj.name===a.networkObjects[b].name&&a.errorMessages.push("Description: This name is already used by another network object.");0==a.networkObj.rules.length&&a.errorMessages.push("Items: At least one item entry must be defined.");0<a.errorMessages.length?(a.showErrorPage=!0,window.scrollTo(0,0)):(b={},copyNetworkObj(b,a.networkObj),a.networkObj.name=escape(a.networkObj.name),-1==a.editingNetworkObj?c.save(b,function(){a.networkObjects=
c.query(function(){a.printAddArr=[];printAddresses(1,a.networkObjects,a.printAddArr)})}):c.update({id:a.networkObjects[a.editing].id},b,function(){a.networkObjects=c.query(function(){a.printAddArr=[];printAddresses(1,a.networkObjects,a.printAddArr)})}),a.togglePage(0),init_schedules(a))};a.applyAddress=function(){a.runFocus=!0;applyAddressCheck(a);0==a.errorMessages&&applyAddress(a)};a.cancelNetworkObj=function(){cancelNetworkObj(a);a.editing=-1};a.cancelAddress=function(){cancelAddress(a)};a.editNetworkObj=
function(b){editNetworkObj(a,a.networkObjects,b);a.editing=b};a.editAddress=function(b){editAddress(a,b)};a.removeNetworkObj=function(b){var d=!0;a.accessControl=f.query(function(){for(var e=0;e<a.accessControl.length;e++)if(null!=a.accessControl[e].networkObjects)for(var f=0;f<a.accessControl[e].networkObjects.length;f++)if(a.accessControl[e].networkObjects[f].id==a.networkObjects[b].id){d=!1;break}d?c.remove({id:a.networkObjects[b].id},function(){a.networkObjects=c.query(function(){a.printAddArr=
[];printAddresses(1,a.networkObjects,a.printAddArr)})}):(a.errorMessages=[],a.errorMessages.push("Network Object: Network object is in use."),a.showErrorPage=!0,window.scrollTo(0,0))})};a.removeAddress=function(b){removeObject(a.networkObj.rules,b)};a.keyPress=function(b){13==b.keyCode&&"/advanced/networkobjects"==e.path()&&(0!=a.pageToShow||a.showErrorPage?1!=a.pageToShow&&2!=a.pageToShow||a.showErrorPage||(2==a.pageToShow?a.applyAddress():a.applyNetworkObj()):e.path("/advanced"))}}]).controller("portForwardRuleCtrl",
["$scope","$route","PortForwardRules","StaticNAT","PortForward","$location",function(a,b,c,d,e,f){a.tab=b.current.tab;a.section=b.current.section;a.showErrorPage=!1;a.runFocus=!1;init_services(a);a.tempPortForward={name:"Global Application",description:"",servType:1,protocols:[]};a.pageToShow=0;a.editing=-1;a.showBasic=!1;a.togglePage=function(b){a.runFocus=!0;a.pageToShow=b;window.scrollTo(0,0)};a.toggleBasic=function(){a.showBasic=!a.showBasic;window.scrollTo(0,0)};a.refresh=function(){a.nat=d.query();
a.forwards=e.query();a.portForwardRules=c.query(function(){a.portForwardRules=sortListItems(a.portForwardRules);a.printProtArr=[];printProtocol(1,a.portForwardRules,a.printProtArr)})};a.refresh();a.errorPageOk=function(){a.showErrorPage=!1;window.scrollTo(0,0)};a.applyPortForwardRule=function(){a.errorMessages=[];""==a.tempPortForward.name?a.errorMessages.push("Service Name: A name must be specified."):/^[0-9A-Z\!\-\_]+$/i.test(a.tempPortForward.name)||a.errorMessages.push('Service Name: Rule name should consist of standard characters only (ASCII 32-126) excluding the special character space and any of :@"|\\/=+<>()[]{}&%^$*?,;');
for(var b=0;b<a.portForwardRules.length;b++)b!=a.editing&&a.portForwardRules[b].name==a.tempPortForward.name&&a.errorMessages.push("Service Name: This name is already used by another protocol.");0==a.tempPortForward.protocols.length&&a.errorMessages.push("Server Ports: At least one server ports entry must be defined.");if(0<a.errorMessages.length)a.showErrorPage=!0,window.scrollTo(0,0);else{var d={};d.name=escape(a.tempPortForward.name).replace(/\+/g,"%2B");d.description=escape(a.tempPortForward.description).replace(/\+/g,
"%2B");d.servType=a.tempPortForward.servType;d.protocols=[];for(b=0;b<a.tempPortForward.protocols.length;b++){var e={};copyProtocol(e,a.tempPortForward.protocols[b]);d.protocols.push(e)}-1==a.editing?c.save(d,function(){a.refresh()}):c.update({id:a.portForwardRules[a.editing].id},d,function(){a.refresh()});init_services(a);a.tempPortForward={name:"Global Application",description:"",servType:1,protocols:[]};a.editing=-1;a.togglePage(0)}};a.applyProtocol=function(){a.errorMessages=[];a.protocols.protocol=
parseInt(a.protocols.protocol);a.protocols.incomingPorts=parseInt(a.protocols.incomingPorts);a.protocols.outgoingPorts=parseInt(a.protocols.outgoingPorts);a.protocols.icmpMessage=parseInt(a.protocols.icmpMessage);var b=a.protocols.incomingPortStart,c=a.protocols.incomingPortEnd,d=a.protocols.outgoingPortStart,e=a.protocols.outgoingPortEnd;switch(a.protocols.protocol){case 0:var f=a.protocols.protocolNumber;(null==f||""===f||isNaN(f)||0>f||255<f||isNotaInt(f)||!checksForWholeNumber(f))&&a.errorMessages.push("Protocol Number: Please enter a numeric value between 0 and 255.");
break;case 1:case 2:switch(a.protocols.incomingPorts){case 1:(null==b||""===b||1>b||65535<b||isNotaInt(b))&&a.errorMessages.push("Source Port: Please enter a numeric value between 1 and 65535.");break;case 2:(null==b||""===b||1>b||65535<b||isNotaInt(b))&&a.errorMessages.push("Start Source Port: Please enter a numeric value between 1 and 65535."),(null==c||""===c||1>c||65535<c||isNotaInt(c))&&a.errorMessages.push("End Source Port: Please enter a numeric value between 1 and 65535."),0==a.errorMessages.length&&
b>=c&&a.errorMessages.push("Source Ports: The From value must be lower than the To value in a range of ports (from="+b+", to="+c+").")}switch(a.protocols.outgoingPorts){case 1:(null==d||""===d||1>d||65535<d||isNotaInt(d))&&a.errorMessages.push("Destination Port: Please enter a numeric value between 1 and 65535.");4567==d&&!1==a.protocols.outgoingExclude&&1==a.protocols.protocol&&a.errorMessages.push("Invalid rule: Port 4567 cannot be blocked");4577==d&&!1==a.protocols.outgoingExclude&&1==a.protocols.protocol&&
a.errorMessages.push("Invalid rule: Port 4577 cannot be blocked");break;case 2:(null==d||""===d||1>d||65535<d||isNotaInt(d))&&a.errorMessages.push("Start Destination Port: Please enter a numeric value between 1 and 65535."),(null==e||""===e||1>e||65535<e||isNotaInt(e))&&a.errorMessages.push("End Destination Port: Please enter a numeric value between 1 and 65535."),0==a.errorMessages.length&&d>=e&&a.errorMessages.push("Destination Ports: The From value must be lower than the To value in a range of ports (from="+
d+", to="+e+").")}break;case 3:if(10==a.protocols.icmpMessage){var f=a.protocols.icmpType,m=a.protocols.icmpCode;(null==f||""===f||0>f||255<f||isNotaInt(f))&&a.errorMessages.push("ICMP Type:  Please enter a numeric value between 0 and 255.");(null==m||""===m||0>m||255<m||isNotaInt(m))&&a.errorMessages.push("ICMP Code:  Please enter a numeric value between 0 and 255.")}}0==a.errorMessages.length&&(0==a.protocols.incomingPorts&&(a.protocols.incomingExclude=!1),0==a.protocols.outgoingPorts&&(a.protocols.outgoingExclude=
!1),1==a.protocols.protocol||2==a.protocols.protocol)&&(m=f=!1,0==a.protocols.incomingPorts?f=!0:2==a.protocols.incomingPorts&&!1==a.protocols.incomingExclude&&1==b&&65535==c&&(f=!0),0==a.protocols.outgoingPorts?m=!0:2==a.protocols.outgoingPorts&&!1==a.protocols.outgoingExclude&&1==d&&65535==e&&(m=!0),f&&m&&a.errorMessages.push('Port forwarding rules can not be Any-to-Any (or "source: 1-65535" with "destination: 1-65535").'));0==a.errorMessages.length&&(b=getTempObjectContent(a.protocols),a.errorMessages=
compareNewCondAndCurrentList(a.tempPortForward.protocols,b,a.editingProtocol));0<a.errorMessages.length?(a.showErrorPage=!0,window.scrollTo(0,0)):(a.protocols.protocolNumber=parseInt(a.protocols.protocolNumber),a.protocols.icmpType=parseInt(a.protocols.icmpType),a.protocols.icmpCode=parseInt(a.protocols.icmpCode),applyProtocol(a,a.tempPortForward.protocols),printProtocol(2,a.tempPortForward.protocols,a.printPortsArr))};a.cancelPortForwardRule=function(){cancelService(a);a.tempPortForward={name:"Global Application",
description:"",protocols:[]}};a.cancelProtocol=function(){cancelProtocol(a)};a.editPortForwardRule=function(b){a.tempPortForward.name=a.portForwardRules[b].name;a.tempPortForward.description=a.portForwardRules[b].description;a.tempPortForward.servType=a.portForwardRules[b].servType;a.tempPortForward.protocols=[];for(var c=0;c<a.portForwardRules[b].protocols.length;c++){var d={};copyProtocol(d,a.portForwardRules[b].protocols[c]);a.tempPortForward.protocols.push(d)}a.printPortsArr=[];printProtocol(2,
a.tempPortForward.protocols,a.printPortsArr);a.editing=b;a.togglePage(3)};a.editProtocol=function(b){editProtocol(a,b,a.tempPortForward.protocols)};a.removePortForwardRule=function(b){a.errorMessages=[];for(var d=a.portForwardRules[b].name,e=0;e<a.nat.length;e++)for(var f=0;f<a.nat[e].services.length;f++)if(d===a.nat[e].services[f].name){a.errorMessages.push("Protocol: Protocol is in use.");break}if(0==a.errorMessages.length)for(e=0;e<a.forwards.length;e++)for(f=0;f<a.forwards[e].protocols.length;f++)if(d===
a.forwards[e].name){a.errorMessages.push("Protocol: Protocol is in use.");break}0<a.errorMessages.length?(a.showErrorPage=!0,window.scrollTo(0,0)):c.remove({id:a.portForwardRules[b].id},function(){a.portForwardRules=c.query(function(){a.portForwardRules=sortListItems(a.portForwardRules);a.printProtArr=[];printProtocol(1,a.portForwardRules,a.printProtArr)})})};a.removeProtocol=function(b){removeObject(a.tempPortForward.protocols,b);a.printPortsArr=[];printProtocol(2,a.tempPortForward.protocols,a.printPortsArr)};
a.keyPress=function(b){13==b.keyCode&&"/advanced/portforward"==f.path()&&(0!=a.pageToShow||a.showErrorPage?3!=a.pageToShow||a.showErrorPage?4!=a.pageToShow||a.showErrorPage||a.applyProtocol():a.applyPortForwardRule():f.path("/advanced"))}}]).controller("dnsServerCtrl",["$scope","$route","DnsServer","securityTips","$location",function(a,b,c,d,e){a.tab=b.current.tab;a.section=b.current.section;a.dnsServer=c.query();a.showErrorPage=!1;a.showAdd=!1;a.editing=-1;a.runFocus=!1;a.showAlert=!1;a.errorPageOk=
function(){a.showErrorPage=!1;window.scrollTo(0,0)};a.validateBeforeSave=function(){a.errorMessages=[];a.hasSameHost=!1;validateHostnameDNSServer(a.tempDnsServer.hostname)||a.errorMessages.push("Host Name: Name may not contain spaces. Only letters, digits and the special characters dash (-), underscore (_) and dot (.) may be used. These special characters may not appear at the beginning or at the end of a name. The maximum length of a label (text between two dots) is 63.");validateIp(a.tempDnsServer.ipAddress)?
"0.0.0.0"===getIpString(a.tempDnsServer.ipAddress)?a.errorMessages.push("IP Address: IP address may not be 0.0.0.0. IP address must consist of 4 fields. Each field's value must be between 0 and 255, without any spaces. At least one of the values must be greater than 0."):("255.255.255.255"===getIpString(a.tempDnsServer.ipAddress)||224<=Number(a.tempDnsServer.ipAddress[0])&&239>=Number(a.tempDnsServer.ipAddress[0]))&&a.errorMessages.push("Invalid IP address."):a.errorMessages.push("IP Address: IP address must consist of 4 fields. Each field's value must be between 0 and 255, without any spaces.");
for(var b=0;b<a.dnsServer.length;b++)a.editing!=b&&String(a.tempDnsServer.hostname).toLowerCase()==String(a.dnsServer[b].hostname).toLowerCase()&&(a.hasSameHost=!0);0<a.errorMessages.length?(a.showErrorPage=!0,window.scrollTo(0,0)):a.hasSameHost?a.showAlert=!0:a.saveInfoNow()};a.cancelInfoNow=function(){a.showAlert=!1};a.saveInfoNow=function(){a.showAlert=!1;a.save()};a.save=function(){var b={hostname:a.tempDnsServer.hostname,type:a.tempDnsServer.type};1==b.type&&(b.ipAddress=getIpString(a.tempDnsServer.ipAddress));
-1==a.editing?c.save(b,function(){a.dnsServer=c.query()}):c.update({id:a.dnsServer[a.editing].id},b,function(){a.dnsServer=c.query()});a.tempDnsServer={};a.toggleShow()};a.toggleShow=function(){a.showAdd=!a.showAdd};a.addDnsEntry=function(){a.tempDnsServer={hostname:"new-host",type:1,ipAddress:[0,0,0,0]};a.runFocus=!0;a.editing=-1;a.toggleShow()};a.editDnsEntry=function(b){a.editing=b;a.tempDnsServer={hostname:a.dnsServer[a.editing].hostname,type:a.dnsServer[a.editing].type};1==a.tempDnsServer.type&&
(a.tempDnsServer.ipAddress=splitIpArr(a.dnsServer[a.editing].ipAddress));a.showAdd=!a.showAdd};a.removeDnsEntry=function(b){c.remove({id:a.dnsServer[b].id},function(){a.dnsServer=c.query()})};a.keyPress=function(b){13==b.keyCode&&"/advanced/dnsserver"==e.path()&&(a.showAdd?a.showAdd&&!a.showErrorPage&&a.validateBeforeSave():e.path("/advanced"))}}]).controller("ipv6Ctrl",["$scope","$route","$location","IPv6",function(a,b,c,d){a.tab=b.current.tab;a.section=b.current.section;a.ipv6=d.get(function(){a.ipv6.addressStart=
a.ipv6.addressStart.toString(16);a.ipv6.addressEnd=a.ipv6.addressEnd.toString(16);for(var b=0;b<a.ipv6.interfaces.length;b++)a.ipv6.interfaces[b].name=unescape(a.ipv6.interfaces[b].name);a.autoDns=1==a.ipv6.mode?a.ipv6.autoDns:0});a.errorPageOk=function(){a.showErrorPage=!1;window.scrollTo(0,0)};a.save=function(){if(a.ipv6.enabled){a.errorMessages=[];a.ipv6.autoDns=a.autoDns;if(2==a.ipv6.mode)if(a.ipv6.staticAddress=a.ipv6.staticAddress.replace(/^\s+|\s+$/g,""),a.ipv6.staticDefaultGateway=a.ipv6.staticDefaultGateway.replace(/^\s+|\s+$/g,
""),a.ipv6.staticPrimaryDns=a.ipv6.staticPrimaryDns.replace(/^\s+|\s+$/g,""),a.ipv6.staticSecondaryDns=a.ipv6.staticSecondaryDns.replace(/^\s+|\s+$/g,""),validateIPv6(a.ipv6.staticAddress)||a.errorMessages.push("IPv6 WAN Address: Invalid IP Address."),(isNaN(a.ipv6.staticPrefixLength)||16>a.ipv6.staticPrefixLength||128<a.ipv6.staticPrefixLength)&&a.errorMessages.push("Prefix Length: Please enter a numeric value between 16 and 128."),validateIPv6(a.ipv6.staticDefaultGateway)||a.errorMessages.push("IPv6 Default Gateway: Invalid IP Address."),
validateIPv6(a.ipv6.staticPrimaryDns)||""!=a.ipv6.staticPrimaryDns&&a.errorMessages.push("Primary DNS Server: Invalid IP Address."),validateIPv6(a.ipv6.staticSecondaryDns)||""!=a.ipv6.staticSecondaryDns&&a.errorMessages.push("Secondary DNS Server: Invalid IP Address."),""!=a.ipv6.staticPrimaryDns&&a.ipv6.staticPrimaryDns==a.ipv6.staticSecondaryDns&&a.errorMessages.push("Secondary DNS Server: Same As DNS1."),validateIPv6(a.ipv6.lanPrefix)){var b=getPrefixLength(a.ipv6.lanPrefix);16>b||128==b?a.errorMessages.push("LAN Prefix: Invalid LAN prefix."):
a.ipv6.lanPrefix=a.ipv6.lanPrefix+"/"+b}else validatePrefixLength(a.ipv6.lanPrefix)||a.errorMessages.push("LAN Prefix: Invalid LAN prefix.");else 1==a.ipv6.mode&&1==a.ipv6.autoDns&&(a.ipv6.staticPrimaryDns=a.ipv6.staticPrimaryDns.replace(/^\s+|\s+$/g,""),a.ipv6.staticSecondaryDns=a.ipv6.staticSecondaryDns.replace(/^\s+|\s+$/g,""),validateIPv6(a.ipv6.staticPrimaryDns)||a.errorMessages.push("Primary DNS Server: Invalid IP Address."),validateIPv6(a.ipv6.staticSecondaryDns)||a.errorMessages.push("Secondary DNS Server: Invalid IP Address."));
if(1==a.ipv6.lanMode)if(""===a.ipv6.addressStart||""===a.ipv6.addressEnd)a.errorMessages.push("LAN IPv6 Address Range: Please enter a numeric value between 2 and ffff");else if(/^[0-9A-F]+$/i.test(a.ipv6.addressStart)&&/^[0-9A-F]+$/i.test(a.ipv6.addressEnd)){var f=parseInt(a.ipv6.addressStart,16),g=parseInt(a.ipv6.addressEnd,16);2>f||65535<f||2>g||65535<g?a.errorMessages.push("LAN IPv6 Address Range: Please enter a numeric value between 2 and ffff"):f>g&&a.errorMessages.push("LAN IPv6 Address Range: Start addr must be little or equal to end addr.")}else a.errorMessages.push("LAN IPv6 Address Range: Please enter hex digit as LAN range.");
(""===a.ipv6.advertisementLifetime||isNaN(a.ipv6.advertisementLifetime)||0>a.ipv6.advertisementLifetime||150<a.ipv6.advertisementLifetime||!checksForDecimalNumber(a.ipv6.advertisementLifetime)||!checksForWholeNumber(a.ipv6.advertisementLifetime))&&a.errorMessages.push("Router Advertisement Lifetime: Please enter a numeric value between 0 and 150.");0!=a.ipv6.mode&&1==a.ipv6.lanMode&&(""===a.ipv6.addressLifetime||isNaN(a.ipv6.addressLifetime)||3>a.ipv6.addressLifetime||150<a.ipv6.addressLifetime||
!checksForDecimalNumber(a.ipv6.addressLifetime)||!checksForWholeNumber(a.ipv6.addressLifetime))&&a.errorMessages.push("IPv6 Address Lifetime: Please enter a numeric value between 3 and 150.");if(0<a.errorMessages.length)a.showErrorPage=!0,window.scrollTo(0,0);else{a.ipv6.mode=parseInt(a.ipv6.mode);switch(a.ipv6.mode){case 0:a.ipv6.autoDns=2;break;case 1:a.ipv6.autoDns=parseInt(a.autoDns);break;case 2:a.ipv6.autoDns=1}a.ipv6.staticPrefixLength=parseInt(a.ipv6.staticPrefixLength);a.ipv6.lanMode=parseInt(a.ipv6.lanMode);
a.ipv6.advertisementLifetime=parseInt(a.ipv6.advertisementLifetime);a.ipv6.addressLifetime=parseInt(a.ipv6.addressLifetime);a.ipv6.addressStart=f;a.ipv6.addressEnd=g;for(b=0;b<a.ipv6.interfaces.length;b++)a.ipv6.interfaces[b].name=escape(a.ipv6.interfaces[b].name).replace(/\+/g,"%2B");a.ipv6.$update(function(){a.ipv6.addressStart=a.ipv6.addressStart.toString(16);a.ipv6.addressEnd=a.ipv6.addressEnd.toString(16);for(var b=0;b<a.ipv6.interfaces.length;b++)a.ipv6.interfaces[b].name=unescape(a.ipv6.interfaces[b].name);
c.path("/advanced")})}}else d.update({enabled:!1},function(){c.path("/advanced")})};a.keyPress=function(b){13==b.keyCode&&"/advanced/ipv6"==c.path()&&a.save()}}]).controller("ArpCtrl",["$scope","$route","ARPTable","NetworkConnections","$location",function(a,b,c,d,e){a.tab=b.current.tab;a.section=b.current.section;a.interfaces=d.query(function(){for(var b=0;b<a.interfaces.length;b++)a.interfaces[b].name=unescape(a.interfaces[b].name)});a.refresh=function(){a.connections=c.query()};a.keyPress=function(a){13==
a.keyCode&&"/advanced/arptable"==e.path()&&e.path("/advanced")};a.refresh()}]).controller("PortConfigCtrl",["$scope","$route","$location","Ethernet",function(a,b,c,d){a.tab=b.current.tab;a.section=b.current.section;a.runFocus=!1;var e=d.get(function(){a.ports=[];a.ports.push({name:"WAN Port",currentMode:e.wan.currentMode,desiredMode:e.wan.desiredMode,status:e.wan.status});a.ports.push({name:"LAN Port 1",currentMode:e.lan1.currentMode,desiredMode:e.lan1.desiredMode,status:e.lan1.status});a.ports.push({name:"LAN Port 2",
currentMode:e.lan2.currentMode,desiredMode:e.lan2.desiredMode,status:e.lan2.status});a.ports.push({name:"LAN Port 3",currentMode:e.lan3.currentMode,desiredMode:e.lan3.desiredMode,status:e.lan3.status});a.ports.push({name:"LAN Port 4",currentMode:e.lan4.currentMode,desiredMode:e.lan4.desiredMode,status:e.lan4.status})});a.checkSave=function(){systemSettings.warnBeforeChanges?a.isOK=!0:(a.isOK=!1,a.save())};a.cancelOK=function(){a.isOK=!1;c.path("/advanced")};a.save=function(){d.update({wan:{desiredMode:parseInt(a.ports[0].desiredMode)},
lan1:{desiredMode:parseInt(a.ports[1].desiredMode)},lan2:{desiredMode:parseInt(a.ports[2].desiredMode)},lan3:{desiredMode:parseInt(a.ports[3].desiredMode)},lan4:{desiredMode:parseInt(a.ports[4].desiredMode)}},function(){c.path("/advanced")})};a.selectOpt=function(){a.runFocus=!0};a.keyPress=function(b){13==b.keyCode&&"/advanced/portconfig"==c.path()&&(a.isOK?a.save():a.checkSave())}}]).controller("RoutesCtrl",["$scope","$route","$location","Routes","NetworkConnections","SystemSettings",function(a,
b,c,d,e,f){a.tab=b.current.tab;a.section=b.current.section;a.runFocus=!1;a.editingRoute=!1;a.showErrorPage=!1;a.routesConnections=[];a.routingObject=d.get(function(){a.routes=a.routingObject.routes});a.sysSettings=f.get(function(){});a.connections=e.query(function(){for(var b=0,c=0;c<a.connections.length;c++){if(null!=a.connections[c].bridged)for(var d=0;d<a.connections[c].bridged.length;d++)a.connections[c].bridged[d]&&(a.connections[a.connections[c].availableBridges[d]].name=2==a.connections[c].availableBridges[d]?
unescape(a.connections[c].name)+" Wireless 802.11 2.4 GHz Access Point":3==a.connections[c].availableBridges[d]?unescape(a.connections[c].name)+" Wireless 802.11 5.0 GHz Access Point":unescape(a.connections[c].name+" "+a.connections[a.connections[c].availableBridges[d]].name));a.connections[c].name=unescape(a.connections[c].name);a.connections[c].hasOwnProperty("connectionUsed")||(a.routesConnections[b]=a.connections[c],b++)}});a.errorIGMPPageOk=function(){a.showIGMPwarning=!1;window.scrollTo(0,0);
d.update({domainRouting:a.routingObject.domainRouting,igmpRouting:a.routingObject.igmpRouting},function(){c.path("/advanced")})};a.errorIGMPPageNo=function(){a.showIGMPwarning=!1};a.errorPageOk=function(){a.showErrorPage=!1;window.scrollTo(0,0)};a.addNewRoute=function(){a.runFocus=!0;a.routeIndex=-1;a.routeEditing={type:0,destination:[0,0,0,0],netmask:[255,255,255,255],gateway:[0,0,0,0],metric:0};a.editingRoute=!0};a.save=function(b){b||!0!==a.sysSettings.warnBeforeChanges?d.update({domainRouting:a.routingObject.domainRouting,
igmpRouting:a.routingObject.igmpRouting},function(){c.path("/advanced")}):(a.errorMessages=[],a.errorMessages.push("Internet Group Management Protocol (IGMP): You are attempting to disable Internet Group Management Protocol (IGMP). Please note that Internet Group Management Protocol (IGMP) will be disabled for the following connections:"),a.showIGMPwarning=!0,window.scrollTo(0,0))};a.warningMsgGen=function(){return null!=a.routes&&0<a.routes.length?a.connections[a.routes[0].type].name:a.connections[0].name};
a.editRoute=function(b){a.editingRoute=!0;b=a.routes[b];a.routeIndex=b.id;a.routeEditing={type:parseInt(a.translateRouteEnum(b.type,!0)),destination:splitIpArr(b.destination),netmask:splitIpArr(b.netmask),gateway:splitIpArr(b.gateway),metric:b.metric}};a.deleteRoute=function(b){d.remove({id:a.routes[b].id},function(){a.routingObject=d.get(function(){a.routes=a.routingObject.routes})})};a.cancelRouteEdit=function(){a.editingRoute=!1};a.saveRoute=function(){a.runFocus=!0;a.errorMessages=[];validateIp(a.routeEditing.destination)||
a.errorMessages.push("Destination: IP address must consist of 4 fields. Each field's value must be between 0 and 255, without any spaces.");validateIp(a.routeEditing.netmask)||a.errorMessages.push("Netmask: Subnet mask must consist of 4 fields. Each field's value must be between 0 and 255, constructing a contiguous string of binary ones. The default mask value is 255.255.255.0.");"0.0.0.0"==getIpString(a.routeEditing.netmask)&&a.errorMessages.push("Netmask: Subnet mask may not be 0.0.0.0. Subnet mask must consist of 4 fields. Each field's value must be between 0 and 255, constructing a contiguous string of binary ones. The default mask value is 255.255.255.0.");
(null==a.routeEditing.metric||""===a.routeEditing.metric||isNaN(a.routeEditing.metric)||0>a.routeEditing.metric||255<a.routeEditing.metric||isNotaInt(a.routeEditing.metric)||!checksForWholeNumber(a.routeEditing.metric))&&a.errorMessages.push("Metric: Please enter a numeric value between 0 and 255.");"0.0.0.0"==getIpString(a.routeEditing.gateway)&&a.errorMessages.push("Gateway: IP Address may not be 0.0.0.0.");validateIp(a.routeEditing.gateway)||a.errorMessages.push("Gateway : IP address must consist of 4 fields. Each field's value must be between 0 and 255, without any spaces.");
for(var b=!0,c=!1,e=0;4>e;e++){for(var f=7;-1<f;f--){var r=1==(a.routeEditing.netmask[e]>>f&1);if(r&&c){b=!1;break}r||(c=!0)}if(!b)break}b||a.errorMessages.push("Netmask: Subnet mask must consist of 4 fields. Each field's value must be between 0 and 255, constructing a contiguous string of binary ones. The default mask value is 255.255.255.0.");0<a.errorMessages.length?(a.showErrorPage=!0,window.scrollTo(0,0)):(a.editingRoute=!1,a.routeEditing.type=parseInt(a.translateRouteEnum(a.routeEditing.type,
!1)),a.routeEditing.destination=getIpString(a.routeEditing.destination),a.routeEditing.netmask=getIpString(a.routeEditing.netmask),a.routeEditing.gateway=getIpString(a.routeEditing.gateway),a.routeEditing.metric=parseInt(a.routeEditing.metric),-1!=a.routeIndex?d.update({id:a.routeIndex},a.routeEditing,function(){a.routingObject=d.get(function(){a.routes=a.routingObject.routes})}):d.save(a.routeEditing,function(){a.routingObject=d.get(function(){a.routes=a.routingObject.routes})}))};a.translateRouteEnum=
function(a,b){if(b)switch(parseInt(a)){case 0:return 0;case 2:return 1;case 3:return 2}else switch(parseInt(a)){case 0:return 0;case 1:return 2;case 2:return 3}};a.selectOpt=function(){a.runFocus=!0};a.keyPress=function(b){13==b.keyCode&&"/advanced/routing"==c.path()&&(a.editingRoute||a.showErrorPage||a.showIGMPwarning?a.editingRoute&&!a.showErrorPage&&a.saveRoute():a.save(a.routingObject.igmpRouting))}}]).controller("UPnPCtrl",["$scope","$route","$location","UPnP",function(a,b,c,d){a.tab=b.current.tab;
a.section=b.current.section;a.upnpSettings=d.get();a.save=function(){a.upnpSettings.$update(function(){c.path("/advanced")})}}]).controller("dynamicDnsCtrl",["$scope","$route","$location","DynamicDNS","DynamicDNSProvider","$window","securityTips","SystemSettings",function(a,b,c,d,e,f,g,h){a.sysSettings=h.get();a.pageToShow=0;a.toggleWarningPage=function(b){a.pageToShow=b;window.scrollTo(0,0)};a.tab=b.current.tab;a.section=b.current.section;a.showErrorPage=!1;a.showAddEdit=!1;a.editing=-1;a.ddnsObjects=
[];a.ddnsObject={};a.runFocus=!1;a.getTitle=function(a){return getStatusTitle(a)};a.show=function(a){g.showMessage(getStatusTitle(a.status),a.errorMessage)};a.init_DDNSObject=function(){a.ddnsObject={hostname:"",provider:"",username:"",password:"",useSsl:!0,status:"",lastUpdate:""}};a.loadProviders=function(){a.ddnsProviders=e.query(function(){0<a.ddnsProviders.length&&(a.ddnsObject.provider=a.ddnsProviders[0])})};a.refresh=function(){a.ddnsObjects=[];a.dynamicDNSObjects=d.query(function(){for(var b,
c=0;c<a.dynamicDNSObjects.length;c++)b={},b.id=a.dynamicDNSObjects[c].id,b.hostname=unescape(a.dynamicDNSObjects[c].hostname),b.lastUpdate=unescape(a.dynamicDNSObjects[c].updateTime),b.status=unescape(a.dynamicDNSObjects[c].status),b.errorMessage=unescape(a.dynamicDNSObjects[c].errorMessage),b.hyperLink=0===a.dynamicDNSObjects[c].status||1===a.dynamicDNSObjects[c].status?!1:!0,void 0==b&&b.hostname==b||a.ddnsObjects.push(b)});a.loadProviders()};a.refresh();a.togglePage=function(b){a.showAddEdit=!1};
a.errorPageOk=function(){a.showErrorPage=!1;window.scrollTo(0,0)};a.addDDNS=function(){a.loadProviders();a.showErrorPage=!1;a.showAddEdit=!0;a.editing=-1;a.init_DDNSObject();a.runFocus=!0};a.openSub=function(){""!=a.ddnsObject.provider&&(a.DnsLink=a.ddnsObject.provider.url,f.open(a.DnsLink))};a.editDDNSObj=function(b){a.showAddEdit=!0;a.showErrorPage=!1;a.editing=b;a.ddnsObject=a.dynamicDNSObjects[b];for(b=0;b<a.ddnsProviders.length;b++)if(a.ddnsProviders[b].name==a.ddnsObject.provider){a.ddnsObject.provider=
a.ddnsProviders[b];break}};a.saveDynamicDnsObj=function(){a.errorMessages=[];if(0!==a.ddnsObject.hostname.length){for(var b=0;b<a.dynamicDNSObjects.length;b++)if(a.editing!=b&&a.dynamicDNSObjects[b].hostname===a.ddnsObject.hostname){a.errorMessages.push("Duplicate Hostname: An identical hostname already exists in the system.");break}validateLocalDomains(a.ddnsObject.hostname)||a.errorMessages.push("Host Name: Name may not contain spaces. Only letters, digits and the special characters dash (-), underscore (_) and dot (.) may be used. These special characters may not appear at the beginning or at the end of a name. The maximum length of a label (text between two dots) is 63.")}else a.errorMessages.push("Host Name: Name may not contain spaces. Only letters, digits and the special characters dash (-), underscore (_) and dot (.) may be used. These special characters may not appear at the beginning or at the end of a name. The maximum length of a label (text between two dots) is 63.");
0==a.ddnsObject.provider.length&&a.errorMessages.push("Please Select DNS provider");0==a.ddnsObject.username.length&&a.errorMessages.push("Please enter a User Name.");0<a.errorMessages.length?(a.showErrorPage=!0,window.scrollTo(0,0)):a.ddnsObject.useSsl?a.save():g.showWarningMsgBeforeSaving1("DDNS Unsecured Mode",'Disabling SSL will make your communications less secure. Without SSL your password will be sent over the Internet in plain text, which carries the risk of allowing your password to be exposed to a malicious user. To disable SSL, click "Apply".',
"Apply",[""]).then(function(b){"cancel"!=b&&void 0!=b&&a.save()})};a.save=function(){var b={},b=a.ddnsObject;b.provider=b.provider.name;-1==a.editing?d.save(b,function(){a.refresh()}):(delete b.updateTime,delete b.status,d.update({id:a.dynamicDNSObjects[a.editing].id},b,function(){a.refresh()}));a.togglePage(0);a.init_DDNSObject(a)};a.cancelDynamicDnsObj=function(){a.togglePage(0);a.refresh()};a.cfmDeleteControl=function(){d.remove({id:a.selectedIndex},function(){a.toggleWarningPage(0);a.refresh()})};
a.removeDDNSEntry=function(b){a.selectedIndex=b;!0==a.sysSettings.warnBeforeChanges?a.toggleWarningPage(1):a.cfmDeleteControl()};a.refreshDDNS=function(){a.refresh()};a.keyPress=function(b){13==b.keyCode&&"/advanced/dynamicdns"==c.path()&&(a.showAddEdit||a.showErrorPage?a.showAddEdit&&!a.showErrorPage&&a.saveDynamicDnsObj():c.path("/advanced"))}}]);angular.module("firewall.controllers",[]).controller("GeneralCtrl",["$scope","$route","$routeParams","$location","General","IPv6",function(a,b,c,d,e,f){a.tab=b.current.tab;a.section=b.current.section;a.general=e.get();a.ipv6=f.get();a.warning=!1;null!=c.warn&&(a.warning=!0);a.cancel=function(){null!=c.connectionEdit?d.url("/network/connections/"+c.connectionEdit+"/edit"):(location.reload(),d.replace())};a.save=function(){a.general.$update(function(){location.reload()})};a.acceptWarning=function(){d.search({});
d.replace()};a.keyPress=function(b){13==b.keyCode&&"/firewall"==d.path()&&a.save()}}]).controller("AccessControlCtrl",["$scope","$route","AccessControl","NetworkObjects","DnsServer","PortForwardRules","Schedules","Devices","$routeParams","$location","DateTimeSettings","General","SystemSettings",function(a,b,c,d,e,f,g,h,k,l,r,m,n){a.tab=b.current.tab;a.section=b.current.section;var v=m.get(function(){a.showAllow=2==v.ipv4SecurityLevel});a.showAdd=!1;a.isSame=!1;a.pageToShow=0;a.netObj=-2;a.prot=-2;
a.sched=-2;a.showNetObj=[];a.runFocus=!1;a.sysSettings=n.get();a.initVars=function(){init_networkObjs(a);init_services(a);init_schedules(a);a.networkObjects=[];a.services=[];a.editing=-1};a.errorPageOk=function(){0!=a.pageToShow||a.showAdd||a.refresh();a.isSame=!1;a.showErrorPage=!1;window.scrollTo(0,0)};a.cancel=function(){window.scrollTo(0,0);null!=k.fromnetwork?l.url("/network"):l.url("/firewall")};a.setPrintArr=function(b){a.printAddArr=[];a.printProtArr=[];a.netObjShowArr=[];switch(b){case 0:printAccessControlAddresses(a.accessControl,
a.devices,a.printAddArr);printProtocolWithName(a.accessControl,a.printProtArr);break;case 1:printAddresses(1,a.networkObjects,a.printAddArr),printProtocol(1,a.services,a.printProtArr)}};a.save=function(){for(var b=0,d=0,e=0;e<a.accessControl.length;e++)a.active[e]!=a.accessControl[e].enabled&&(b++,c.update({id:a.accessControl[e].id},{active:a.active[e]},function(){d++;d==b&&a.refresh()}))};a.resolveNow=function(){};a.getDeviceName=function(b){for(var c=0;c<a.devices.length;c++)if(b==a.devices[c].ipAddress)return a.devices[c].name;
return b};a.getDeviceIp=function(b,c){for(var d=0;d<a.devices.length;d++)if(b==a.devices[d].name&&c===a.devices[d].ipAddress)return a.devices[d].ipAddress;return b};a.netObjsIPArr=[];a.showNetObj=[];a.netObjsArr=[];a.refresh=function(){a.active=[];a.dateTimeSettings=r.get(function(){a.localTimeMoment=findTimeNow(a.dateTimeSettings);a.devices=h.query(function(){a.devices=filterOutGuest(a.devices);a.accessControl=c.query(function(){a.netObjs=d.query(function(){a.netObjsIPArr=[];a.showNetObj=[];a.netObjsArr=
[];for(var b=[],c=0;c<a.netObjs.length;c++){var d={type:1,name:a.netObjs[c].name,index:c,ipAddress:a.netObjs[c].ipAddress};d.deviceDisplayName=void 0!=d.ipAddress&&""!=d.ipAddress?d.ipAddress+" - "+d.name:d.name;a.netObjsArr.push(d);a.showNetObj.push(!0);b=[];for(d=0;d<a.netObjs[c].rules.length;d++)b.push(a.netObjs[c].rules[d].ipAddress);a.netObjsIPArr.push(b)}for(c=0;c<a.devices.length;c++)a.devices[c].isStb||(d={type:2,name:a.devices[c].name,ipAddress:a.devices[c].ipAddress},d.deviceDisplayName=
void 0!=d.ipAddress&&""!=d.ipAddress?d.ipAddress+" - "+d.name:d.name,a.netObjsArr.push(d),a.showNetObj.push(!0),a.netObjsIPArr.push([]));for(c=0;c<a.accessControl.length;c++){a.active.push(a.accessControl[c].active);for(b=0;b<a.accessControl[c].hosts.length;b++)checkAndFindNetworkObject(a.accessControl[c].networkObjects,a.getDeviceName(a.accessControl[c].hosts[b]),a.accessControl[c].hosts[b]);a.accessControl[c].schedActive="Active";null!=a.accessControl[c].schedule&&(a.accessControl[c].schedActive=
isScheduleActive(a.accessControl[c].schedule,a.localTimeMoment));for(var e=[],d=0;d<a.accessControl[c].networkObjects.length;d++)for(b=0;b<a.accessControl[c].networkObjects[d].rules.length;b++)for(var g=0;g<a.netObjsArr.length;g++)if(0<a.netObjsIPArr[g].length)for(var f=0;f<a.netObjsIPArr[g].length&&(e=a.netObjsIPArr[g][f],e==a.accessControl[c].networkObjects[d].rules[b].ipAddress&&(a.showNetObj.splice(g,1),a.netObjsArr.splice(g,1),a.netObjsIPArr.splice(g,1),g--),null!=a.netObjsIPArr[g]);f++);else e=
a.netObjsArr[g].name,e==a.accessControl[c].networkObjects[d].rules[b].name&&(a.showNetObj.splice(g,1),a.netObjsArr.splice(g,1),a.netObjsIPArr.splice(g,1),g--)}a.setPrintArr(0);a.initVars()})})})});a.schedArrLen=1;a.schedArr=g.query(function(){for(var b=0;b<a.schedArr.length;b++)a.schedArr[b].name=unescape(a.schedArr[b].name);a.schedArrLen=a.schedArr.length-1});a.pfRulesLen=1;a.pfRules=f.query(function(){a.pfRulesLen=a.pfRules.length+1;a.pfRules=sortListItems(a.pfRules);a.pfRulesCopy=copyArrayFromSource(a.pfRules)})};
a.refresh();a.toggleMain=function(b){a.runFocus=!0;a.showAdd=!a.showAdd;a.pageToShow=0;a.netObj=-2;a.prot=-2;a.sched=-2;a.editIndex=-1;if(a.showAdd){a.ruleType=b;a.pageTitle="Add";for(b=0;b<a.showNetObj.length;b++)a.showNetObj[b]=!0;a.setPrintArr(1);a.calculateShowingNetObjects()}else a.refresh();window.scrollTo(0,0)};a.loadDeviceData=function(b){a.devices=h.query(function(){a.devices=filterOutGuest(a.devices)});a.macSelect=-1;a.togglePage(2)};a.togglePage=function(b){a.runFocus=!0;a.pageToShow=b;
a.netObj=-2;a.prot=-2;0==b&&(a.showAdd=!0,a.setPrintArr(1));7==b&&(a.runFocus=!0);window.scrollTo(0,0)};a.checkSimilarAccessControl=function(b){if(-2==a.sched)b.schedule1={};else if(-1!=a.sched)for(var c=0;c<a.schedArr.length;c++){if(a.sched==a.schedArr[c].name){b.schedule1={};copySchedule(b.schedule1,a.schedArr[c]);break}}else-1==a.sched&&(b.schedule1={},copySchedule(b.schedule1,a.schedule));var d=!0,e=!0,g=!0,f=!0,h=f=!1;if(0<a.accessControl.length)for(c=0;c<a.accessControl.length;c++)if(g=e=d=
!0,f=!1,!0==a.accessControl[c].blockRule&&(f=!0),c!=a.editing&&f==a.ruleType&&(f=compareAllSchedules(b.schedule1,a.accessControl[c].schedule,a.sched),!0==f&&(g=compareServices(b.services,a.accessControl[c].services),!0==g&&(e=compareNetworkObjects(b.networkObjects,a.accessControl[c].networkObjects),!0==e&&(d=compareHosts(b.hosts,a.accessControl[c].hosts)))),d&&e&&g&&f)){h=!0;break}return h};a.createAccessControl=function(b){if(null==b){b={networkObjects:[],services:[],schedule:[],hosts:[],enabled:!0,
networkObjects:[]};copyNetworkObjs(b.networkObjects,a.networkObjects,!0);copyServices(b.services,a.services);-2!==a.sched&&copySchedule(b.schedule,a.schedule);for(var d=0;d<b.networkObjects.length;d++)0<b.networkObjects[d].rules.length&&4==b.networkObjects[d].rules[0].networkObjType&&"DHCP"==b.networkObjects[d].name&&b.hosts.push(a.getDeviceIp(b.networkObjects[d].rules[0].hostname,b.networkObjects[d].rules[0].ipAddress))}for(d=0;d<b.networkObjects.length;d++)0<b.networkObjects[d].rules.length&&4==
b.networkObjects[d].rules[0].networkObjType&&"DHCP"==b.networkObjects[d].name&&(b.networkObjects.splice(d,1),d--);-2==a.sched?b.schedule="":-1!=a.sched?b.schedule=escape(a.sched):-1==a.sched&&(b.schedule={},b.scheduleEditable=!0,a.schedule.name=escape(a.schedule.name).replace(/\+/g,"%2B"),copySchedule(b.schedule,a.schedule));b.blockRule=a.ruleType;-1==a.editing?c.save(b,function(){a.accessControl=[];a.initVars();a.toggleMain()}):c.update({id:a.accessControl[a.editing].id},b,function(){a.accessControl=
[];a.initVars();a.toggleMain()})};a.applyMain=function(){a.errorMessages=[];var b={networkObjects:[],services:[],schedule:[],hosts:[],enabled:!0,networkObjects:[]};copyNetworkObjs(b.networkObjects,a.networkObjects,!0);copyServices(b.services,a.services);if(0<b.services.length)for(var c=0;c<b.services.length;c++)for(var d=0;d<a.pfRulesCopy.length;d++)if(b.services[c].name==a.pfRulesCopy[d].name){b.services[c].id=a.pfRulesCopy[d].id;b.services[c].serviceType=a.pfRulesCopy[d].serviceType;break}-2!==
a.sched&&copySchedule(b.schedule,a.schedule);for(c=0;c<b.networkObjects.length;c++)0<b.networkObjects[c].rules.length&&4==b.networkObjects[c].rules[0].networkObjType&&"DHCP"==b.networkObjects[c].name&&b.hosts.push(a.getDeviceIp(b.networkObjects[c].rules[0].hostname,b.networkObjects[c].rules[0].ipAddress));if(-2==a.sched)b.schedule1={};else if(-1!=a.sched)for(c=0;c<a.schedArr.length;c++){if(a.sched==a.schedArr[c].name){b.schedule1={};copySchedule(b.schedule1,a.schedArr[c]);break}}else-1==a.sched&&
(b.schedule1={},copySchedule(b.schedule1,a.schedule));a.sysSettings.warnBeforeChanges?!0==a.checkSimilarAccessControl(b)?a.togglePage(8):a.createAccessControl(b):a.createAccessControl(b)};a.cancelMain=function(){a.accessControl=[];a.initVars();a.toggleMain()};a.editAccessControl=function(b){a.toggleMain();a.pageTitle="Edit";a.editIndex=b;a.ruleType=a.accessControl[b].blockRule;copyNetworkObjs(a.networkObjects,a.accessControl[b].networkObjects);copyServices(a.services,a.accessControl[b].services);
void 0!=a.accessControl[b].schedule&&""!==a.accessControl[b]?a.accessControl[b].scheduleEditable?(a.sched=-1,copySchedule(a.schedule,a.accessControl[b].schedule),a.printSchedArr=[],printSchedule(1,[a.schedule],a.printSchedArr),a.schedule.name=unescape(a.schedule.name)):a.sched=unescape(a.accessControl[b].schedule.name):a.sched=-2;for(var c=0;c<a.services.length;c++){for(var d=0;d<a.pfRules.length;d++)if(a.services[c].name==a.pfRules[d].name){a.services[c].id=a.pfRules[d].id;a.services[c].serviceType=
a.pfRules[d].serviceType;a.pfRules.splice(d,1);break}a.services[c].name=unescape(a.services[c].name);a.services[c].description=unescape(a.services[c].description);a.services[c].displayName=a.services[c].name;void 0!=a.services[c].description&&"undefined"!=a.services[c].description&&a.services[c].description&&0<a.services[c].description.length&&(a.services[c].displayName+=" - "+a.services[c].description)}a.editing=b;a.calculateShowingNetObjects();a.setPrintArr(1)};a.calculateShowingNetObjects=function(){a.devices=
h.query(function(){a.devices=filterOutGuest(a.devices);a.netObjs=d.query(function(){a.netObjsIPArr=[];a.showNetObj=[];a.netObjsArr=[];for(var b=[],c=0;c<a.netObjs.length;c++){for(var b=[],d=0;d<a.netObjs[c].rules.length;d++){b.push(a.netObjs[c].rules[d].ipAddress);var e={type:1,name:a.netObjs[c].name,index:c,ipAddress:a.netObjs[c].rules[d].ipAddress};e.deviceDisplayName=void 0!=e.ipAddress&&""!=e.ipAddress?e.ipAddress+" - "+e.name:e.name}a.netObjsIPArr.push(b);a.netObjsArr.push(e);a.showNetObj.push(!0)}for(c=
0;c<a.devices.length;c++)a.devices[c].isStb||(e={type:2,name:a.devices[c].name,ipAddress:a.devices[c].ipAddress},e.deviceDisplayName=void 0!=e.ipAddress&&""!=e.ipAddress?e.ipAddress+" - "+e.name:e.name,a.netObjsArr.push(e),a.showNetObj.push(!0),a.netObjsIPArr.push([]));for(c=0;c<a.netObjsArr.length;c++)if(b=!1,void 0!=a.netObjsArr[c]){if(0==a.netObjsArr[c].type)for(d=0;d<a.networkObjects.length;d++){if(e=a.networkObjects[d],6==e.rules[0].networkObjType&&e.rules[0].hostname==a.netObjsArr[c].name){b=
!0;break}}else if(1==a.netObjsArr[c].type)for(d=0;d<a.networkObjects.length;d++){if(e=a.networkObjects[d],void 0===e.type&&0==e.rules[0].networkObjType&&e.name==a.netObjsArr[c].name){b=!0;break}}else if(2==a.netObjsArr[c].type)for(d=0;d<a.networkObjects.length;d++){if(e=a.networkObjects[d],(void 0===e.type||4==e.type)&&7==e.rules[0].networkObjType&&e.rules[0].name==a.netObjsArr[c].name&&e.rules[0].ipAddress===a.netObjsArr[c].ipAddress){b=!0;break}}else if(void 0!==a.netObjsArr[c].id)for(d=0;d<a.networkObjects.length;d++)if(a.netObjsArr[c].id===
a.networkObjects[d].id){b=!0;break}a.showNetObj[c]=!b}})})};a.removeAccessControl=function(b){c.remove({id:a.accessControl[b].id},function(){a.refresh()})};a.netObjChanged=function(){a.runFocus=!0;-2!=a.netObj&&(-1==a.netObj?a.togglePage(1):a.addNetObj(a.netObj))};a.addNetObj=function(b){for(var c=-1,d=0,e=0;e<a.showNetObj.length;e++)a.showNetObj[e]&&(c++,c==b&&(d=e));b=d;a.showNetObj[b]=!1;c={rules:[]};0==a.netObjsArr[b].type?(c.name="DNS",c.type=2,b={hostname:a.netObjsArr[b].name,networkObjType:6,
ipAddress:a.netObjsArr[b].ipAddress},c.rules.push(b)):2==a.netObjsArr[b].type?(c.name="DHCP",c.type=4,b={name:a.netObjsArr[b].name,networkObjType:7,ipAddress:a.netObjsArr[b].ipAddress},c.rules.push(b)):(c.name=a.netObjsArr[b].name,c.type=3,copyAddresses(c.rules,a.netObjs[a.netObjsArr[b].index].rules));a.networkObjects.push(c);a.setPrintArr(1);a.netObj=-2};a.applyNetworkObj=function(){a.errorMessages=[];if(""===a.networkObj.name)a.errorMessages.push("Description: A string must be specified.");else for(var b=
0;b<a.networkObjects.length;b++)a.editingNetworkObj!=b&&a.networkObj.name===a.networkObjects[b].name&&a.errorMessages.push("Description: This name is already used by another network object.");0==a.networkObj.rules.length&&a.errorMessages.push("Items: At least one item entry must be defined.");0<a.errorMessages.length?(a.showErrorPage=!0,window.scrollTo(0,0)):applyNetworkObj(a,a.networkObjects)};a.cancelNetworkObj=function(){cancelNetworkObj(a)};a.editNetworkObj=function(b){editNetworkObj(a,a.networkObjects,
b)};a.removeNetworkObj=function(b){removeObject(a.networkObjects,b);a.removeNetObj(b);a.setPrintArr(1);a.calculateShowingNetObjects()};a.removeNetObj=function(b){a.showNetObj[b]=!0};a.copyMacAddress=function(){var b=macSelecter.value;a.rule.mac=-1!=b?splitMacArr(a.devices[b].mac):splitMacArr("00:00:00:00:00:00");a.rule.macMask=splitMacArr("ff:ff:ff:ff:ff:ff")};a.applyAddress=function(){a.runFocus=!0;applyAddressCheck(a);0==a.errorMessages&&applyAddress(a)};a.cancelAddress=function(){cancelAddress(a)};
a.editAddress=function(b){editAddress(a,b)};a.removeAddress=function(b){removeObject(a.networkObj.rules,b)};a.protocolChange=function(){a.runFocus=!0;-2!=a.prot&&(-1==a.prot?a.togglePage(3):a.addPfProt(a.findRuleIndex(a.prot)))};a.findRuleIndex=function(b){for(var c=0;c<a.pfRules.length;c++)if(a.pfRules[c].id==b)return c};a.filterDevice=function(b){for(var c=0;c<a.netObjsArr.length;c++)if(a.netObjsArr[c]==b)return a.showNetObj[c];return!0};a.filterFn=function(a){return/^PortForward\_.*$/.test(a.name)?
!1:!0};a.addPfProt=function(b){var c={name:"",type:2,protocols:[]};copyService(c,a.pfRules[b]);c.displayName=a.pfRules[b].name;c.id=a.pfRules[b].id;c.serviceType=a.pfRules[b].serviceType;void 0!==a.pfRules[b].description&&0<a.pfRules[b].description.length&&(c.displayName+=" - "+a.pfRules[b].description);a.services.push(c);a.setPrintArr(1);a.prot=-2;b=[];for(var d=0;d<a.pfRules.length;d++)c.id!=a.pfRules[d].id&&b.push(a.pfRules[d]);a.pfRules=b};a.applyPortForwardRule=function(){a.errorMessages=[];
""==a.service.name?a.errorMessages.push("Service Name: A name must be specified."):/^[0-9A-Z\!\-\_]+$/i.test(a.service.name)||a.errorMessages.push('Service Name: Rule name should consist of standard characters only (ASCII 32-126) excluding the special character space and any of :@"|\\/=+<>()[]{}&%^$*?,;');for(var b=0;b<a.pfRules.length;b++)b!=a.editing&&a.pfRules[b].name==a.service.name&&a.errorMessages.push("Service Name: This name is already used by another protocol.");0==a.service.protocols.length&&
a.errorMessages.push("Server Ports: At least one server ports entry must be defined.");0<a.errorMessages.length?(a.showErrorPage=!0,window.scrollTo(0,0)):(applyService(a,a.services),b=a.services.length-1,a.services[b].displayName=a.services[b].name)};a.cancelPortForwardRule=function(){cancelService(a)};a.editService=function(b){editService(a,a.services,b)};a.removeService=function(b){for(var c=0;c<a.pfRulesCopy.length;c++)if(a.pfRulesCopy[c].id==a.services[b].id){a.pfRules.push(a.pfRulesCopy[c]);
break}a.pfRules=sortListItems(a.pfRules);removeObject(a.services,b)};a.applyProtocol=function(){a.errorMessages=[];a.protocols.protocol=parseInt(a.protocols.protocol);a.protocols.incomingPorts=parseInt(a.protocols.incomingPorts);a.protocols.outgoingPorts=parseInt(a.protocols.outgoingPorts);a.protocols.icmpMessage=parseInt(a.protocols.icmpMessage);var b=a.protocols.incomingPortStart,c=a.protocols.incomingPortEnd,d=a.protocols.outgoingPortStart,e=a.protocols.outgoingPortEnd;switch(a.protocols.protocol){case 0:var g=
a.protocols.protocolNumber;(null==g||""===g||isNaN(g)||0>g||255<g||!checksForWholeNumber(g))&&a.errorMessages.push("Protocol Number: Please enter a numeric value between 0 and 255.");break;case 1:case 2:switch(a.protocols.incomingPorts){case 1:(null==b||""===b||1>b||65535<b)&&a.errorMessages.push("Source Port: Please enter a numeric value between 1 and 65535.");break;case 2:(null==b||""===b||1>b||65535<b)&&a.errorMessages.push("Start Source Port: Please enter a numeric value between 1 and 65535."),
(null==c||""===c||1>c||65535<c)&&a.errorMessages.push("End Source Port: Please enter a numeric value between 1 and 65535."),0==a.errorMessages.length&&b>=c&&a.errorMessages.push("Source Ports: The From value must be lower than the To value in a range of ports (from="+b+", to="+c+").")}switch(a.protocols.outgoingPorts){case 1:(null==d||""===d||1>d||65535<d)&&a.errorMessages.push("Destination Port: Please enter a numeric value between 1 and 65535.");4567==d&&!1==a.protocols.outgoingExclude&&1==a.protocols.protocol&&
a.errorMessages.push("Invalid rule: Port 4567 cannot be blocked");4577==d&&!1==a.protocols.outgoingExclude&&1==a.protocols.protocol&&a.errorMessages.push("Invalid rule: Port 4577 cannot be blocked");break;case 2:(null==d||""===d||1>d||65535<d)&&a.errorMessages.push("Start Destination Port: Please enter a numeric value between 1 and 65535."),(null==e||""===e||1>e||65535<e)&&a.errorMessages.push("End Destination Port: Please enter a numeric value between 1 and 65535."),0==a.errorMessages.length&&d>=
e&&a.errorMessages.push("Destination Ports: The From value must be lower than the To value in a range of ports (from="+d+", to="+e+").")}break;case 3:if(10==a.protocols.icmpMessage){var g=a.protocols.icmpType,f=a.protocols.icmpCode;(null==g||""===g||0>g||255<g)&&a.errorMessages.push("ICMP Type:  Please enter a numeric value between 0 and 255.");(null==f||""===f||0>f||255<f)&&a.errorMessages.push("ICMP Code:  Please enter a numeric value between 0 and 255.")}}a.protocols.protocolNumber=parseInt(a.protocols.protocolNumber);
0==a.errorMessages.length&&(0==a.protocols.incomingPorts&&(a.protocols.incomingExclude=!1),0==a.protocols.outgoingPorts&&(a.protocols.outgoingExclude=!1),1==a.protocols.protocol||2==a.protocols.protocol)&&(f=g=!1,0==a.protocols.incomingPorts?g=!0:2==a.protocols.incomingPorts&&!1==a.protocols.incomingExclude&&1==b&&65535==c&&(g=!0),0==a.protocols.outgoingPorts?f=!0:2==a.protocols.outgoingPorts&&!1==a.protocols.outgoingExclude&&1==d&&65535==e&&(f=!0),g&&f&&a.errorMessages.push('Port forwarding rules can not be Any-to-Any (or "source: 1-65535" with "destination: 1-65535").'));
0<a.errorMessages.length?(a.showErrorPage=!0,window.scrollTo(0,0)):(a.protocols.protocolNumber=parseInt(a.protocols.protocolNumber),a.protocols.icmpType=parseInt(a.protocols.icmpType),a.protocols.icmpCode=parseInt(a.protocols.icmpCode),applyProtocol(a,a.service.protocols))};a.cancelProtocol=function(){cancelProtocol(a)};a.editProtocol=function(b){editProtocol(a,b,a.service.protocols)};a.removeProtocol=function(b){removeObject(a.service.protocols,b);a.setPrintArr(1)};a.scheduleChange=function(){a.runFocus=
!0;-2!=a.sched&&-1==a.sched&&a.addSchedule()};a.addSchedule=function(){init_schedule(a);a.editingSchedule=!1;a.togglePage(5)};a.applyRuleScheduler=function(){a.runFocus=!0;a.errorMessages=[];""===a.schedule.name&&a.errorMessages.push("Description: A string must be specified.");for(var b=0;b<a.schedArr.length;b++)if(b!=a.editingRuleSchedule&&a.schedArr[b].name==a.schedule.name){a.errorMessages.push("Name: This name is already used by another scheduler rule.");break}0==a.schedule.timeSegments.length&&
a.errorMessages.push("Rule Schedule: At least one time segment should be defined.");if(0<a.errorMessages.length)a.showErrorPage=!0,window.scrollTo(0,0);else{var c={};copySchedule(c,a.schedule);for(b=0;b<c.timeSegments.length;b++)for(var d=0;d<c.timeSegments[b].hourRanges.length;d++)c.timeSegments[b].hourRanges[d].startTimeHour=parseInt(c.timeSegments[b].hourRanges[d].startTimeHour),c.timeSegments[b].hourRanges[d].startTimeMinute=parseInt(c.timeSegments[b].hourRanges[d].startTimeMinute),c.timeSegments[b].hourRanges[d].endTimeHour=
parseInt(c.timeSegments[b].hourRanges[d].endTimeHour),c.timeSegments[b].hourRanges[d].endTimeMinute=parseInt(c.timeSegments[b].hourRanges[d].endTimeMinute);a.schedule=c;a.schedule.name=unescape(a.schedule.name);a.togglePage(0);a.printSchedArr=[];printSchedule(1,[a.schedule],a.printSchedArr)}};a.cancelRuleScheduler=function(){cancelRuleScheduler(a);a.editingSchedule||(a.sched=-2)};a.editRuleScheduler=function(){a.editingSchedule=!0;var b={};copySchedule(b,a.schedule);editRuleScheduler(a,[b],0)};a.removeRuleScheduler=
function(b){a.sched=-2;a.printSchedArr=[]};a.applyTimeSegment=function(){a.errorMessages=[];for(var b=!1,c=0;c<a.daysOfTheWeek.length;c++)a.daysOfTheWeek[c]&&(b=!0);b||a.errorMessages.push("Days of Week: At least one day must be selected.");0==a.hourRanges.length&&a.errorMessages.push("Hours Range: At least one hour range must be set.");0<a.errorMessages.length?a.showErrorPage=!0:applyTimeSegment(a);window.scrollTo(0,0)};a.cancelTimeSegment=function(){cancelTimeSegment(a)};a.editTimeSegment=function(b){editTimeSegment(a,
b)};a.removeTimeSegment=function(b){removeObject(a.schedule.timeSegments,b)};a.applyHourRange=function(){a.runFocus=!0;a.errorMessages=[];var b=a.hourRange.startTimeHour,c=a.hourRange.endTimeHour,d=a.hourRange.startTimeMinute,e=a.hourRange.endTimeMinute;(""===b||isNaN(b)||0>b||23<b)&&a.errorMessages.push("Start Time Hour: Please enter a numeric value between 0 and 23.");(""===c||isNaN(c)||0>c||23<c)&&a.errorMessages.push("End Time Hour: Please enter a numeric value between 0 and 23.");(""===d||isNaN(d)||
0>d||59<d)&&a.errorMessages.push("Start Time Minutes: Please enter a numeric value between 0 and 59.");(""===e||isNaN(e)||0>e||59<e)&&a.errorMessages.push("End Time Minutes: Please enter a numeric value between 0 and 59.");0<a.errorMessages.length?(a.showErrorPage=!0,window.scrollTo(0,0)):(a.hourRange.startTimeHour=parseInt(a.hourRange.startTimeHour),a.hourRange.startTimeMinute=parseInt(a.hourRange.startTimeMinute),a.hourRange.endTimeHour=parseInt(a.hourRange.endTimeHour),a.hourRange.endTimeMinute=
parseInt(a.hourRange.endTimeMinute),applyHourRange(a))};a.cancelHourRange=function(){cancelHourRange(a)};a.editHourRange=function(b){editHourRange(a,b)};a.removeHourRange=function(b){removeObject(a.hourRanges,b)};a.formatTimeString=function(a,b){return(10>a?"0"+a:a)+":"+(10>b?"0"+b:b)};a.keyPress=function(b){13==b.keyCode&&"/firewall/accesscontrol"==l.path()&&(a.showAdd&&0==a.pageToShow&&!a.isSame?a.applyMain():8!=a.pageToShow||a.showErrorPage?1!=a.pageToShow&&2!=a.pageToShow||a.showErrorPage?5!=
a.pageToShow&&6!=a.pageToShow&&7!=a.pageToShow||a.showErrorPage?3!=a.pageToShow||a.showErrorPage?4!=a.pageToShow||a.showErrorPage?a.showAdd||0!=a.pageToShow||a.save():a.applyProtocol():a.applyPortForwardRule():6!=a.pageToShow||a.showErrorPage?7!=a.pageToShow||a.showErrorPage?a.showErrorPage||a.applyRuleScheduler():a.applyHourRange():a.applyTimeSegment():2==a.pageToShow?a.applyAddress():a.applyNetworkObj():a.createAccessControl(null))}}]).controller("PortForwardCtrl",["$scope","$route","PortForward",
"Devices","PortForwardRules","Schedules","DateTimeSettings",function(a,b,c,d,e,f,g){a.tab=b.current.tab;a.section=b.current.section;a.sourcePortType=0;a.destPortType=0;a.showAdvanced=!1;a.ipSelect=-2;a.appToForward=-2;a.showErrorPage=!1;a.portsUsed=[];a.hasPrevValue=null;a.errorPageOk=function(){a.showErrorPage=!1;window.scrollTo(0,0)};a.pf={specifiedIp:[0,0,0,0],servicePortType:0,servicePort:0,schedule:"Always",protocol:{protocol:1,incomingPorts:0,incomingPortStart:65535,incomingPortEnd:0,outgoingPorts:0,
outgoingPortStart:65535,outgoingPortEnd:0}};a.removeBox=[];for(var h=0;h<a.numItems;h++)a.removeBox.push(!1);a.isScheduleActive=isScheduleActive;a.appForward=function(){if(0<=a.appToForward){a.portsUsed=[];for(var b=null,c=0;c<a.pfRules.length;c++)if(a.pfRules[c].id==a.appToForward){b=a.pfRules[c];break}null!=b&&printProtocol(6,b.protocols,a.portsUsed)}};a.save=function(){for(var b=0,d=0,e=0;e<a.portForward.length;e++)a.active[e]!=a.portForward[e].enabled&&(b++,c.update({id:a.portForward[e].id},{enabled:a.active[e]},
function(){d++;d==b&&a.refresh()}))};a.toggleShow=function(){a.showAdvanced=!a.showAdvanced};a.contains=function(a,b){for(var c=0;c<a.length;c++)if(a[c]===b)return!0;return!1};a.refresh=function(){a.portForward=c.query(function(){a.numItems=a.portForward.length;a.printPortsArr=[];printProtocol(1,a.portForward,a.printPortsArr);a.active=[];for(var b=0;b<a.portForward.length;b++)if(a.active.push(a.portForward[b].enabled),/^PortForward\_.*$/.test(a.portForward[b].name)){a.portForward[b].displayName="Destination Ports ";
for(var c=[],h=0;h<a.portForward[b].protocols.length;h++){var m=a.portForward[b].protocols[h];if(1==m.outgoingPorts){if(a.contains(c,m.outgoingPortStart))continue}else if(2==m.outgoingPorts&&a.contains(c,m.outgoingPortStart+"-"+m.outgoingPortEnd))continue;0<h&&(a.portForward[b].displayName+=",");0==m.outgoingPorts?a.portForward[b].displayName+="Any":1==m.outgoingPorts?(a.portForward[b].displayName+=m.outgoingPortStart,c.push(m.outgoingPortStart)):(a.portForward[b].displayName+=m.outgoingPortStart+
"-"+m.outgoingPortEnd,c.push(m.outgoingPortStart+"-"+m.outgoingPortEnd))}}else a.portForward[b].displayName=unescape(a.portForward[b].name);a.dateTimeSettings=g.get(function(){a.localTimeMoment=findTimeNow(a.dateTimeSettings);a.schedules=f.query(function(){for(var b=0;b<a.portForward.length;b++){a.portForward[b].schedActive="Active";for(var c=0;c<a.schedules.length;c++)if(a.portForward[b].schedule==a.schedules[c].name){a.portForward[b].schedActive=isScheduleActive(a.schedules[c],a.localTimeMoment);
break}}for(c=0;c<a.schedules.length;c++)a.schedules[c].name=unescape(a.schedules[c].name)})});null==a.hasPrevValue?a.devices=d.query(function(){for(var b=0;b<a.devices.length;b++)a.devices[b].displayName=a.devices[b].ipAddress!=a.devices[b].name?a.devices[b].ipAddress+" - "+a.devices[b].name:a.devices[b].name;for(b=0;b<a.portForward.length;b++){for(var c=0;c<a.devices.length;c++)if(a.portForward[b].deviceIp==a.devices[c].ipAddress&&a.devices[c].name!==a.devices[c].ipAddress){a.portForward[b].hostname=
a.devices[c].name;a.portForward[b].showIp=!0;break}if(null==a.portForward[b].hostname||""===a.portForward[b].hosname)a.portForward[b].showIp=!1,a.portForward[b].hostname=a.portForward[b].deviceIp}a.devices=filterOutStb(a.devices);a.devices=filterOutGuest(a.devices);a.pfRules=e.query(function(){a.pfRules=sortListItems(a.pfRules);a.pfRulesCopy=copyArrayFromSource(a.pfRules)})}):!0==a.hasPrevValue&&(a.hasPrevValue=null,a.devices1=d.query(function(){for(var b=0;b<a.devices1.length;b++)a.devices1[b].displayName=
a.devices1[b].ipAddress!=a.devices1[b].name?a.devices1[b].ipAddress+" - "+a.devices1[b].name:a.devices1[b].name;for(b=0;b<a.portForward.length;b++){for(var c=0;c<a.devices1.length;c++)if(a.portForward[b].deviceIp==a.devices1[c].ipAddress&&a.devices1[c].name!==a.devices1[c].ipAddress){a.portForward[b].hostname=a.devices1[c].name;a.portForward[b].showIp=!0;break}if(null==a.portForward[b].hostname||""===a.portForward[b].hosname)a.portForward[b].showIp=!1,a.portForward[b].hostname=a.portForward[b].deviceIp}}))})};
a.refresh();a.resolveNow=function(){};a.reset=function(){a.ipSelect=-2;a.appToForward=-2;a.showAdvanced=!1;a.pf={specifiedIp:[0,0,0,0],servicePortType:0,servicePort:0,schedule:"Always",protocol:{protocol:1,incomingPorts:0,incomingPortStart:65535,incomingPortEnd:0,outgoingPorts:0,outgoingPortStart:65535,outgoingPortEnd:0}}};a.add=function(){a.errorMessages=[];-2==a.ipSelect?a.errorMessages.push("Error: Please select the IP Address you want to forward to, or select an already connected item from the list"):
-1==a.ipSelect&&(validateIp(a.pf.specifiedIp)&&"0.0.0.0"!=getIpString(a.pf.specifiedIp)&&"255.255.255.255"!=getIpString(a.pf.specifiedIp)||a.errorMessages.push("Error: The IP address specified is invalid"));a.pf.protocol.protocol=parseInt(a.pf.protocol.protocol);var b=[],d=[],e=[],g=0,f=0,h=65535,s=0,y=0,x=65535;if(-2==a.appToForward)a.errorMessages.push("Error: Please select a pre-configured application or choose the option Custom ports to create a new application for port forwarding");else if(-1==
a.appToForward)if(!a.showAdvanced&&0==a.errorMessages.length)for(var u=(""+a.pf.protocol.outgoingPortStart).split(","),w=0;w<u.length;w++){var q=u[w].split("-");if(2<q.length)a.errorMessages.push("Error: The input of port has illegal characters. Source port should be 111 or 111-222; Destination port should be 111, or 111-222, or 111,222-333 and so on.");else for(var p=0;p<q.length;p++)""===q[p]||isNaN(q[p])||checkForWholeNumbers(q[p])||!checksForWholeNumber(q[p])?a.errorMessages.push("Error: The input of port has illegal characters. Source port should be 111 or 111-222; Destination port should be 111, or 111-222, or 111,222-333 and so on."):
(1>q[p]||65535<q[p])&&a.errorMessages.push("Error: Port range should be between [1-65535]");1==q.length?(s=1,y=x=parseInt(q[0])):2==q.length&&(s=2,y=parseInt(q[0]),x=parseInt(q[1]));b.push(s);d.push(y);e.push(x)}else if(0==a.errorMessages.length){if(1==a.sourcePortType){q=(""+a.pf.incomingPortStart).split("-");if(2<q.length)a.errorMessages.push("Error: The input of port has illegal characters. Source port should be 111 or 111-222; Destination port should be 111, or 111-222, or 111,222-333 and so on.");
else for(p=0;p<q.length;p++)""===q[p]||isNaN(q[p])||checkForWholeNumbers(q[p])||!checksForWholeNumber(q[p])?a.errorMessages.push("Error: The input of port has illegal characters. Source port should be 111 or 111-222; Destination port should be 111, or 111-222, or 111,222-333 and so on."):(1>q[p]||65535<q[p])&&a.errorMessages.push("Error: Port range should be between [1-65535]");1==q.length?(g=1,f=h=parseInt(q[0])):2==q.length&&(g=2,f=parseInt(q[0]),h=parseInt(q[1]))}if(1==a.destPortType&&0==a.errorMessages.length)for(u=
(""+a.pf.outgoingPortStart).split(","),w=0;w<u.length;w++){q=u[w].split("-");if(2<q.length)a.errorMessages.push("Error: The input of port has illegal characters. Destination port should be 111 or 111-222; Destination port should be 111, or 111-222, or 111,222-333 and so on.");else for(p=0;p<q.length;p++)""===q[p]||isNaN(q[p])||checkForWholeNumbers(q[p])||!checksForWholeNumber(q[p])?a.errorMessages.push("Error: The input of port has illegal characters. Destination port should be 111 or 111-222; Destination port should be 111, or 111-222, or 111,222-333 and so on."):
(1>q[p]||65535<q[p])&&a.errorMessages.push("Error: Port range should be between [1-65535]");1==q.length?(s=1,y=x=parseInt(q[0])):2==q.length&&(s=2,y=parseInt(q[0]),x=parseInt(q[1]));b.push(s);d.push(y);e.push(x)}}a.showAdvanced&&1==a.pf.servicePortType&&0==a.errorMessages.length&&(""===a.pf.servicePort||isNaN(a.pf.servicePort)||0>a.pf.servicePort||65535<a.pf.servicePort||!checksForWholeNumber(a.pf.servicePort))&&a.errorMessages.push("Forward to Port: Please enter a numeric value between 0 and 65535.");
0==b.length&&(b.push(s),d.push(y),e.push(x));0==a.errorMessages.length&&-1==a.appToForward&&(s=u=!1,!0==a.showAdvanced?0==a.sourcePortType?u=!0:1==a.sourcePortType&&(p=(""+a.pf.incomingPortStart).split("-"),2==p.length&&1==p[0]&&65535==p[1]&&(u=!0)):u=!0,!0==a.showAdvanced?0==a.destPortType?s=!0:1==a.destPortType&&(p=(""+a.pf.outgoingPortStart).split("-"),2==p.length&&1==p[0]&&65535==p[1]&&(s=!0)):(p=(""+a.pf.protocol.outgoingPortStart).split("-"),2==p.length&&1==p[0]&&65535==p[1]&&(s=!0)),u&&s&&
a.errorMessages.push('Port forwarding rules can not be Any-to-Any (or "source: 1-65535" with "destination: 1-65535").'));if(0==a.errorMessages.length&&0<=a.appToForward){w=null;for(p=0;p<a.pfRules.length;p++)if(a.pfRules[p].id==a.appToForward){w=a.pfRules[p];break}if(null==w)return;for(p=0;p<w.protocols.length;p++)if(!w.protocols[p].protocolExclude&&!w.protocols[p].outgoingExclude){var s=w.protocols[p].outgoingPortStart,x=w.protocols[p].outgoingPortEnd,y=w.name,A=s,u=w.protocols[p].protocol,G=!1;
void 0!==x&&s!=x&&(A+="-"+x);void 0===x&&(x=s);for(A=0;A<a.portForward.length;A++)for(q=0;q<a.portForward[A].protocols.length;q++){var t=a.portForward[A].protocols[q];if(7!=u||!(1>t.protocol||2<t.protocol))if(7==u||u==t.protocol){void 0!=s||u!=t.protocol||0!=u&&3!=u&&4!=u&&5!=u&&6!=u||(G=!0);var z="";if(0==t.outgoingPorts)z="Any";else if(1==t.outgoingPorts&&s<=t.outgoingPortStart&&x>=t.outgoingPortStart)z=t.outgoingPortStart;else if(2==t.outgoingPorts&&s<=t.outgoingPortStart&&x>=t.outgoingPortStart||
s<=t.outgoingPortEnd&&x>=t.outgoingPortEnd||s>=t.outgoingPortStart&&x<=t.outgoingPortEnd)z=t.outgoingPortStart+" -> "+t.outgoingPortEnd;if(""!=z||G){t="Conflicting Port Forwarding Rules: The "+y+" service conflict with an existing port forwarding rule offering "+y+" service.";z=!0;if(0<a.errorMessages.length)for(p=0;p<a.errorMessages.length;p++)if(a.errorMessages[p]==t){z=!1;break}z&&a.errorMessages.push(t)}}}}}if(0==a.errorMessages.length&&-1==a.appToForward)for(w=0;w<b.length;w++){s=b[w];y=d[w];
x=e[w];u=parseInt(a.pf.protocol.protocol);if(1==u||7==u)4567==y&&4567==x&&a.errorMessages.push("Invalid rule: Port 4567 cannot be blocked"),4577==y&&4577==x&&a.errorMessages.push("Invalid rule: Port 4577 cannot be blocked");if(0==s)for(p=0;p<a.portForward.length;p++)for(q=0;q<a.portForward[p].protocols.length;q++){if(t=a.portForward[p].protocols[q],7!=u||!(1>t.protocol||2<t.protocol))if(7==u||u==t.protocol)z="",z=0==t.outgoingPorts?"Any":1==t.outgoingPorts?t.outgoingPortStart:t.outgoingPortStart+
" -> "+t.outgoingPortEnd,a.errorMessages.push("Conflicting Port Forwarding Rules: The Destination Ports Any service conflict with an existing port forwarding rule offering Destination Ports "+z+" service.")}else for(A=s=y,u=a.pf.protocol.protocol,s!=x&&(A+="-"+x),p=0;p<a.portForward.length;p++)for(q=0;q<a.portForward[p].protocols.length;q++)if(t=a.portForward[p].protocols[q],y=a.portForward[p].name,7!=u||!(1>t.protocol||2<t.protocol))if(7==u||u==t.protocol){z="";if(0==t.outgoingPorts)z="Any";else if(1==
t.outgoingPorts&&s<=t.outgoingPortStart&&x>=t.outgoingPortStart)z=t.outgoingPortStart;else if(2==t.outgoingPorts&&s<=t.outgoingPortStart&&x>=t.outgoingPortStart||s<=t.outgoingPortEnd&&x>=t.outgoingPortEnd||s>=t.outgoingPortStart&&x<=t.outgoingPortEnd)z=t.outgoingPortStart+" -> "+t.outgoingPortEnd;""!=z&&(0<=y.indexOf("_")?a.errorMessages.push("Conflicting Port Forwarding Rules: The Destination Ports "+A+" service conflict with an existing port forwarding rule offering  Destination Ports "+z+" service."):
a.errorMessages.push("Conflicting Port Forwarding Rules: The Destination Ports "+A+" service conflict with an existing port forwarding rule offering "+y+" service."))}}if(0<a.errorMessages.length)a.showErrorPage=!0,window.scrollTo(0,0);else{y=x=w=s=!1;p=parseInt(a.pf.protocol.protocol);u={enabled:!0};-1==a.ipSelect?u.deviceIp=getIpString(a.pf.specifiedIp):0<=a.ipSelect&&(u.deviceIp=a.devices[a.ipSelect].ipAddress);if(-1==a.appToForward)if(u.name="PortForward_"+(new Date).getTime(),u.protocols=[],
7==p)for(p=0;p<b.length;p++)y=x=w=s=!1,q={protocol:1},q.incomingPorts=g,q.incomingPortStart=f,!1==x&&(q.incomingPortEnd=h),q.incomingExclude=s,q.outgoingPorts=b[p],q.outgoingPortStart=d[p],!1==y&&(q.outgoingPortEnd=e[p]),q.outgoingExclude=w,u.protocols.push(q),q={protocol:2},q.incomingPorts=g,q.incomingPortStart=f,!1==x&&(q.incomingPortEnd=h),q.incomingExclude=s,q.outgoingPorts=b[p],q.outgoingPortStart=d[p],!1==y&&(q.outgoingPortEnd=e[p]),q.outgoingExclude=w,u.protocols.push(q);else for(p=0;p<b.length;p++)y=
x=w=s=!1,q={},q.protocol=a.pf.protocol.protocol,q.incomingPorts=g,q.incomingPortStart=f,!1==x&&(q.incomingPortEnd=h),q.incomingExclude=s,q.outgoingPorts=b[p],q.outgoingPortStart=d[p],!1==y&&(q.outgoingPortEnd=e[p]),q.outgoingExclude=w,u.protocols.push(q);else if(0<=a.appToForward){b=null;for(p=0;p<a.pfRules.length;p++)if(a.pfRules[p].id==a.appToForward){b=a.pfRules[p];break}null!=b&&(u.protocols=b.protocols,u.name=escape(b.name).replace(/\+/g,"%2B"))}a.showAdvanced?(u.schedule=a.pf.schedule,u.schedule=
escape(u.schedule).replace(/\+/g,"%2B"),u.servicePort=0==a.pf.servicePortType?0:parseInt(a.pf.servicePort)):(u.servicePort=0,u.schedule="Always");c.save(u,function(){a.refresh()});a.reset()}};a.remove=function(){for(var b=[],c=0;c<a.portForward.length;c++)a.removeBox[c]&&b.push(a.portForward[c].id);if(0<b.length){for(c=0;c<b.length;c++)b[c]-=c;a.removeListItems(b)}a.removeBox=[];for(c=0;c<a.portForward.length;c++)a.removeBox.push(!1)};a.removeListItems=function(b){0<b.length?c.remove({id:b[h]},function(){b.splice(0,
1);a.removeListItems(b)}):(a.hasPrevValue=!0,a.refresh())};a.filterFn=function(a){return/^PortForward\_.*$/.test(a.name)?!1:!0}}]).controller("PortTriggerCtrl",["$scope","$route","PortTrigger","$location",function(a,b,c,d){a.tab=b.current.tab;a.section=b.current.section;a.pageToShow=0;a.protNameArr="Other TCP UDP ICMP GRE ESP AH".split(" ");a.prot=0;a.incoming=!1;a.runFocus=!1;a.initVars=function(){init_services(a);a.tempTrigger={enabled:!0,name:"Application",outgoing:[],incoming:[]};a.editing=-1};
a.errorPageOk=function(){a.showErrorPage=!1;window.scrollTo(0,0)};a.setPrintArr=function(b){a.printOutArr=[];a.printInArr=[];switch(b){case 3:printProtocol(3,a.portTrigger,a.printOutArr,a.printInArr);break;case 2:printProtocol(2,a.tempTrigger.outgoing,a.printOutArr),printProtocol(2,a.tempTrigger.incoming,a.printInArr)}};a.refresh=function(){a.portTrigger=c.query(function(){a.active=[];for(var b=0;b<a.portTrigger.length;b++)a.active.push(a.portTrigger[b].enabled);a.setPrintArr(3);a.initVars()})};a.refresh();
a.save=function(){for(var b=0,d=0,g=0;g<a.portTrigger.length;g++)a.active[g]!=a.portTrigger[g].active&&(b++,c.update({id:a.portTrigger[g].id},{enabled:a.active[g]},function(){d++;d==b&&a.refresh()}))};a.togglePage=function(b){a.pageToShow=b;3==b?a.setPrintArr(2):4==b?a.incoming=!1:5==b&&(a.incoming=!0);a.prot=0;window.scrollTo(0,0)};a.applyTrigger=function(){a.errorMessages=[];var b={outgoing:[],incoming:[]};copyTrigger(b,a.tempTrigger);""==b.name?a.errorMessages.push("Service Name: A name must be specified."):
/^[0-9A-Z\!\-\_]+$/i.test(b.name)||a.errorMessages.push('Service Name: Rule name should consist of standard characters only (ASCII 32-126) excluding the special character space and any of :@"|\\/=+<>()[]{}&%^$*?,;');0==b.outgoing.length&&a.errorMessages.push("Server Ports: At least one server ports entry must be defined.");0<a.errorMessages.length?(a.showErrorPage=!0,window.scrollTo(0,0)):(-1===a.editing?c.save(b,function(){a.refresh()}):c.update({id:a.portTrigger[a.editing].id},b,function(){a.refresh()}),
a.initVars(),a.togglePage(0))};a.applyProtocol=function(){a.runFocus=!0;a.errorMessages=[];a.protocols.protocol=parseInt(a.protocols.protocol);a.protocols.incomingPorts=parseInt(a.protocols.incomingPorts);a.protocols.outgoingPorts=parseInt(a.protocols.outgoingPorts);a.protocols.icmpMessage=parseInt(a.protocols.icmpMessage);var b=a.protocols.incomingPortStart,c=a.protocols.incomingPortEnd,d=a.protocols.outgoingPortStart,h=a.protocols.outgoingPortEnd;switch(a.protocols.protocol){case 0:var k=a.protocols.protocolNumber;
(null==k||""===k||isNaN(k)||0>k||255<k||!checksForWholeNumber(k))&&a.errorMessages.push("Protocol Number: Please enter a numeric value between 0 and 255.");break;case 1:case 2:switch(a.protocols.incomingPorts){case 1:(null==b||""===b||1>b||65535<b)&&a.errorMessages.push("Source Port: Please enter a numeric value between 1 and 65535.");break;case 2:(null==b||""===b||1>b||65535<b)&&a.errorMessages.push("Start Source Port: Please enter a numeric value between 1 and 65535."),(null==c||""===c||1>c||65535<
c)&&a.errorMessages.push("End Source Port: Please enter a numeric value between 1 and 65535."),0==a.errorMessages.length&&b>=c&&a.errorMessages.push("Source Ports: The From value must be lower than the To value in a range of ports (from="+b+", to="+c+").")}switch(a.protocols.outgoingPorts){case 1:(null==d||""===d||1>d||65535<d)&&a.errorMessages.push("Destination Port: Please enter a numeric value between 1 and 65535.");4567==d&&!1==a.protocols.outgoingExclude&&1==a.protocols.protocol&&a.errorMessages.push("Invalid rule: Port 4567 cannot be blocked");
4577==d&&!1==a.protocols.outgoingExclude&&1==a.protocols.protocol&&a.errorMessages.push("Invalid rule: Port 4577 cannot be blocked");break;case 2:(null==d||""===d||1>d||65535<d)&&a.errorMessages.push("Start Destination Port: Please enter a numeric value between 1 and 65535."),(null==h||""===h||1>h||65535<h)&&a.errorMessages.push("End Destination Port: Please enter a numeric value between 1 and 65535."),0==a.errorMessages.length&&d>=h&&a.errorMessages.push("Destination Ports: The From value must be lower than the To value in a range of ports (from="+
d+", to="+h+").")}break;case 3:if(10==a.protocols.icmpMessage){var k=a.protocols.icmpType,l=a.protocols.icmpCode;(null==k||""===k||0>k||255<k)&&a.errorMessages.push("ICMP Type:  Please enter a numeric value between 0 and 255.");(null==l||""===l||0>l||255<l)&&a.errorMessages.push("ICMP Code:  Please enter a numeric value between 0 and 255.")}}a.protocols.protocolNumber=parseInt(a.protocols.protocolNumber);0==a.errorMessages.length&&(0==a.protocols.incomingPorts&&(a.protocols.incomingExclude=!1),0==
a.protocols.outgoingPorts&&(a.protocols.outgoingExclude=!1),1==a.protocols.protocol||2==a.protocols.protocol)&&(l=k=!1,0==a.protocols.incomingPorts?k=!0:2==a.protocols.incomingPorts&&!1==a.protocols.incomingExclude&&1==b&&65535==c&&(k=!0),0==a.protocols.outgoingPorts?l=!0:2==a.protocols.outgoingPorts&&!1==a.protocols.outgoingExclude&&1==d&&65535==h&&(l=!0),k&&l&&a.errorMessages.push('Port forwarding rules can not be Any-to-Any (or "source: 1-65535" with "destination: 1-65535").'));var r={outgoing:[],
incoming:[]};copyTrigger(r,a.tempTrigger);var m=l=k="",n=!1,b=!1,v,s,c=!1;s=v="";var y=!1,x=!1,u,w,q=!1;if(1==a.protocols.protocol||2==a.protocols.protocol){1==a.protocols.protocol?k="TCP":2==a.protocols.protocol&&(k="UDP");for(var c=a.protocols.incomingPortEnd,b=a.protocols.incomingPortStart,h=a.protocols.outgoingPortEnd,d=a.protocols.outgoingPortStart,y=2==a.protocols.incomingPorts?!0:!1,n=2==a.protocols.outgoingPorts?!0:!1,r=!1==a.incoming?r.outgoing:r.incoming,p=0;p<r.length;p++)if(a.protocols.protocol==
r[p].protocol&&a.tempIndex!=p&&(u=r[p].incomingPortEnd,w=r[p].incomingPortStart,x=null==u||""===u?!1:!0,q=!1,y?x?Number(b)>=Number(w)&&Number(b)<=Number(u)?(v=w+"-"+u,s=b+"-"+c,q=!0):Number(c)>=Number(w)&&Number(c)<=Number(u)?(v=w+"-"+u,s=b+"-"+c,q=!0):Number(w)>=Number(b)&&Number(w)<=Number(c)?(v=w+"-"+u,s=b+"-"+c,q=!0):Number(u)>=Number(b)&&Number(u)<=Number(c)&&(v=w+"-"+u,s=b+"-"+c,q=!0):Number(w)>=Number(b)&&Number(w)<=Number(c)&&(v=w,s=b+"-"+c,q=!0):x?Number(b)>=Number(w)&&Number(b)<=Number(u)&&
(v=w+"-"+u,s=d,q=!0):Number(b)==Number(w)&&(v=w,s=b,q=!0),q)){a.errorMessages.push("Overlapping Port Ranges: The "+k+" source ports ("+s+") is overlapping with already defined "+k+" source ports ("+v+").");break}for(p=0;p<r.length;p++)if(a.protocols.protocol==r[p].protocol&&a.tempIndex!=p&&(v=r[p].outgoingPortEnd,s=r[p].outgoingPortStart,b=null==v||""===v?!1:!0,c=!1,n?b?Number(d)>=Number(s)&&Number(d)<=Number(v)?(l=s+"-"+v,m=d+"-"+h,c=!0):Number(h)>=Number(s)&&Number(h)<=Number(v)?(l=s+"-"+v,m=d+
"-"+h,c=!0):Number(s)>=Number(d)&&Number(s)<=Number(h)?(l=s+"-"+v,m=d+"-"+h,c=!0):Number(v)>=Number(d)&&Number(v)<=Number(h)&&(l=s+"-"+v,m=d+"-"+h,c=!0):Number(s)>=Number(d)&&Number(s)<=Number(h)&&(l=s,m=d+"-"+h,c=!0):b?Number(d)>=Number(s)&&Number(d)<=Number(v)&&(l=s+"-"+v,m=d,c=!0):Number(d)==Number(s)&&(l=s,m=d,c=!0),c)){a.errorMessages.push("Overlapping Port Ranges: The "+k+" destination ports ("+m+") is overlapping with already defined "+k+" destination ports ("+l+").");break}}0<a.errorMessages.length?
(a.showErrorPage=!0,window.scrollTo(0,0)):(a.protocols.protocolNumber=parseInt(a.protocols.protocolNumber),a.protocols.icmpType=parseInt(a.protocols.icmpType),a.protocols.icmpCode=parseInt(a.protocols.icmpCode),a.incoming?applyProtocol(a,a.tempTrigger.incoming):applyProtocol(a,a.tempTrigger.outgoing))};a.cancelTrigger=function(){a.refresh();a.togglePage(0)};a.cancelProtocol=function(){cancelProtocol(a)};a.editTrigger=function(b){a.editing=b;a.tempTrigger={enabled:a.portTrigger[b].enabled,name:a.portTrigger[b].name,
outgoing:[],incoming:[]};copyTrigger(a.tempTrigger,a.portTrigger[b]);a.togglePage(3)};a.editOutgoingProtocol=function(b){editProtocol(a,b,a.tempTrigger.outgoing);a.incoming=!1;a.tempIndex=b};a.editIncomingProtocol=function(b){editProtocol(a,b,a.tempTrigger.incoming,5);a.incoming=!0;a.tempIndex=b};a.removeTrigger=function(b){c.remove({id:a.portTrigger[b].id},function(){a.refresh()})};a.removeOutgoingProtocol=function(b){removeObject(a.tempTrigger.outgoing,b)};a.removeIncomingProtocol=function(b){removeObject(a.tempTrigger.incoming,
b)};a.keyPress=function(b){13==b.keyCode&&"/firewall/porttrigger"==d.path()&&(4!=a.pageToShow&&5!=a.pageToShow||a.showErrorPage?3!=a.pageToShow||a.showErrorPage?0==a.pageToShow&&a.save():a.applyTrigger():a.applyProtocol())}}]).controller("RemoteAdminCtrl",["$scope","$route","$routeParams","$location","RemoteAdmin","SystemSettings",function(a,b,c,d,e,f){a.tab=b.current.tab;a.section=b.current.section;a.sysSettings=f.get();a.remAdmin=e.get();a.fromString="?from=fw";a.prev="";a.oldFrom="";a.back="/firewall";
if(null!=c.from){a.fromString="?from="+c.from+"-fw";a.back="/advanced/settings";b=c.from.split("-");c="";for(e=0;e<b.length-1;e++)0!=e&&(c+="-"),c+=b[e];""!==c&&(a.prev="?from="+c)}else a.back="/firewall";a.save=function(){a.remAdmin.$update(function(){""==a.oldFrom?location.reload():d.path(a.back).search({from:a.oldFrom})})};a.keyPress=function(b){13==b.keyCode&&"/firewall/remoteadmin"==d.path()&&a.save()}}]).controller("StaticNATCtrl",["$scope","$route","StaticNAT","Devices","PortForwardRules",
"$location",function(a,b,c,d,e,f){a.tab=b.current.tab;a.section=b.current.section;a.showErrorPage=!1;a.runFocus=!1;a.errorPageOk=function(){a.showErrorPage=!1;window.scrollTo(0,0)};a.pageToShow=0;a.prot=-2;a.initVars=function(){init_services(a);a.statNat={localHost:-1,host:"192.168.1.0",publicIp:splitIpArr("0.0.0.0"),portForwarding:!1,services:[]};a.editing=-1;a.checkEdit=-1};a.initVars();a.setPrintArr=function(b){a.printProtArr=[];switch(b){case 1:printProtocol(1,a.statNat.services,a.printProtArr)}};
a.devices=d.query(function(){a.devices=filterOutStb(a.devices);a.devices=filterOutGuest(a.devices)});a.save=function(){for(var b=0,d=0,e=0;e<a.staticNAT.length;e++)a.enabled[e]!=a.staticNAT[e].active&&(b++,c.update({id:a.staticNAT[e].id},{active:a.enabled[e]},function(){d++;d==b&&a.refresh()}))};a.togglePage=function(b){a.runFocus=!0;a.pageName="Add";a.pageToShow=b;1==b&&(a.prot=-2,a.setPrintArr(1));window.scrollTo(0,0)};a.saveRule=function(){a.errorMessages=[];var b=a.statNat.host.split(".");-1==
a.statNat.localHost&&(validateIpDomain(a.statNat.host)&&validateIp(b)||a.errorMessages.push("Local Host: The value must be a valid IP address."));if(validateIp(a.statNat.publicIp))if(240<=a.statNat.publicIp[0])a.errorMessages.push("Public IP Address: IP Address must be within the range of 0.0.0.0 to 239.255.255.255.");else{var d=getIpString(a.statNat.publicIp);if("0.0.0.0"===d)a.errorMessages.push("NAT/NAPT configuration: IP conflicts between this rule and previous NAT/NAPT rules");else for(b=0;b<
a.staticNAT.length;b++)if(a.checkEdit!=b&&a.staticNAT[b].publicIp===d){a.errorMessages.push("NAT/NAPT configuration: IP conflicts between this rule and previous NAT/NAPT rules");break}}else a.errorMessages.push("Public IP Address: IP address must consist of 4 fields. Each field's value must be between 0 and 255, without any spaces.");if(0<a.errorMessages.length)a.showErrorPage=!0,window.scrollTo(0,0);else{-1!=a.statNat.localHost&&(a.statNat.host=a.statNat.localHost);d={host:a.statNat.host,publicIp:getIpString(a.statNat.publicIp),
portForwarding:a.statNat.portForwarding,services:[],active:!0};if(-1==a.statNat.localHost)d.host=a.statNat.host;else for(b=0;b<a.devices.length;b++)a.statNat.localHost==a.devices[b].id&&(d.host=a.devices[b].ipAddress);copyServices(d.services,a.statNat.services);if(0<d.services.length)for(b=0;b<d.services.length;b++)for(var e=0;e<a.pfRulesCopy.length;e++)d.services[b].name==a.pfRulesCopy[e].name&&(d.services[b].id=a.pfRulesCopy[e].id,d.services[b].serviceType=a.pfRulesCopy[e].serviceType);d.portForwarding||
(d.services=[]);for(b=0;b<d.services.length;b++)d.services[b].name=escape(d.services[b].name).replace(/\+/g,"%2B");-1!=a.checkEdit?c.update({id:a.staticNAT[a.checkEdit].id},d,function(){a.refresh()}):c.save(d,function(){a.refresh()});a.initVars();a.togglePage(0)}};a.refresh=function(){a.staticNAT=c.query(function(){a.enabled=[];for(var b=0;b<a.staticNAT.length;b++){a.enabled.push(a.staticNAT[b].active);for(var c=0;c<a.staticNAT[b].services.length;c++)a.staticNAT[b].services[c].name=unescape(a.staticNAT[b].services[c].name),
a.staticNAT[b].services[c].description=unescape(a.staticNAT[b].services[c].description)}});a.pfRules=e.query(function(){a.pfRules=sortListItems(a.pfRules);a.pfRulesCopy=copyArrayFromSource(a.pfRules)})};a.cancelRule=function(){a.refresh();a.initVars();a.togglePage(0)};a.editRule=function(b){a.statNat={localHost:-1,host:a.staticNAT[b].host,publicIp:splitIpArr(a.staticNAT[b].publicIp),portForwarding:a.staticNAT[b].portForwarding,services:[]};copyServices(a.statNat.services,a.staticNAT[b].services);
for(var c=0;c<a.statNat.services.length;c++){a.statNat.services[c].displayName=a.statNat.services[c].name;a.statNat.services[c].description&&0<a.statNat.services[c].description.length&&(a.statNat.services[c].displayName+=" - "+a.statNat.services[c].description);for(var d=0;d<a.pfRules.length;d++)a.statNat.services[c].name==a.pfRules[d].name&&(a.statNat.services[c].id=a.pfRules[d].id,a.statNat.services[c].serviceType=a.pfRules[d].serviceType,a.pfRules.splice(d,1))}a.editing=b;a.checkEdit=b;a.togglePage(1);
a.pageName="Edit"};a.removeRule=function(b){c.remove({id:a.staticNAT[b].id},function(){a.refresh()})};a.ruleChanged=function(){-2!=a.prot&&(-1==a.prot?a.addService():a.addPfProt(a.findRuleIndex(a.prot)))};a.findRuleIndex=function(b){for(var c=0;c<a.pfRules.length;c++)if(a.pfRules[c].id==b)return c};a.filterFn=function(a){return/^PortForward\_.*$/.test(a.name)?!1:!0};a.addPfProt=function(b){var c={name:"",type:2,protocols:[]};copyService(c,a.pfRules[b]);c.displayName=a.pfRules[b].name;c.id=a.pfRules[b].id;
c.serviceType=a.pfRules[b].serviceType;a.pfRules[b].description&&0<a.pfRules[b].description.length&&(c.displayName+=" - "+a.pfRules[b].description);a.statNat.services.push(c);a.setPrintArr(1);a.prot=-2;b=[];for(var d=0;d<a.pfRules.length;d++)c.id!=a.pfRules[d].id&&b.push(a.pfRules[d]);a.pfRules=b};a.applyPortForwardRule=function(){a.errorMessages=[];""==a.service.name?a.errorMessages.push("Service Name: A name must be specified."):/^[0-9A-Z\!\-\_]+$/i.test(a.service.name)||a.errorMessages.push('Service Name: Rule name should consist of standard characters only (ASCII 32-126) excluding the special character space and any of :@"|\\/=+<>()[]{}&%^$*?,;');
for(var b=0;b<a.pfRules.length;b++)b!=a.editing&&a.pfRules[b].name==a.service.name&&a.errorMessages.push("Service Name: This name is already used by another protocol.");0==a.service.protocols.length&&a.errorMessages.push("Server Ports: At least one server ports entry must be defined.");if(0<a.errorMessages.length)a.showErrorPage=!0,window.scrollTo(0,0);else{applyService(a,a.statNat.services);for(b=0;b<a.statNat.services.length;b++)a.statNat.services[b].displayName=a.statNat.services[b].name,a.statNat.services[b].description&&
0<a.statNat.services[b].description.length&&(a.statNat.services[b].displayName+=" - "+a.statNat.services[b].description);a.setPrintArr(1);a.togglePage(1)}};a.cancelPortForwardRule=function(){cancelService(a);a.togglePage(1)};a.addService=function(){a.editing=-1;a.togglePage(3)};a.editService=function(b){a.editing=b;editService(a,a.statNat.services,b)};a.removeService=function(b){for(var c=0;c<a.pfRulesCopy.length;c++)if(a.pfRulesCopy[c].id==a.statNat.services[b].id){a.pfRules.push(a.pfRulesCopy[c]);
break}a.pfRules=sortListItems(a.pfRules);removeObject(a.statNat.services,b)};a.applyProtocol=function(){a.errorMessages=[];a.protocols.protocol=parseInt(a.protocols.protocol);a.protocols.incomingPorts=parseInt(a.protocols.incomingPorts);a.protocols.outgoingPorts=parseInt(a.protocols.outgoingPorts);a.protocols.icmpMessage=parseInt(a.protocols.icmpMessage);a.protocols.protocolNumber=parseInt(a.protocols.protocolNumber);var b=a.protocols.incomingPortStart,c=a.protocols.incomingPortEnd,d=a.protocols.outgoingPortStart,
e=a.protocols.outgoingPortEnd;switch(a.protocols.protocol){case 0:var f=a.protocols.protocolNumber;(null==f||""===f||isNaN(f)||0>f||255<f)&&a.errorMessages.push("Protocol Number: Please enter a numeric value between 0 and 255.");break;case 1:case 2:switch(a.protocols.incomingPorts){case 1:(null==b||""===b||1>b||65535<b)&&a.errorMessages.push("Source Port: Please enter a numeric value between 1 and 65535.");break;case 2:(null==b||""===b||1>b||65535<b)&&a.errorMessages.push("Start Source Port: Please enter a numeric value between 1 and 65535."),
(null==c||""===c||1>c||65535<c)&&a.errorMessages.push("End Source Port: Please enter a numeric value between 1 and 65535."),0==a.errorMessages.length&&b>=c&&a.errorMessages.push("Source Ports: The From value must be lower than the To value in a range of ports (from="+b+", to="+c+").")}switch(a.protocols.outgoingPorts){case 1:(null==d||""===d||1>d||65535<d)&&a.errorMessages.push("Destination Port: Please enter a numeric value between 1 and 65535.");4567==d&&!1==a.protocols.outgoingExclude&&1==a.protocols.protocol&&
a.errorMessages.push("Invalid rule: Port 4567 cannot be blocked");4577==d&&!1==a.protocols.outgoingExclude&&1==a.protocols.protocol&&a.errorMessages.push("Invalid rule: Port 4577 cannot be blocked");break;case 2:(null==d||""===d||1>d||65535<d)&&a.errorMessages.push("Start Destination Port: Please enter a numeric value between 1 and 65535."),(null==e||""===e||1>e||65535<e)&&a.errorMessages.push("End Destination Port: Please enter a numeric value between 1 and 65535."),0==a.errorMessages.length&&d>=
e&&a.errorMessages.push("Destination Ports: The From value must be lower than the To value in a range of ports (from="+d+", to="+e+").")}break;case 3:if(10==a.protocols.icmpMessage){var f=a.protocols.icmpType,m=a.protocols.icmpCode;(null==f||""===f||0>f||255<f)&&a.errorMessages.push("ICMP Type:  Please enter a numeric value between 0 and 255.");(null==m||""===m||0>m||255<m)&&a.errorMessages.push("ICMP Code:  Please enter a numeric value between 0 and 255.")}}0==a.errorMessages.length&&(0==a.protocols.incomingPorts&&
(a.protocols.incomingExclude=!1),0==a.protocols.outgoingPorts&&(a.protocols.outgoingExclude=!1),1==a.protocols.protocol||2==a.protocols.protocol)&&(m=f=!1,0==a.protocols.incomingPorts?f=!0:2==a.protocols.incomingPorts&&!1==a.protocols.incomingExclude&&1==b&&65535==c&&(f=!0),0==a.protocols.outgoingPorts?m=!0:2==a.protocols.outgoingPorts&&!1==a.protocols.outgoingExclude&&1==d&&65535==e&&(m=!0),f&&m&&a.errorMessages.push('Port forwarding rules can not be Any-to-Any (or "source: 1-65535" with "destination: 1-65535").'));
0<a.errorMessages.length?(a.showErrorPage=!0,window.scrollTo(0,0)):applyProtocol(a,a.service.protocols)};a.cancelProtocol=function(){cancelProtocol(a);a.togglePage(3)};a.editProtocol=function(b){editProtocol(a,b,a.service.protocols)};a.removeProtocol=function(b){removeObject(a.service.protocols,b,2,a)};a.keyPress=function(b){13==b.keyCode&&"/firewall/staticnat"==f.path()&&(0!=a.pageToShow||a.showErrorPage?1!=a.pageToShow||a.showErrorPage?3!=a.pageToShow||a.showErrorPage?4!=a.pageToShow||a.showErrorPage||
a.applyProtocol():a.applyPortForwardRule():a.saveRule():a.save())};a.refresh()}]).controller("FirewallSecurityLogCtrl",["$scope","$route","$http","SecuritySettings","SecurityCsv","SecurityHazard","Log","$location",function(a,b,c,d,e,f,g,h){a.tab=b.current.tab;a.section=b.current.section;a.showSettings=0;a.FDisplayNum=50;a.securitySettings=d.get();a.enableLogging=systemSettings.enableLogging;setupLoggingCtrl(a,1,c,g);a.loadMore=function(b){a.FDisplayNum+=50};a.clearSecLog=function(){a.clearLog();a.showSettings=
0};a.clearLogScreen=function(){systemSettings.warnBeforeChanges?a.showSettings=3:a.clearLog()};a.getTime=function(a){return moment.unix(a).format("MMM DD HH:mm:ss YYYY")};a.save=function(){a.securitySettings.$update(function(){a.showSettings=0;a.securitySettings=d.get()})};a.togglePage=function(b){0==b&&(a.securitySettings=d.get());a.showSettings=b;window.scrollTo(0,0)};a.markViewed=function(){f.update(function(){location.reload()})};a.keyPress=function(a){13==a.keyCode&&"/firewall/log"==h.path()&&
h.path("/firewall")}}]).controller("dmzHostCtrl",["$scope","$route","securityTips","FirewallDMZ","$location","NetworkConnections","PortForward",function(a,b,c,d,e,f,g){a.tab=b.current.tab;a.section=b.current.section;a.portForwardingDisabled=!1;a.ipAddrDisabled=[!1,!1,!1,!1];a.subNetID=[];a.refresh=function(){a.connection=f.get({id:0},function(){a.dmz=d.get(function(){a.listOfNetworkIPAddress=[];var b={};b.id=a.connection.connectionId;b.ip=a.connection.ipAddress;b.name=unescape(a.connection.name);
a.listOfNetworkIPAddress.push(b);a.subNetID=splitIpArr(a.connection.subnetMask);for(b=0;b<a.subNetID.length;b++)"255"==a.subNetID[b]||255==parseInt(a.subNetID[b])?a.ipAddrDisabled[b]=!0:a.ipAddrDisabled[b]=!1;""==a.dmz.ip||"0.0.0.0"==a.dmz.ip?(a.ipAddr=splitIpArr(angular.copy(a.connection.ipAddress)),a.ipAddr[3]=""):a.ipAddr=splitIpArr(a.dmz.ip);a.enabled=a.dmz.enabled});a.portForward=g.query()})};a.refresh();a.toggleOnOff=function(){a.enabled=!a.enabled};a.save=function(){var b={};b.enabled=a.enabled;
b.enabled&&(b.ip=getIpString(a.ipAddr));d.update(b,function(){a.refresh()})};a.checkThenSave=function(){a.errorMessages=[];if(a.enabled)if(validateIp(a.ipAddr)){var b=splitIpArr(a.connection.ipAddress),d=splitIpArr(a.connection.subnetMask);checkAllNetworks(a.listOfNetworkIPAddress,a.ipAddr,1)&&a.errorMessages.push("Local IP Address: The FiOS Quantum Gateway's own IP address("+a.listOfNetworkIPAddress[0].ip+") cannot be used as a DMZ host");checkHostVsSubmask(a.ipAddr,d)&&("0"==checkBits(a.ipAddr)?
a.errorMessages.push("The DMZ Host address must not match the network address of the subnet (.0 if the netmask is 255.255.255.0)."):a.errorMessages.push("The DMZ Host address must not match the broadcast address (.255 if the netmask is 255.255.255.0)."));checkIf2IPAreInTheSameSubnetRange(a.ipAddr,b,d)||a.errorMessages.push("The DMZ Host address must be in the same subnet as the router's LAN address.")}else a.errorMessages.push("IP Address: IP address must consist of 4 fields. Each field's value must be between 0 and 255, without any spaces.");
if(0!=a.errorMessages.length)a.showErrorPage=!0,window.scrollTo(0,0);else{var e;a.enabled&&(a.portForwardingDisabled=!1,checkPortForwarding(a.portForward,a.ipAddr)&&(a.portForwardingDisabled=!0,e="The device with IP address "+getNumIpString(a.ipAddr)+" has an existing port forwarding rule. That port forwarding rule will become redundant with DMZ Host enabled for that IP address."));a.enabled&&a.portForwardingDisabled?c.showDmzSaving("",e,[""]).then(function(b){"cancel"!=b&&void 0!=b&&a.save()}):a.enabled?
c.showDmzSaving1("",[""]).then(function(b){"cancel"==b||void 0==b?a.refresh():a.save()}):a.save()}};a.errorPageOk=function(){a.showErrorPage=!1;window.scrollTo(0,0)};a.cancel=function(){window.scrollTo(0,0);e.url("/firewall")}}]);function init_networkObjs(a){init_networkObj(a);init_address(a)}function init_networkObj(a){a.networkObj={name:"Global Object",type:1,rules:[]};a.editingNetworkObj=-1}function init_address(a){a.rule={networkObjType:0,dhcpType:0,ip:splitIpArr("0.0.0.0"),ipTwo:splitIpArr("0.0.0.0"),mac:splitMacArr("00:00:00:00:00:00"),macMask:splitMacArr("ff:ff:ff:ff:ff:ff"),hostname:""};a.editingAddress=-1}
function applyNetworkObj(a,b){if(-1==a.editingNetworkObj){var c={};copyNetworkObj(c,a.networkObj);b.push(c)}else copyNetworkObj(b[a.editingNetworkObj],a.networkObj);init_networkObj(a);a.togglePage(0)}function applyAddress(a){if(-1==a.editingAddress){var b={};copyAddress(b,a.rule,0);a.networkObj.rules.push(b)}else copyAddress(a.networkObj.rules[a.editingAddress],a.rule,0);init_address(a);a.togglePage(1)}function cancelNetworkObj(a){init_networkObj(a);a.togglePage(0)}
function cancelAddress(a){init_address(a);a.togglePage(1)}function editNetworkObj(a,b,c){copyNetworkObj(a.networkObj,b[c]);a.editingNetworkObj=c;a.togglePage(1)}function editAddress(a,b){copyAddress(a.rule,a.networkObj.rules[b],2);a.editingAddress=b;a.togglePage(2)}function copyNetworkObjs(a,b,c){for(var d=0;d<b.length;d++){var e={};copyNetworkObj(e,b[d],c);a.push(e)}}
function copyNetworkObj(a,b,c){a.name=b.name;a.type=b.type;a.rules=[];if(0!=b.type)if(2==b.type)copyDnsEntry(a.rules,b.rules);else if(4==b.type)for(var d=0;d<b.rules.length;d++){var e={};c?(e.hostname=b.rules[d].name,e.networkObjType=4):(e.name=b.rules[d].name,e.networkObjType=7);e.ipAddress=b.rules[d].ipAddress;a.rules.push(e)}else copyAddresses(a.rules,b.rules)}function copyAddresses(a,b){for(var c=0;c<b.length;c++){var d={};copyAddress(d,b[c],1);a.push(d)}}
function copyAddress(a,b,c){a.networkObjType=parseInt(b.networkObjType);if(0==c)switch(a.networkObjType){case 0:a.ipAddress=getIpString(b.ip);break;case 1:a.ipSubnet=getIpString(b.ip);a.subnetMask=getIpString(b.ipTwo);break;case 2:a.ipStart=getIpString(b.ip);a.ipEnd=getIpString(b.ipTwo);break;case 3:a.mac=getMacString(b.mac);a.macMask=getMacString(b.macMask);break;case 4:a.hostname=b.hostname;break;case 5:a.option=b.hostname;a.dhcpType=b.dhcpType;break;case 7:a.name=b.name}else if(1==c)switch(a.networkObjType){case 0:a.ipAddress=
b.ipAddress;break;case 1:a.ipSubnet=b.ipSubnet;a.subnetMask=b.subnetMask;break;case 2:a.ipStart=b.ipStart;a.ipEnd=b.ipEnd;break;case 3:a.mac=b.mac;a.macMask=b.macMask;break;case 4:a.hostname=b.hostname;break;case 5:a.option=b.option;a.dhcpType=b.dhcpType;break;case 7:a.name=b.name}else if(2==c)switch(a.networkObjType){case 0:a.ip=splitIpArr(b.ipAddress);break;case 1:a.ip=splitIpArr(b.ipSubnet);a.ipTwo=splitIpArr(b.subnetMask);break;case 2:a.ip=splitIpArr(b.ipStart);a.ipTwo=splitIpArr(b.ipEnd);break;
case 3:a.mac=splitMacArr(b.mac);a.macMask=splitMacArr(b.macMask);break;case 4:a.hostname=b.hostname;break;case 5:a.hostname=b.option;a.dhcpType=b.dhcpType;break;case 7:a.name=b.name}}function copyDnsEntry(a,b){for(var c=0;c<b.length;c++){var d={};d.hostname=b[c].hostname;d.networkObjType=6;a.push(d)}}
function printAddressObject(a,b){switch(a.networkObjType){case 0:b.push(a.ipAddress);break;case 1:b.push(a.ipSubnet+" / "+a.subnetMask);break;case 2:a.ipStart==a.ipEnd?b.push(a.ipStart):b.push(a.ipStart+" - "+a.ipEnd);break;case 3:b.push(a.mac+" / "+a.macMask);break;case 4:b.push(a.hostname);break;case 5:switch(a.dhcpType){case 0:b.push("DHCP Option: Vendor Class ID = "+a.option);break;case 1:b.push("DHCP Option: Client ID = "+a.option);break;case 2:b.push("DHCP Option: User Class ID = "+a.option)}break;
case 6:b.push(a.hostname);break;case 7:b.push(a.name)}}function getPrintArrayForAddresses(a,b){for(var c in a)printAddressObject(a[c],b)}
function printAccessControlAddresses(a,b,c){for(var d in a)if(0<=d){var e=[];if(void 0===a[d].networkObjects||null===a[d].networkObjects||0==a[d].networkObjects.length)a[d].displayText=["Any"],e.push("Any");else{a[d].displayText=[];for(var f in a[d].networkObjects)if(0<=f)for(var g in a[d].networkObjects[f].rules)if(0<=g){var h=a[d].networkObjects[f].rules[g];switch(h.networkObjType){case 0:a[d].displayText.push(h.ipAddress);e.push(h.ipAddress);break;case 1:a[d].displayText.push(h.ipSubnet+" / "+
h.subnetMask);e.push(h.ipSubnet+" / "+h.subnetMask);break;case 2:a[d].displayText.push(h.ipStart+" - "+h.ipEnd);e.push(h.ipStart+" - "+h.ipEnd);break;case 3:a[d].displayText.push(h.mac);e.push(h.mac);break;case 4:a[d].displayText.push(h.hostname);for(var k=!1,l=0;l<b.length;l++)if(b[l].name==h.hostname){e.push(b[l].ipAddress);k=!0;break}k||e.push("");break;case 5:switch(h.dhcpType){case 0:e.push("DHCP Option: Vendor Class ID = "+h.option);a[d].displayText.push("DHCP Option: Vendor Class ID = "+h.option);
break;case 1:e.push("DHCP Option: Client ID = "+h.option);a[d].displayText.push("DHCP Option: Client ID = "+h.option);break;case 2:e.push("DHCP Option: User Class ID = "+h.option),a[d].displayText.push("DHCP Option: User Class ID = "+h.option)}break;case 6:e.push(h.hostname);a[d].displayText.push(h.hostname);break;case 7:a[d].displayText.push(h.name);k=!1;for(l=0;l<b.length;l++)if(b[l].name==h.name&&b[l].ipAddress===h.ipAddress){e.push(b[l].ipAddress);k=!0;break}k||e.push("")}}}c.push(e)}}
function printAddresses(a,b,c){if(0==a)for(var d in b){if(0<=d){a=[];if(0==b[d].networkObjects.length)a.push("Any");else for(var e in b[d].networkObjects)getPrintArrayForAddresses(b[d].networkObjects[e].rules,a);c.push(a)}}else if(1==a)for(d in 0==b.length&&(e=[],e.push("Any"),c.push(e)),b)0<=d&&(a=[],getPrintArrayForAddresses(b[d].rules,a),c.push(a));else if(4==a)for(d=0;8>d;d++)for(var f in b[d].filters)printAddresses(1,b[d].filters[f].source,c[d].sourceArr),printAddresses(1,b[d].filters[f].dest,
c[d].destArr);else if(5==a)for(d=0;8>d;d++)for(f in b[d].priorities)printAddresses(1,b[d].priorities[f].source,c[d].sourceArr),printAddresses(1,b[d].priorities[f].dest,c[d].destArr)}function init_services(a){a.protNames="Other TCP UDP ICMP GRE ESP AH".split(" ");a.service={name:"Name",type:1,protocols:[]};a.editingService=-1;init_protocols(a);a.printPortsArr=[]}
function init_protocols(a){a.protocols={protocol:0,protocolExclude:!1,incomingPorts:0,incomingPortStart:1,incomingPortEnd:65535,incomingExclude:!1,outgoingPorts:0,outgoingPortStart:1,outgoingPortEnd:65535,outgoingExclude:!1,icmpMessage:0,icmpType:0,icmpCode:0,protocolNumber:0};a.editingProtocol=-1}function applyService(a,b){if(-1==a.editingService){var c={};copyService(c,a.service);b.push(c)}else copyService(b[a.editingService],a.service);init_services(a);a.togglePage(0)}
function applyProtocol(a,b){if(0==a.protocols.protocol)switch(a.protocols.protocolNumber){case 1:a.protocols.protocol=3;a.protocols.icmpMessage=0;break;case 6:a.protocols.protocol=1;a.protocols.incomingPorts=0;a.protocols.incomingPortStart=0;a.protocols.incomingPortEnd=65535;a.protocols.incomingExclude=!1;a.protocols.outgoingPorts=0;a.protocols.outgoingPortStart=0;a.protocols.outgoingPortEnd=65535;a.protocols.outgoingExclude=!1;break;case 17:a.protocols.protocol=2;a.protocols.incomingPorts=0;a.protocols.incomingPortStart=
0;a.protocols.incomingPortEnd=65535;a.protocols.incomingExclude=!1;a.protocols.outgoingPorts=0;a.protocols.outgoingPortStart=0;a.protocols.outgoingPortEnd=65535;a.protocols.outgoingExclude=!1;break;case 47:a.protocols.protocol=4;break;case 50:a.protocols.protocol=5;break;case 51:a.protocols.protocol=6}if(-1==a.editingProtocol){var c={};copyProtocol(c,a.protocols);b.push(c)}else copyProtocol(b[a.editingProtocol],a.protocols);a.printPortsArr=[];printProtocol(2,a.service.protocols,a.printPortsArr);init_protocols(a);
a.togglePage(3)}function cancelService(a){init_services(a);a.togglePage(0)}function cancelProtocol(a){init_protocols(a);a.togglePage(3)}function editService(a,b,c){copyService(a.service,b[c]);a.printPortsArr=[];printProtocol(2,a.service.protocols,a.printPortsArr);a.editingService=c;a.togglePage(3)}function editProtocol(a,b,c,d){copyProtocol(a.protocols,c[b]);a.editingProtocol=b;void 0!=d?a.togglePage(d):a.togglePage(4)}
function copyServices(a,b){for(var c=0;c<b.length;c++){var d={};copyService(d,b[c]);a.push(d)}}function copyService(a,b){a.name=b.name;a.type=b.type;b.description&&(a.description=b.description);a.protocols=[];for(var c=0;c<b.protocols.length;c++){var d={};copyProtocol(d,b.protocols[c]);a.protocols.push(d)}}
function copyProtocol(a,b){a.protocol=parseInt(b.protocol);a.protocolExclude=b.protocolExclude;switch(b.protocol){case 1:case 2:a.incomingPorts=b.incomingPorts;a.outgoingPorts=b.outgoingPorts;0<b.incomingPorts&&(a.incomingPortStart=b.incomingPortStart,2==b.incomingPorts&&(a.incomingPortEnd=b.incomingPortEnd));0<b.outgoingPorts&&(a.outgoingPortStart=b.outgoingPortStart,2==b.outgoingPorts?a.outgoingPortEnd=b.outgoingPortEnd:3==b.outgoingPorts&&(a.outgoingPortStart=0,a.outgoingPortEnd=0));a.incomingExclude=
b.incomingExclude;a.outgoingExclude=b.outgoingExclude;break;case 3:a.icmpMessage=parseInt(b.icmpMessage);10==b.icmpMessage&&(a.icmpType=b.icmpType,a.icmpCode=b.icmpCode);break;case 0:a.protocolNumber=b.protocolNumber}}
function printProtocolObject(a,b,c){var d="",e=a.protocol;switch(e){case 1:case 2:1==c&&(a.protocolExclude&&(d+="~"),d+=1==e?"TCP ":"UDP ");a.incomingExclude&&(d+="~");0==a.incomingPorts?d+="Any -> ":1==a.incomingPorts?d+=a.incomingPortStart+" -> ":2==a.incomingPorts&&(d+=a.incomingPortStart+" - "+a.incomingPortEnd+" -> ");a.outgoingExclude&&(d+="~");0==a.outgoingPorts?(d+="Any",1==e&&(d+=" ~4567 ~4577")):1==a.outgoingPorts?d+=a.outgoingPortStart:2==a.outgoingPorts?(d=d+a.outgoingPortStart+" - "+
a.outgoingPortEnd,a.outgoingExclude||(4567>=a.outgoingPortStart&&4567<=a.outgoingPortEnd&&1==e&&(d+=" ~4567"),4577>=a.outgoingPortStart&&4577<=a.outgoingPortEnd&&1==e&&(d+=" ~4577"))):3==a.outgoingPorts&&(d+="Same as Initiating Ports");break;case 0:1==c&&(a.protocolExclude&&(d+="~"),d=0==a.protocolNumber?d+"Protocol Any":d+("Protocol "+a.protocolNumber));break;case 3:d="";1==c&&(a.protocolExclude&&(d+="~"),d+="ICMP ");switch(a.icmpMessage){case 0:d+="Echo Reply";break;case 1:d+="Network Unreachable";
break;case 2:d+="Host Unreachable";break;case 3:d+="Protocol Unreachable";break;case 4:d+="Port Unreachable";break;case 5:d+="Destination Network Unknown";break;case 6:d+="Destination Host Unknown";break;case 7:d+="Redirect for Network";break;case 8:d+="Redirect for Host";break;case 9:d+="Echo Request";break;case 10:d+="Type "+a.icmpType+" Code "+a.icmpCode}break;case 4:1==c&&(a.protocolExclude&&(d+="~"),d+="GRE");break;case 5:1==c&&(d="",a.protocolExclude&&(d+="~"),d+="ESP");break;case 6:1==c&&(a.protocolExclude&&
(d+="~"),d+="AH")}b.push(d)}function getPrintArrayForProtocols(a,b,c){for(var d in a)printProtocolObject(a[d],b,c)}function printProtocolWithName(a,b){for(var c in a)if(0<=c){var d=[];if(void 0===a[c].services||null===a[c].services||0==a[c].services.length)d.push("Any");else{var e=0,f;for(f in a[c].services)getPrintArrayForProtocols(a[c].services[f].protocols,d,1),d[e]=a[c].services[f].name+"-"+d[e],e=d.length}b.push(d)}}
function printProtocol(a,b,c,d){if(0==a)for(var e in b){if(0<=e){a=[];if(void 0===b[e].services||null===b[e].services||0==b[e].services.length)a.push("Any");else for(var f in b[e].services)getPrintArrayForProtocols(b[e].services[f].protocols,a,1);c.push(a)}}else if(1==a)for(e in b)0<=e&&(a=[],getPrintArrayForProtocols(b[e].protocols,a,1),c.push(a));else if(2==a)getPrintArrayForProtocols(b,c,0);else if(6==a)getPrintArrayForProtocols(b,c,1);else if(3==a)for(e in b)void 0!==b[e].id&&null!==b[e].id&&
(a=[],getPrintArrayForProtocols(b[e].outgoing,a,1),c.push(a),a=[],getPrintArrayForProtocols(b[e].incoming,a,1),d.push(a));else if(4==a)for(e=0;8>e;e++)for(var g in b[e].filters)printProtocol(1,b[e].filters[g].services,c[e].protArr);else if(5==a)for(e=0;8>e;e++)for(g in b[e].priorities)printProtocol(1,b[e].priorities[g].services,c[e].protArr)}function init_schedules(a){init_schedule(a);init_timeSegment(a);init_hourRange(a);a.printTimeSegArr=[]}
function init_schedule(a){a.schedule={name:"Scheduler Rule",activeDuring:!0,timeSegments:[]};a.editingRuleSchedule=-1}function init_timeSegment(a){a.hourRanges=[];a.daysOfTheWeek=[!1,!1,!1,!1,!1,!1,!1];a.editingTimeSegment=-1}function init_hourRange(a){a.hourRange={startTimeHour:"00",startTimeMinute:"00",endTimeHour:"00",endTimeMinute:"00"};a.editingHourRange=-1}
function applyRuleScheduler(a,b){if(-1==a.editingRuleSchedule){var c={};copySchedule(c,a.schedule);b.push(c)}else copySchedule(b[a.editingRuleSchedule],a.schedule);init_schedule(a);a.togglePage(0)}
function applyTimeSegment(a){if(-1==a.editingTimeSegment){for(var b={daysOfTheWeek:[],hourRanges:[]},c=0;7>c;c++)a.daysOfTheWeek[c]&&b.daysOfTheWeek.push(c);for(c=0;c<a.hourRanges.length;c++){var d={startTimeMinute:a.hourRanges[c].startTimeMinute,startTimeHour:a.hourRanges[c].startTimeHour,endTimeHour:a.hourRanges[c].endTimeHour,endTimeMinute:a.hourRanges[c].endTimeMinute};b.hourRanges.push(d)}a.schedule.timeSegments.push(b)}else{a.schedule.timeSegments[a.editingTimeSegment].daysOfTheWeek=[];a.schedule.timeSegments[a.editingTimeSegment].hourRanges=
[];for(c=0;7>c;c++)a.daysOfTheWeek[c]&&a.schedule.timeSegments[a.editingTimeSegment].daysOfTheWeek.push(c);for(c=0;c<a.hourRanges.length;c++)d={startTimeHour:a.hourRanges[c].startTimeHour,startTimeMinute:a.hourRanges[c].startTimeMinute,endTimeHour:a.hourRanges[c].endTimeHour,endTimeMinute:a.hourRanges[c].endTimeMinute},a.schedule.timeSegments[a.editingTimeSegment].hourRanges.push(d)}a.printTimeSegArr=[];printSchedule(2,a.schedule.timeSegments,a.printTimeSegArr);init_timeSegment(a);a.togglePage(5)}
function applyHourRange(a){-1==a.editingHourRange?a.hourRanges.push({startTimeHour:a.hourRange.startTimeHour,startTimeMinute:a.hourRange.startTimeMinute,endTimeHour:a.hourRange.endTimeHour,endTimeMinute:a.hourRange.endTimeMinute}):(a.hourRanges[a.editingHourRange].startTimeHour=a.hourRange.startTimeHour,a.hourRanges[a.editingHourRange].startTimeMinute=a.hourRange.startTimeMinute,a.hourRanges[a.editingHourRange].endTimeHour=a.hourRange.endTimeHour,a.hourRanges[a.editingHourRange].endTimeMinute=a.hourRange.endTimeMinute);
init_hourRange(a);a.togglePage(6)}function cancelRuleScheduler(a){init_schedule(a);a.togglePage(0)}function cancelTimeSegment(a){init_timeSegment(a);a.togglePage(5)}function cancelHourRange(a){init_hourRange(a);a.togglePage(6)}function editRuleScheduler(a,b,c){copySchedule(a.schedule,b[c]);a.printTimeSegArr=[];printSchedule(2,a.schedule.timeSegments,a.printTimeSegArr);a.editingRuleSchedule=c;a.togglePage(5)}
function editTimeSegment(a,b){for(var c=0;c<a.schedule.timeSegments[b].daysOfTheWeek.length;c++)a.daysOfTheWeek[a.schedule.timeSegments[b].daysOfTheWeek[c]]=!0;for(c=0;c<a.schedule.timeSegments[b].hourRanges.length;c++)a.hourRanges.push({startTimeHour:a.schedule.timeSegments[b].hourRanges[c].startTimeHour,startTimeMinute:a.schedule.timeSegments[b].hourRanges[c].startTimeMinute,endTimeHour:a.schedule.timeSegments[b].hourRanges[c].endTimeHour,endTimeMinute:a.schedule.timeSegments[b].hourRanges[c].endTimeMinute});
a.editingTimeSegment=b;a.togglePage(6)}function formatTimeValue(a){return 10>a?"0"+a:a}function editHourRange(a,b){a.hourRange.startTimeHour=formatTimeValue(a.hourRanges[b].startTimeHour);a.hourRange.startTimeMinute=formatTimeValue(a.hourRanges[b].startTimeMinute);a.hourRange.endTimeHour=formatTimeValue(a.hourRanges[b].endTimeHour);a.hourRange.endTimeMinute=formatTimeValue(a.hourRanges[b].endTimeMinute);a.editingHourRange=b;a.togglePage(7)}
function copySchedules(a,b){for(var c=0;c<b.length;c++){var d={};copySchedule(d,b[c]);a.push(d)}}function copySchedule(a,b){a.name=b.name;a.activeDuring=b.activeDuring;a.timeSegments=[];copyTimeSegments(a.timeSegments,b.timeSegments)}
function copyTimeSegments(a,b){for(var c=0;c<b.length;c++){for(var d={daysOfTheWeek:[],hourRanges:[]},e=0;e<b[c].daysOfTheWeek.length;e++)d.daysOfTheWeek.push(b[c].daysOfTheWeek[e]);for(e=0;e<b[c].hourRanges.length;e++)d.hourRanges.push({startTimeHour:b[c].hourRanges[e].startTimeHour,startTimeMinute:b[c].hourRanges[e].startTimeMinute,endTimeHour:b[c].hourRanges[e].endTimeHour,endTimeMinute:b[c].hourRanges[e].endTimeMinute});a.push(d)}}
function printTimeSegObject(a,b){for(var c="Mon Tues Wed Thurs Fri Sat Sun".split(" "),d="",e=0;e<a.daysOfTheWeek.length-1;e++)d+=c[a.daysOfTheWeek[e]]+", ";0!=a.daysOfTheWeek.length&&(1<a.daysOfTheWeek.length&&(d+="and "),d+=c[a.daysOfTheWeek[a.daysOfTheWeek.length-1]],d+=" between ",7===a.daysOfTheWeek.length&&(d=" All week between "));for(e=0;e<a.hourRanges.length-1;e++){10>a.hourRanges[e].startTimeHour&&(d+="0");d+=a.hourRanges[e].startTimeHour+":";10>a.hourRanges[e].startTimeMinute&&(d+="0");
d+=a.hourRanges[e].startTimeMinute+"-";10>a.hourRanges[e].endTimeHour&&(d+="0");d+=a.hourRanges[e].endTimeHour+":";10>a.hourRanges[e].endTimeMinute&&(d+="0");d+=a.hourRanges[e].endTimeMinute;if(a.hourRanges[e].startTimeHour>a.hourRanges[e].endTimeHour||a.hourRanges[e].startTimeHour==a.hourRanges[e].endTimeHour&&a.hourRanges[e].startTimeMinute>=a.hourRanges[e].endTimeMinute)d+=" on the next day";d+=", "}0!=a.hourRanges.length&&(1<a.hourRanges.length&&(d+="and "),10>a.hourRanges[a.hourRanges.length-
1].startTimeHour&&(d+="0"),d+=a.hourRanges[a.hourRanges.length-1].startTimeHour+":",10>a.hourRanges[a.hourRanges.length-1].startTimeMinute&&(d+="0"),d+=a.hourRanges[a.hourRanges.length-1].startTimeMinute+"-",10>a.hourRanges[a.hourRanges.length-1].endTimeHour&&(d+="0"),d+=a.hourRanges[a.hourRanges.length-1].endTimeHour+":",10>a.hourRanges[a.hourRanges.length-1].endTimeMinute&&(d+="0"),d+=a.hourRanges[a.hourRanges.length-1].endTimeMinute,a.hourRanges[a.hourRanges.length-1].startTimeHour>a.hourRanges[a.hourRanges.length-
1].endTimeHour||a.hourRanges[a.hourRanges.length-1].startTimeHour==a.hourRanges[a.hourRanges.length-1].endTimeHour&&a.hourRanges[a.hourRanges.length-1].startTimeMinute>=a.hourRanges[a.hourRanges.length-1].endTimeMinute)&&(d+=" on the next day");d=d.replace(", and"," and");b.push(d)}function getPrintArrForTimeSegs(a,b){for(var c=0;c<a.length;c++)printTimeSegObject(a[c],b)}
function printSchedule(a,b,c){var d="Mon Tues Wed Thurs Fri Sat Sun".split(" ");if(0==a)for(var e in b){if(0<=e&&void 0!==b[e].timeSegments){a=[];for(var f=0;f<b[e].timeSegments.length;f++){for(var g="",h=0;h<b[e].timeSegments[f].daysOfTheWeek.length-1;h++)g+=d[b[e].timeSegments[f].daysOfTheWeek[h]]+", ";0!=b[e].timeSegments[f].daysOfTheWeek.length&&(1<b[e].timeSegments[f].daysOfTheWeek.length&&(g+="and "),g+=d[b[e].timeSegments[f].daysOfTheWeek[b[e].timeSegments[f].daysOfTheWeek.length-1]],g+=" between ");
for(h=0;h<b[e].timeSegments[f].hourRanges.length-1;h++){10>b[e].timeSegments[f].hourRanges[h].startTimeHour&&(g+="0");g+=b[e].timeSegments[f].hourRanges[h].startTimeHour+":";10>b[e].timeSegments[f].hourRanges[h].startTimeMinute&&(g+="0");g+=b[e].timeSegments[f].hourRanges[h].startTimeMinute+"-";10>b[e].timeSegments[f].hourRanges[h].endTimeHour&&(g+="0");g+=b[e].timeSegments[f].hourRanges[h].endTimeHour+":";10>b[e].timeSegments[f].hourRanges[h].endTimeMinute&&(g+="0");g+=b[e].timeSegments[f].hourRanges[h].endTimeMinute;
if(b[e].timeSegments[f].hourRanges[h].startTimeHour>b[e].timeSegments[f].hourRanges[h].endTimeHour||b[e].timeSegments[f].hourRanges[h].startTimeHour==b[e].timeSegments[f].hourRanges[h].endTimeHour&&b[e].timeSegments[f].hourRanges[h].startTimeMinute>=b[e].timeSegments[f].hourRanges[h].endTimeMinute)g+=" on the next day";g+=", "}0!=b[e].timeSegments[f].hourRanges.length&&(1<b[e].timeSegments[f].hourRanges.length&&(g+="and "),10>b[e].timeSegments[f].hourRanges[b[e].timeSegments[f].hourRanges.length-
1].startTimeHour&&(g+="0"),g+=b[e].timeSegments[f].hourRanges[b[e].timeSegments[f].hourRanges.length-1].startTimeHour+":",10>b[e].timeSegments[f].hourRanges[b[e].timeSegments[f].hourRanges.length-1].startTimeMinute&&(g+="0"),g+=b[e].timeSegments[f].hourRanges[b[e].timeSegments[f].hourRanges.length-1].startTimeMinute+"-",10>b[e].timeSegments[f].hourRanges[b[e].timeSegments[f].hourRanges.length-1].endTimeHour&&(g+="0"),g+=b[e].timeSegments[f].hourRanges[b[e].timeSegments[f].hourRanges.length-1].endTimeHour+
":",10>b[e].timeSegments[f].hourRanges[b[e].timeSegments[f].hourRanges.length-1].endTimeMinute&&(g+="0"),g+=b[e].timeSegments[f].hourRanges[b[e].timeSegments[f].hourRanges.length-1].endTimeMinute,b[e].timeSegments[f].hourRanges[b[e].timeSegments[f].hourRanges.length-1].startTimeHour>b[e].timeSegments[f].hourRanges[b[e].timeSegments[f].hourRanges.length-1].endTimeHour||b[e].timeSegments[f].hourRanges[b[e].timeSegments[f].hourRanges.length-1].startTimeHour==b[e].timeSegments[f].hourRanges[b[e].timeSegments[f].hourRanges.length-
1].endTimeHour&&b[e].timeSegments[f].hourRanges[b[e].timeSegments[f].hourRanges.length-1].startTimeMinute>=b[e].timeSegments[f].hourRanges[b[e].timeSegments[f].hourRanges.length-1].endTimeMinute)&&(g+=" on the next day");a.push(g)}c.push(a)}}else if(1==a)for(f=0;f<b[0].timeSegments.length;f++){g="";for(h=0;h<b[0].timeSegments[f].daysOfTheWeek.length-1;h++)g+=d[b[0].timeSegments[f].daysOfTheWeek[h]]+", ";0!=b[0].timeSegments[f].daysOfTheWeek.length&&(1<b[0].timeSegments[f].daysOfTheWeek.length&&(g+=
"and "),g+=d[b[0].timeSegments[f].daysOfTheWeek[b[0].timeSegments[f].daysOfTheWeek.length-1]],g+=" between ",7===b[0].timeSegments[f].daysOfTheWeek.length&&(g=" ",g+="All week between "));for(h=0;h<b[0].timeSegments[f].hourRanges.length-1;h++)10>b[0].timeSegments[f].hourRanges[h].startTimeHour&&(g+="0"),g+=b[0].timeSegments[f].hourRanges[h].startTimeHour+":",10>b[0].timeSegments[f].hourRanges[h].startTimeMinute&&(g+="0"),g+=b[0].timeSegments[f].hourRanges[h].startTimeMinute+"-",10>b[0].timeSegments[f].hourRanges[h].endTimeHour&&
(g+="0"),g+=b[0].timeSegments[f].hourRanges[h].endTimeHour+":",10>b[0].timeSegments[f].hourRanges[h].endTimeMinute&&(g+="0"),g+=b[0].timeSegments[f].hourRanges[h].endTimeMinute+", ";0!=b[0].timeSegments[f].hourRanges.length&&(1<b[0].timeSegments[f].hourRanges.length&&(g+="and "),10>b[0].timeSegments[f].hourRanges[b[0].timeSegments[f].hourRanges.length-1].startTimeHour&&(g+="0"),g+=b[0].timeSegments[f].hourRanges[b[0].timeSegments[f].hourRanges.length-1].startTimeHour+":",10>b[0].timeSegments[f].hourRanges[b[0].timeSegments[f].hourRanges.length-
1].startTimeMinute&&(g+="0"),g+=b[0].timeSegments[f].hourRanges[b[0].timeSegments[f].hourRanges.length-1].startTimeMinute+"-",10>b[0].timeSegments[f].hourRanges[b[0].timeSegments[f].hourRanges.length-1].endTimeHour&&(g+="0"),g+=b[0].timeSegments[f].hourRanges[b[0].timeSegments[f].hourRanges.length-1].endTimeHour+":",10>b[0].timeSegments[f].hourRanges[b[0].timeSegments[f].hourRanges.length-1].endTimeMinute&&(g+="0"),g+=b[0].timeSegments[f].hourRanges[b[0].timeSegments[f].hourRanges.length-1].endTimeMinute);
g=g.replace(", and"," and");c.push(g)}else 2==a&&getPrintArrForTimeSegs(b,c)}function removeObject(a,b,c,d){a.splice(b,1);2==c&&(d.printPortsArr=[],printProtocol(2,d.service.protocols,d.printPortsArr))}function copyArrayFromSource(a){for(var b=[],c=0;c<a.length;c++)b.push(a[c]);return b}
function copyTrigger(a,b){a.name=b.name;a.enabled=b.enabled;for(var c=0;c<b.outgoing.length;c++){var d={};copyProtocol(d,b.outgoing[c]);a.outgoing.push(d)}for(c=0;c<b.incoming.length;c++)d={},copyProtocol(d,b.incoming[c]),a.incoming.push(d)}
function applyAddressCheck(a){a.rule.networkObjType=parseInt(a.rule.networkObjType);a.rule.dhcpType=parseInt(a.rule.dhcpType);a.errorMessages=[];switch(a.rule.networkObjType){case 0:validateIp(a.rule.ip)||a.errorMessages.push("IP Address: IP address must consist of 4 fields. Each field's value must be between 0 and 255, without any spaces.");break;case 1:validateIp(a.rule.ip)?validateIp(a.rule.ipTwo)?"0.0.0.0"===getIpString(a.rule.ipTwo)?a.errorMessages.push("IP Address and Subnet Mask combination: Subnet mask may not be 0.0.0.0. Subnet mask must consist of 4 fields. Each field's value must be between 0 and 255, constructing a contiguous string of binary ones. The default mask value is 255.255.255.0."):
validateSubnetMask(a.rule.ipTwo)?checkSubnetIp(a.rule.ip,a.rule.ipTwo)||a.errorMessages.push("IP Address and Subnet Mask combination: The subnet definition is invalid."):a.errorMessages.push("IP Address and Subnet Mask combination:  Subnet mask must consist of 4 fields. Each field's value must be between 0 and 255, constructing a contiguous string of binary ones. The default mask value is 255.255.255.0."):a.errorMessages.push("IP Address and Subnet Mask combination: Subnet mask must consist of 4 fields. Each field's value must be between 0 and 255, constructing a contiguous string of binary ones. The default mask value is 255.255.255.0."):
a.errorMessages.push("IP Address and Subnet Mask combination: IP address must consist of 4 fields. Each field's value must be between 0 and 255, without any spaces.");break;case 2:if(validateIp(a.rule.ip)&&validateIp(a.rule.ipTwo))for(var b=0;4>b&&!(a.rule.ip[b]<a.rule.ipTwo[b]);b++){if(a.rule.ip[b]!=a.rule.ipTwo[b]){a.errorMessages.push("IP Range: Start IP address is greater than End IP address.");break}}else a.errorMessages.push("IP Range: IP address must consist of 4 fields. Each field's value must be between 0 and 255, without any spaces.");
break;case 3:checkMacAddress(a,a.rule.mac);"00:00:00:00:00:00"==getMacString(a.rule.mac)&&a.errorMessages.push("MAC Address: MAC address must consist of 6 fields. Each field's value must be between 00 and FF (in hexadecimal representation), without any spaces. The LSB of the first byte must be zero.");getMacString(a.rule.macMask)&&!/^[0\:]{17}$/.test(getMacString(a.rule.macMask))&&validateMac(getMacString(a.rule.macMask))||a.errorMessages.push("MAC Mask: MAC address mask must consist of 6 fields. Each field's value must be between 00 and FF (in hexadecimal representation).");
break;case 4:validateLocalDomains(a.rule.hostname)||a.errorMessages.push("Host Name: Name may not contain spaces. Only letters, digits and the special characters dash (-), underscore (_) and dot (.) may be used. These special characters may not appear at the beginning or at the end of a name. The maximum length of a label (text between two dots) is 63.");break;case 5:""===a.rule.hostname&&a.errorMessages.push("DHCP Option: A string must be specified.")}0<a.errorMessages.length&&(a.showErrorPage=!0,
window.scrollTo(0,0))}
function checkMacAddress(a,b){if(!validateMac(getMacString(b)))a.errorMessages=["MAC Address: MAC address must consist of 6 fields. Each field's value must be between 00 and FF (in hexadecimal representation), without any spaces. The LSB of the first byte must be zero."];else if(/[f\:]{17}$/i.test(getMacString(b)))a.errorMessages.push("MAC Address: MAC FF:FF:FF:FF:FF:FF is reserved for broadcast.");else if(!validateMac(getMacString(b))||/[0\:]{17}$/i.test(b)||1==(parseInt(b[0],16)&1))a.errorMessages=
["MAC Address: MAC address must consist of 6 fields. Each field's value must be between 00 and FF (in hexadecimal representation), without any spaces. The LSB of the first byte must be zero."]}function checkAndFindNetworkObject(a,b,c){var d=!0;if(0<a.length)for(var e=0;e<a.length;e++)"DHCP"==a[e].name&&4==a[e].type&&a[e].rules[0].name==b&&7==a[e].rules[0].networkObjType&&(d=!1);d&&a.push({name:"DHCP",type:4,rules:[{name:b,networkObjType:7,ipAddress:c}]})}
function compareHosts(a,b){var c=!0,d=!1;if(a.length==b.length&&0==a.length)c=!0;else if(0<a.length&&0<b.length)for(var e=0;e<a.length;e++){for(var d=!1,f=0;f<b.length;f++)if(a[e]==b[e]){d=!0;break}if(!1==d){c=!1;break}}else c=0==a.length?!0:!1;return c}
function compareNetworkObjects(a,b){var c=!0,d=!1;if(a.length==b.length&&0==a.length)c=!0;else if(0<a.length&&0<b.length)for(var e=0;e<a.length;e++){for(var d=!1,f=0;f<b.length;f++)if(compareNetObjects(a[e],b[f])){d=!0;break}if(!1==d){c=!1;break}}else c=!1;return c}function compareNetObjects(a,b){var c=!0;a.name!=b.name&&(c=!1);a.rules.length==b.rules.length?a.rules[0].ipAddress!=b.rules[0].ipAddress&&(c=!1):c=!1;return c}
function compareServices(a,b){var c=!0,d=!1;if(a.length==b.length&&0==a.length)c=!0;else if(0<a.length&&0<b.length)for(var e=0;e<a.length;e++){for(var d=!1,f=0;f<b.length;f++)if(compareService(a[e],b[f])){d=!0;break}if(!1==d){c=!1;break}}else c=!1;return c}function compareService(a,b){var c=!0;a.name!=b.name&&(c=!1);a.description!=b.description&&(c=!1);!0==c&&(c=compareProtocols(a.protocols,b.protocols));return c}
function compareProtocols(a,b){var c=!0,d=!1;if(0==a.length&&0==b.length)c=!0;else if(0<a.length&&0<b.length)for(var e=0;e<a.length;e++){for(var d=!1,f=0;f<b.length;f++)compareProtocol(a[e],b[f])&&(d=!0);if(!1==d){c=!1;break}}else c=!1;return c}
function compareProtocol(a,b){var c=!0;a.incomingExclude!=b.incomingExclude&&(c=!1);a.incomingPorts!=b.incomingPorts&&(c=!1);a.outgoingExclude!=b.outgoingExclude&&(c=!1);a.outgoingPortStart!=b.outgoingPortStart&&(c=!1);a.outgoingPorts!=b.outgoingPorts&&(c=!1);a.protocol!=b.protocol&&(c=!1);a.protocolExclude!=b.protocolExclude&&(c=!1);return c}
function compareAllSchedules(a,b,c){var d=!0;return d=void 0!=a&&(void 0==a||a.hasOwnProperty("name"))||void 0!=b&&(void 0==b||b.hasOwnProperty("name"))?void 0==a||void 0!=a&&!a.hasOwnProperty("name")||void 0==b||void 0!=b&&!b.hasOwnProperty("name")?!1:compareSchedules(a,b,c):!0}
function compareSchedules(a,b,c){var d=!0;-2==c?a.name!=b.name&&(d=!1):-1!=c?escape(a.name)!=b.name&&(d=!1):-1==c&&escape(a.name).replace(/\+/g,"%2B")!=b.name&&(d=!1);a.activeDuring!=b.activeDuring&&(d=!1);!0==d&&(d=compareSchedule(a.timeSegments,b.timeSegments));return d}
function compareSchedule(a,b){var c=!0,d=!1;if(0==a.length&&0==b.length)c=!0;else if(0<a.length&&0<b.length)for(var e=0;e<a.length;e++){for(var d=!1,f=0;f<b.length;f++)compareTimeSegments(a[e],b[f])&&(d=!0);if(!1==d){c=!1;break}}else c=!1;return c}function compareTimeSegments(a,b){var c=!0,c=compareDates(a.daysOfTheWeek,b.daysOfTheWeek);!0==c&&(c=compareHourRanges(a.hourRanges,b.hourRanges));return c}
function compareHourRanges(a,b){var c=!0,d=!1;if(0!=a.length||0!=b.length)if(0<a.length&&0<b.length)for(var e=0;e<a.length;e++){for(var d=!1,f=0;f<b.length;f++)compareHourRange(a[e],b[f])&&(d=!0);if(!1==d){c=!1;break}}else c=!1;return c}function compareHourRange(a,b){var c=!0;a.endTimeHour!=b.endTimeHour&&(c=!1);a.endTimeMinute!=b.endTimeMinute&&(c=!1);a.startTimeHour!=b.startTimeHour&&(c=!1);a.startTimeMinute!=b.startTimeMinute&&(c=!1);return c}
function compareDates(a,b){for(var c=!0,d=!1,e=0;e<a.length;e++){for(var d=!1,f=0;f<b.length;f++)compareDate(a[e],b[f])&&(d=!0);if(!1==d){c=!1;break}}return c}function compareDate(a,b){var c=!0;a!=b&&(c=!1);return c}
function getTempObjectContent(a){var b={protocol:0,protocolExclude:!1,incomingPorts:0,incomingPortStart:1,incomingPortEnd:65535,incomingExclude:!1,outgoingPorts:0,outgoingPortStart:1,outgoingPortEnd:65535,outgoingExclude:!1,icmpMessage:0,icmpType:0,icmpCode:0,protocolNumber:0};if(0==a.protocol)switch(a.protocolNumber){case 1:b.protocol=3;b.icmpMessage=0;break;case 6:b.protocol=1;b.incomingPorts=0;b.incomingPortStart=0;b.incomingPortEnd=65535;b.incomingExclude=!1;b.outgoingPorts=0;b.outgoingPortStart=
0;b.outgoingPortEnd=65535;b.outgoingExclude=!1;break;case 17:b.protocol=2;b.incomingPorts=0;b.incomingPortStart=0;b.incomingPortEnd=65535;b.incomingExclude=!1;b.outgoingPorts=0;b.outgoingPortStart=0;b.outgoingPortEnd=65535;b.outgoingExclude=!1;break;case 47:b.protocol=4;break;case 50:b.protocol=5;break;case 51:b.protocol=6;break;default:b.protocolNumber=a.protocolNumber}else 4==a.protocol||5==a.protocol||6==a.protocol?(b.protocol=a.protocol,b.protocolExclude=a.protocolExclude):3==a.protocol?(b.protocol=
a.protocol,b.icmpMessage=a.icmpMessage,10==a.icmpMessage&&(b.icmpType=a.icmpType,b.icmpCode=a.icmpCode)):(b.protocol=a.protocol,b.incomingPorts=a.incomingPorts,b.incomingPortStart=a.incomingPortStart,b.incomingPortEnd=a.incomingPortEnd,b.incomingExclude=a.incomingExclude,b.outgoingPorts=a.outgoingPorts,b.outgoingPortStart=a.outgoingPortStart,b.outgoingPortEnd=a.outgoingPortEnd,b.outgoingExclude=a.outgoingExclude);return b}
function compareNewCondAndCurrentList(a,b,c){var d=[],e="",f=!1;if(0!=a.length)for(var g=0;g<a.length&&(c!=g&&a[g].protocol==b.protocol&&(4==b.protocol||5==b.protocol||6==b.protocol?(4==b.protocol?e="GRE":5==b.protocol?e="ESP":6==b.protocol&&(e="AH"),d.push("Existing Protocol: The "+e+" protocol is already used by the user-defined service.")):3==b.protocol?(b.icmpMessage==a[g].icmpMessage&&(10==b.icmpMessage?b.icmpType==a[g].icmpType&&b.icmpCode==a[g].icmpCode&&(f=!0,e="Type "+b.icmpType+" Code "+
b.icmpCode):(f=!0,0==b.icmpMessage?e="Echo Reply":1==b.icmpMessage?e="Network Unreachable":2==b.icmpMessage?e="Host Unreachable":3==b.icmpMessage?e="Protocol Unreachable":4==b.icmpMessage?e="Port Unreachable":5==b.icmpMessage?e="Destination Network Unknown":6==b.icmpMessage?e="Destination Host Unknown":7==b.icmpMessage?e="Redirect for Network":8==b.icmpMessage?e="Redirect for Host":9==b.icmpMessage&&(e="Echo Request"))),f&&d.push("Existing ICMP Message: The "+e+" ICMP message is already used by the user defined service.")):
0==b.protocol?b.protocolNumber==a[g].protocolNumber&&(e=0==b.protocolNumber?"Any":b.protocolNumber,d.push("Existing Protocol: The Protocol "+e+" protocol is already used by the user-defined service.")):(e=overlapsPort(b.outgoingPorts,b.outgoingPortStart,b.outgoingPortEnd,a[g].outgoingPorts,a[g].outgoingPortStart,a[g].outgoingPortEnd,b.protocol),""!=e&&d.push(e))),""==d);g++);return d}
function overlapsPort(a,b,c,d,e,f,g){var h="",k="",l=h="",r=!1,m=!1,n=0,v=0;1==g&&(0==a&&(a=1,b=4567,r=!0,n=4577),0==d&&(d=1,e=4567,m=!0,v=4577));1==g?(k="TCP",h=overlapsSubPort(a,b,c,d,e,f,k),!0==r&&""!=h&&(h=overlapsSubPort(a,n,c,d,e,f,k)),!0==r&&!0==m&&""!=h&&(h=overlapsSubPort(a,n,c,d,v,f,k)),!0==m&&""!=h&&(h=overlapsSubPort(a,b,c,d,v,f,k))):(k="UDP",0==a||0==d?(0==a?h="Any":1==a?(h=b,r&&(h+=","+n)):2==a&&(h=b+"-"+c),0==d?l="Any":1==d?(l=e,m&&(l+=","+v)):2==d&&(l=e+"-"+f),h="Overlapping Port Ranges: The UDP destination ports ("+
h+") is overlapping with already defined UDP destination ports ("+l+")."):(h=overlapsSubPort(a,b,c,d,e,f,k),!0==r&&""!=h&&(h=overlapsSubPort(a,n,c,d,e,f,k)),!0==r&&!0==m&&""!=h&&(h=overlapsSubPort(a,n,c,d,v,f,k)),!0==m&&""!=h&&(h=overlapsSubPort(a,b,c,d,v,f,k))));return h}
function overlapsSubPort(a,b,c,d,e,f,g){var h="",k="",l="",r=!1;1==a?1==d?Number(b)==Number(e)&&(k=b,l=e,r=!0):Number(f)>=Number(b)&&Number(e)<=Number(b)&&(k=b,l=e+"-"+f,r=!0):1==d?Number(c)>=Number(e)&&Number(b)<=Number(e)&&(k=b+"-"+c,l=e,r=!0):Number(c)>=Number(e)&&Number(b)<=Number(e)?(k=b+"-"+c,l=e+"-"+f,r=!0):Number(c)>=Number(f)&&Number(b)<=Number(f)?(k=b+"-"+c,l=e+"-"+f,r=!0):Number(f)>=Number(c)&&Number(e)<=Number(c)?(k=b+"-"+c,l=e+"-"+f,r=!0):Number(f)>=Number(c)&&Number(e)<=Number(c)&&(k=
b+"-"+c,l=e+"-"+f,r=!0);r&&(h="Overlapping Port Ranges: The "+g+" destination ports ("+k+") is overlapping with already defined "+g+" destination ports ("+l+").");return h};angular.module("igmp.controllers",[]).controller("IgmpProxyCtrl",["$scope","$route","$location","IGMPProxy",function(a,b,c,d){a.tab=b.current.tab;a.section=b.current.section;a.showErrorPage=!1;a.errorPageOk=function(){a.showErrorPage=!1;window.scrollTo(0,0)};a.igmp=d.get();a.save=function(){a.errorMessages=[];a.igmp.enabled="true"===""+a.igmp.enabled;a.igmp.fastLeave="true"===""+a.igmp.fastLeave;(null==a.igmp.robustness||isNaN(a.igmp.robustness)||1>a.igmp.robustness||!checksForDecimalNumber(a.igmp.robustness))&&
a.errorMessages.push("IGMP Proxy: Invalid IGMP Robustness (>=1)");isNaN(a.igmp.queryInterval)||1>a.igmp.queryInterval||!checksForDecimalNumber(a.igmp.queryInterval)?a.errorMessages.push("IGMP Proxy: Invalid IGMP Query Interval (>=1)"):(isNaN(a.igmp.queryResponseInterval)||1>a.igmp.queryResponseInterval||parseInt(a.igmp.queryResponseInterval)>=parseInt(a.igmp.queryInterval)||!checksForDecimalNumber(a.igmp.queryResponseInterval))&&a.errorMessages.push("IGMP Proxy: Invalid IGMP Query Response Interval (>=1 and <"+
a.igmp.queryInterval+")");(isNaN(a.igmp.reportInterval)||1>a.igmp.reportInterval||25<a.igmp.reportInterval||!checksForDecimalNumber(a.igmp.reportInterval))&&a.errorMessages.push("IGMP Proxy: Invalid IGMP Client Unsolicited Report Interval (>=1 and <=25)");0<a.errorMessages.length?(a.showErrorPage=!0,window.scrollTo(0,0)):(a.igmp.version=parseInt(a.igmp.version),a.igmp.robustness=parseInt(a.igmp.robustness),a.igmp.queryInterval=parseInt(a.igmp.queryInterval),a.igmp.queryResponseInterval=parseInt(a.igmp.queryResponseInterval),
a.igmp.reportInterval=parseInt(a.igmp.reportInterval),a.igmp.$update(function(){c.path("/advanced")}))}}]).controller("IgmpAclCtrl",["$scope","$route","$location","IGMPAcl",function(a,b,c,d){a.tab=b.current.tab;a.section=b.current.section;a.showErrorPage=!1;a.errorPageOk=function(){a.showErrorPage=!1;window.scrollTo(0,0)};a.acl=d.get();a.whiteListClicked=function(){a.acl.whiteListEnabled||(a.acl.blackListEnabled=!1)};a.blackListClicked=function(){a.acl.blackListEnabled||(a.acl.whiteListEnabled=!1)};
a.save=function(){a.acl.$update();d.update({whiteListEnabled:a.acl.whiteListEnabled,blackListEnabled:a.acl.blackListEnabled},function(){location.reload()})};a.saveAddress=function(){a.errorMessages=[];validateMulticastAddr(a.multicast)||a.errorMessages.push("Multicast Address: The multicast address you input is not valid! It should be from 224.0.0.0 to 239.255.255.255");validateSubnetMask(a.netmask)||a.errorMessages.push("Multicast Address: Subnet mask may not be 0.0.0.0. Subnet mask must consist of 4 fields. Each field's value must be between 0 and 255, constructing a contiguous string of binary ones. The default mask value is 255.255.255.0.");
0==a.errorMessages.length&&(checkSubnetIp(a.multicast,a.netmask)||a.errorMessages.push("Multicast Address: The subnet definition is invalid."),0==a.editList?checkMulticastVsList(a.multicast,a.acl.whiteList,a.editObj,"ip")||a.errorMessages.push("Multicast Address: Same multicast address has already put in the filter list!"):checkMulticastVsList(a.multicast,a.acl.blackList,a.editObj,"ip")||a.errorMessages.push("Multicast Address: Same multicast address has already put in the filter list!"));if(0<a.errorMessages.length)a.showErrorPage=
!0,window.scrollTo(0,0);else if(a.editing=!1,-1==a.editObj){var b={ip:getIpString(a.multicast),netmask:getIpString(a.netmask)};0==a.editList?(a.acl.whiteList.push(b),d.update({whiteList:a.acl.whiteList})):(a.acl.blackList.push(b),d.update({blackList:a.acl.blackList}))}else 0==a.editList?(a.acl.whiteList[a.editObj].ip=getIpString(a.multicast),a.acl.whiteList[a.editObj].netmask=getIpString(a.netmask),d.update({whiteList:a.acl.whiteList})):(a.acl.blackList[a.editObj].ip=getIpString(a.multicast),a.acl.blackList[a.editObj].netmask=
getIpString(a.netmask),d.update({blackList:a.acl.blackList}))};a.addWhitelist=function(){a.editObj=-1;a.editing=!0;a.editList=0;a.netmask=[0,0,0,0];a.multicast=[0,0,0,0]};a.addBlacklist=function(){a.editObj=-1;a.editing=!0;a.editList=1;a.netmask=[0,0,0,0];a.multicast=[0,0,0,0]};a.editWhiteList=function(b){a.editing=!0;a.editList=0;a.editObj=b;a.netmask=splitIpArr(a.acl.whiteList[b].netmask);a.multicast=splitIpArr(a.acl.whiteList[b].ip)};a.editBlackList=function(b){a.editing=!0;a.editList=1;a.editObj=
b;a.netmask=splitIpArr(a.acl.blackList[b].netmask);a.multicast=splitIpArr(a.acl.blackList[b].ip)};a.removeWhiteList=function(b){a.acl.whiteList.splice(b,1);d.update({whiteList:a.acl.whiteList})};a.removeBlackList=function(b){a.acl.blackList.splice(b,1);d.update({blackList:a.acl.blackList})};a.cancel=function(){a.editing=!1}}]).controller("IgmpHostsCtrl",["$scope","$route","$location","IGMPHosts",function(a,b,c,d){a.tab=b.current.tab;a.section=b.current.section;a.errorPageOk=function(){a.showErrorPage=
!1;window.scrollTo(0,0)};a.hosts=d.query();a.editHost=function(b){a.editing=!0;a.editDev={};for(var c in a.hosts[b])a.hosts[b].hasOwnProperty(c)&&(a.editDev[c]=a.hosts[b][c]);-1==a.editDev.maxConn&&(a.editDev.maxConn=8);a.editingIndex=b};a.applyEdit=function(){a.errorMessages=[];(isNaN(a.editDev.maxConn)||""===a.editDev.maxConn||0>a.editDev.maxConn||256<a.editDev.maxConn||!checksForDecimalNumber(a.editDev.maxConn))&&a.errorMessages.push("Max Channels: Maximum channel allowed should be in the range of 0 - 256");
0<a.errorMessages.length?(a.showErrorPage=!0,window.scrollTo(0,0)):(a.editDev.maxConn=parseInt(a.editDev.maxConn),a.editing=!1,d.update({id:a.editDev.id},a.editDev,function(){a.hosts=d.query()}))};a.cancel=function(){a.editing=!1}}]).controller("IgmpIntfCtrl",["$scope","$route","$location","IGMPInterfaces",function(a,b,c,d){a.tab=b.current.tab;a.section=b.current.section;a.igmpintf=d.get(function(){for(var b=0;b<a.igmpintf.interfaces.length;b++)a.igmpintf.interfaces[b].name=unescape(a.igmpintf.interfaces[b].name)});
a.save=function(){a.igmpintf.$update(function(){location.reload()})};a.cancel=function(){}}]).controller("IgmpServCtrl",["$scope","$route","$location","IgmpServices",function(a,b,c,d){a.tab=b.current.tab;a.section=b.current.section;a.page=0;a.showErrorPage=!1;a.errorPageOk=function(){a.showErrorPage=!1;window.scrollTo(0,0)};a.refresh=function(){a.services=d.query(function(){for(var b=0;b<a.services.length;b++)a.services[b].service=unescape(a.services[b].service)})};a.refresh();a.editService=function(b){a.editing=
b;for(var c,d=0;d<a.services.length;d++)if(a.services[d].id==b){c=a.services[d];break}a.temp={service:c.service,maxStbs:c.maxStbs,maxNonStbs:c.maxNonStbs,ranges:[]};for(d=0;d<c.ranges.length;d++)a.temp.ranges.push({address:c.ranges[d].address,netmask:c.ranges[d].netmask});a.page=1;window.scrollTo(0,0)};a.deleteService=function(b){d.remove({id:b},function(){a.refresh()});window.scrollTo(0,0)};a.addService=function(){a.editing=-1;a.page=1;window.scrollTo(0,0);a.temp={service:"",maxStbs:0,maxNonStbs:0,
ranges:[]}};a.save=function(){a.errorMessages=[];""==a.temp.service&&a.errorMessages.push("Service: A string must be specified.");(""===a.temp.maxStbs||isNaN(a.temp.maxStbs)||0>a.temp.maxStbs||256<a.temp.maxStbs||!checksForDecimalNumber(a.temp.maxStbs))&&a.errorMessages.push("Max STBs Allowed: Maximum STBs allowed should be in the range of 0 - 256");(""===a.temp.maxNonStbs||isNaN(a.temp.maxNonStbs)||0>a.temp.maxNonStbs||256<a.temp.maxNonStbs||!checksForDecimalNumber(a.temp.maxNonStbs))&&a.errorMessages.push("Max Non-STBs Allowed: Maximum Non-STBs allowed should be in the range of 0 - 256");
0==a.temp.ranges.length&&a.errorMessages.push("Multicast Address Range:  At least one item entry must be defined.");0<a.errorMessages.length?a.showErrorPage=!0:(a.temp.maxStbs=Number(a.temp.maxStbs),a.temp.maxNonStbs=Number(a.temp.maxNonStbs),a.temp.service=escape(a.temp.service),-1!=a.editing?d.update({id:a.editing},a.temp,function(){a.refresh()}):d.save(a.temp,function(){a.refresh()}),a.page=0);window.scrollTo(0,0)};a.addMulticast=function(){a.multicastIndex=-1;a.page=2;a.multicast=[0,0,0,0];a.netmask=
[0,0,0,0];window.scrollTo(0,0)};a.editMulticast=function(b){a.multicastIndex=b;a.multicast=splitIpArr(a.temp.ranges[b].address);a.netmask=splitIpArr(a.temp.ranges[b].netmask);a.page=2;window.scrollTo(0,0)};a.removeMulticast=function(b){a.multicastIndex=b;a.temp.ranges.splice(b,1);window.scrollTo(0,0)};a.saveRange=function(){a.errorMessages=[];validateMulticastAddr(a.multicast)||a.errorMessages.push("Multicast Address: The multicast address you input is not valid! It should be from 224.0.0.0 to 239.255.255.255");
validateSubnetMask(a.netmask)||a.errorMessages.push("Multicast Address: Subnet mask may not be 0.0.0.0. Subnet mask must consist of 4 fields. Each field's value must be between 0 and 255, constructing a contiguous string of binary ones. The default mask value is 255.255.255.0.");0==a.errorMessages.length&&(checkSubnetIp(a.multicast,a.netmask)||a.errorMessages.push("Multicast Address: The subnet definition is invalid."),checkMulticastVsList(a.multicast,a.temp.ranges,a.multicastIndex,"address")||a.errorMessages.push("Multicast Address: Same multicast address has already put in the filter list!"));
0<a.errorMessages.length?(a.showErrorPage=!0,window.scrollTo(0,0)):(a.page=1,window.scrollTo(0,0),-1==a.multicastIndex?a.temp.ranges.push({address:getIpString(a.multicast),netmask:getIpString(a.netmask)}):(a.temp.ranges[a.multicastIndex].address=getIpString(a.multicast),a.temp.ranges[a.multicastIndex].netmask=getIpString(a.netmask)))};a.cancelRange=function(){a.page=1;window.scrollTo(0,0)};a.cancelAdd=function(){a.page=0;window.scrollTo(0,0)}}]);var systemSettings=null;
angular.module("main.controllers",[]).controller("MainCtrl",["$scope","$route","Devices","NetworkConnections","FirmwareUpgrade","Logout","$location","SystemSettings","securityTips",function(a,b,c,d,e,f,g,h,k){a.tab=b.current.tab;a.hasFailedLogin=!1;a.hasBadConnectionDevice=!1;a.noBadConnectionDevice=0;a.failedLogin=0;a.hasList0=!1;a.hasList1=!1;a.showList0=!1;a.showList1=!1;a.list0Count=0;a.list1Count=0;a.customSort=function(a,b){return"802.11b"==a.wifiModeStr&&"802.11b"==b.wifiModeStr?a.status&&
b.status?0:a.status?-1:1:"802.11b"==a.wifiModeStr?-1:1};a.devices=c.query(function(){a.list0Count=0;a.list1Count=0;a.hasList0=!1;a.hasList1=!1;for(var b=a.noBadConnectionDevice=0;b<a.devices.length;b++)6!=a.devices[b].connectionType?a.list0Count++:6==a.devices[b].connectionType&&a.devices[b].approved&&a.list1Count++,setDeviceStyle(a.devices[b],""),a.devices[b]=checkDeviceIP(a.devices[b]),a.devices[b].status&&(5==a.devices[b].connectionType||6==a.devices[b].connectionType&&a.devices[b].approved)&&
"b"==a.devices[b].wifiMode.toLowerCase()&&a.noBadConnectionDevice++,a.devices[b].wifiModeStr=4==a.devices[b].connectionType||5==a.devices[b].connectionType||6==a.devices[b].connectionType||7==a.devices[b].connectionType?"802.11"+a.devices[b].wifiMode.toLowerCase():"";a.devices.sort(a.customSort);0<a.noBadConnectionDevice&&(a.hasBadConnectionDevice=!0);3<a.list0Count&&(a.hasList0=!0);3<a.list1Count&&(a.hasList1=!0)});a.showDevice=function(b,c){return 0==b?a.showList0?!0:3>c?!0:!1:a.showList1?!0:3>
c?!0:!1};a.toggleList=function(b,c){0==b?a.showList0=0==c?!1:!0:a.showList1=0==c?!1:!0};a.fwInfo=e.get();var l="";a.ipString2="";a.ArrStr=[];a.broadband=null;a.hasMoreLen=!1;var r=d.query(function(){for(var b=0;b<r.length;b++)if(1==r[b].type){a.hasMoreLen=!1;a.broadband=r[b];for(var b=a.broadband.ipv6Address.split(":"),c=0;c<b.length;c++)l=l+b[c]+":",4>c&&a.ArrStr.push(l);4<b.length&&(a.hasMoreLen=!0);for(c=4;c<b.length;c++)a.ipString2=a.ipString2+b[c]+":";a.ipString2=a.ipString2.substring(0,a.ipString2.length-
1);break}});a.systemSettings=h.get(function(){a.hasFailedLogin=!1;a.failedLogin=a.systemSettings.previousFailedLogins;0<a.failedLogin&&(a.hasFailedLogin=!0)});a.noConnection=function(){k.showCustomMessage3("Warning",["You need to be connected to the internet to view the User Guide"])};a.nonGuestDevice=function(a){return 6==Number(a.connectionType)?!1:!0};a.guestDevice=function(a){return 6==Number(a.connectionType)&&a.approved?!0:!1};a.clickBadConnectionDevicePopup=function(){k.showBadConnectionDevicePopup("",
"",!0,[""])}}]).controller("empty",["$scope","$route","Login",function(a,b,c){a.tab=b.current.tab;a.section=b.current.section;c.get()}]).controller("LoginCtrl",["$scope","$rootScope","$location","$routeParams","Login","SystemSettings","$timeout",function(a,b,c,d,e,f,g){function h(){var a=window.navigator.userAgent,b=a.indexOf("MSIE "),c=a.indexOf("Trident/");return 0<b?parseInt(a.substring(b+5,a.indexOf(".",b)),10):0<c?(b=a.indexOf("rv:"),parseInt(a.substring(b+3,a.indexOf(".",b)),10)):!1}a.cookiesEnabled=
"cookie"in document&&(0<document.cookie.length||-1<(document.cookie="test").indexOf.call(document.cookie,"test"));if(!a.cookiesEnabled&&h()){var k;k=-1!=c.$$host.indexOf("_")?!0:!1;k?a.isUrlError=!0:a.isUrlError=!1}a.cookiesEnabled?(a.username="admin",a.password="",a.showError=!1,a.showTimeout=!1,a.loggingIn=!1,a.showPassword=!1,a.setupRedirect=!0,a.requirePassword=!0,a.isWireless=!1,a.showPasswordForm=!0,d.setup&&(a.setupRedirect=d.setup),null!=d.fromlogout&&(a.showError=!0,a.errorMessage="User has logged out, please login again."),
e.get(function(){null==systemSettings?systemSettings=f.get(function(){b.loggedIn=!0;b.nextLocation&&"/login"!=b.nextLocation?c.path(b.nextLocation):c.path("/main");c.replace()}):(b.loggedIn=!0,b.nextLocation&&"/login"!=b.nextLocation?c.path(b.nextLocation):c.path("/main"),c.replace())},function(b){a.loggingIn=!0;a.timeout1=!1;a.timeout24=!1;switch(b.data.error){case 1:a.showError=!0,a.errorMessage=null!=d.rebooting?"Wireless Broadband Router is up again, please login:":"Connection has expired, please login again:";
default:a.passwordSalt=b.data.passwordSalt;if(!0==b.data.requirePassword||!1==b.data.requirePassword)a.requirePassword=b.data.requirePassword;if(!0==b.data.isWireless||!1==b.data.isWireless)a.isWireless=b.data.isWireless;a.showPasswordForm=a.isWireless||a.requirePassword?!0:!1;if(b.data.doSetupWizard&&"false"!==a.setupRedirect)c.path("/setup");else switch(b.data.denyState){case 1:a.timeout1=!0;g(function(){a.timeout1=!1;a.showError=!1},6E4*Number(b.data.denyTimeout));a.showError=!0;a.errorMessage=
"Login has been disabled for 1 minute. If you have not changed your password, you can find it on the router\u2019s sticker.";a.password="";break;case 2:a.timeout24=!0,g(function(){a.timeout24=!1;a.showError=!1},6E4*Number(b.data.denyTimeout)),a.showError=!0,a.errorMessage="Login has been disabled for 24 hours. Please wait 24 hours before trying again, or call Verizon for a password reset",a.password=""}}}),a.handleKeyPress=function(b){13==b&&a.login()},a.login=function(){var d={};d.password=CryptoJS.SHA512(a.password+
a.passwordSalt).toString();e.save({},d,function(){systemSettings=f.get(function(){b.loggedIn=!0;b.nextLocation&&"/login"!=b.nextLocation?c.path(b.nextLocation):c.path("/main");c.search({});c.replace()})},function(b){a.showError=!0;a.timeout24=!1;a.timeout1=!1;switch(b.data.denyState){case 1:a.timeout1=!0;g(function(){a.timeout1=!1;a.showError=!1},6E4*Number(b.data.denyTimeout));a.errorMessage="Login has been disabled for 1 minute. If you have not changed your password, you can find it on the router\u2019s sticker.";
a.password="";break;case 2:a.timeout24=!0;g(function(){a.timeout24=!1;a.showError=!1},6E4*Number(b.data.denyTimeout));a.errorMessage="Login has been disabled for 24 hours. Please wait 24 hours before trying again, or call Verizon for a password reset";a.password="";break;default:a.errorMessage=2==b.data.error?"Sessions Number: No more than "+b.data.maxUsers+" sessions at a time are allowed. Please wait until open sessions expire.":"Login failed, please try again:",a.password=""}})}):a.retry=function(){location.reload()}}]).controller("LogoutCtrl",
["$scope","$location","Logout",function(a,b,c){c.get(function(){b.path("/login").search({fromlogout:"true"});b.replace()})}]).controller("SetupCtrl",["$scope","$location","Login","Logout","Users","Wireless","SetupWizard","SystemSettings","$timeout","securityTips","WPA","$sce","WirelessUpdateAll","SaveWirelessSettings",function(a,b,c,d,e,f,g,h,k,l,r,m,n,v){a.page=1;a.dontShowAgain=!1;a.notConnected=!1;a.openGuestWifi=!1;a.restoreEnabled=!0;a.host=b.host();var s=0;d.get(function(){c.get(function(){},
function(b){a.passwordSalt=b.data.passwordSalt;a.isWireless=b.data.isWireless;a.timeout1=!1;a.timeout24=!1;switch(b.data.denyState){case 1:a.timeout1=!0;k(function(){a.timeout1=!1;a.errorMessage=""},6E4*Number(b.data.denyTimeout));break;case 2:a.timeout24=!0,k(function(){a.timeout24=!1;a.errorMessage=""},6E4*Number(b.data.denyTimeout))}})});a.saveAs=function(b){var c={};a.tempGuestEnabled?(c.guestEnable="On",c.guestSsid=a.wirelessGuest.ssid,c.guestPassword=a.openGuestWifi?"":a.wpaGuest.key):(c.guestEnable=
"Off",c.guestSsid="",c.guestPassword="");c.wifi24Ssid=a.wireless.ssid;c.wifi5Ssid=a.wireless1.ssid;c.wifiPassword=a.secKey;v.save({},c,function(){b||(a.page=5)})};a.print=function(){window.print()};a.showLastPage=function(){a.page=9};a.showSetup0HelpPassword=function(){l.showSetupHelpAdminPassword("","",!0,[""])};a.showSetup1HelpGuestWifiName=function(){l.showSetupHelpGuestWifiName("","",!0,[""])};a.showSetup1HelpGuestWifiOpen=function(){l.showSetupHelpGuestWifiOpen("","",!0,[""])};a.chkOpenGuestWifi=
function(){a.openGuestWifi&&a.showSetup1HelpGuestWifiOpen()};a.showSetup1HelpGuestWifiPassword=function(){l.showSetupHelpGuestWifiPassword("","",!0,[""])};a.showSetup1HelpWifiName=function(){l.showSetupHelpWifiName("","",!0,[""])};a.showSetup1HelpWifiName1=function(){l.showSetupHelpWifiName1("","",!0,[""])};a.showSetup1HelpWifiPassword=function(){l.showSetupHelpWifiPassword("","",!0,[""])};a.showSetupHelpLater=function(){a.dontShowAgain?c.update({doSetupWizard:!1},function(){a.redirectToVerizon()}):
l.showSetupHelpLater("","",!0,[""]).then(function(b){"cancel"!=b&&void 0!=b&&a.redirectToVerizon()})};a.nextAction=function(){a.dontShowAgain?c.update({doSetupWizard:!1},function(){b.path("/login")}):a.login()};a.redirectToVerizon=function(){window.location.href="http://verizon.com/"};a.handlePassKeyUp=function(b){13==b&&a.login()};a.doLater=function(){a.dontShowAgain?c.update({doSetupWizard:!1},function(){1==a.page?b.path("/login"):b.path("/main")}):1==a.page?b.path("/login").search({setup:"false"}):
b.path("/main")};a.skipSetup=function(){1==a.page?b.path("/login").search({setup:"false"}):b.path("/main")};a.getStarted=function(){a.setLoginSection()};a.loginCancelSetup=function(){b.path("/login").search({setup:"false"})};a.setLoginSection=function(){a.page=1;a.password="";a.showPassword=!1;a.errorMessage="";a.timeout24&&(a.errorMessage="Login has been disabled for 24 hours. Please wait 24 hours before trying again, or call Verizon for a password reset");a.timeout1&&(a.errorMessage="Login has been disabled for 1 minute. If you have not changed your password, you can find it on the router\u2019s sticker.")};
a.login=function(){var b={};b.password=CryptoJS.SHA512(a.password+a.passwordSalt).toString();c.save({},b,function(){systemSettings=h.get(function(){a.setEditSection(!1)})},function(b){a.timeout1=!1;a.timeout24=!1;switch(b.data.denyState){case 1:a.timeout1=!0;k(function(){a.timeout1=!1;a.errorMessage=""},6E4*Number(b.data.denyTimeout));a.errorMessage="Login has been disabled for 1 minute. If you have not changed your password, you can find it on the router\u2019s sticker.";a.password="";break;case 2:a.timeout24=
!0;k(function(){a.timeout24=!1;a.errorMessage=""},6E4*Number(b.data.denyTimeout));a.errorMessage="Login has been disabled for 24 hours. Please wait 24 hours before trying again, or call Verizon for a password reset";a.password="";break;default:a.errorMessage=2==b.data.error?"Sessions Number: No more than "+b.data.maxUsers+" sessions at a time are allowed. Please wait until open sessions expire.":"Login failed, please try again:",a.password=""}})};a.setEditSection=function(b){k(function(){a.showErrorPage=
!1;b||(a.page=2);a.isNewPassword=!1;a.isNewSsid=!1;a.isNewSsid1=!1;a.isNewWifiPw=!1;a.isNewGuestSsid=!1;a.isNewGuestWifiPw=!1;a.isNewGuestEnabled=!1;a.openGuestWifi=!1;a.oldOpenGuestWifi=!1;a.newPassword=a.password;a.rePassword="";a.restoreEnabled=!1;a.wireless=f.get({id:0},function(){a.wireless1=f.get({id:1},function(){a.wirelessGuest=f.get({id:2},function(){a.wpaGuest=r.get({id:2},function(){a.wireless.ssid=unescape(a.wireless.ssid);a.wireless1.ssid=unescape(a.wireless1.ssid);a.oldSsid=a.wireless.ssid;
a.oldSsid1=a.wireless1.ssid;a.dispSecurity="WPA2 Key";a.secKey=a.wireless.security.wpa.key;a.oldKey=a.secKey;a.oldGuestSsid=a.wirelessGuest.ssid;a.tempGuestEnabled=!1;a.oldGuestEnabled=a.tempGuestEnabled;a.oldGuestWifiPw="";a.tempGuestWifiPw="";a.wpaGuest.key=void 0!=a.wpaGuest.key?a.wpaGuest.key:"";a.oldGuestWifiPw=a.wpaGuest.key;a.tempGuestWifiPw=a.oldGuestWifiPw;b&&a.saveAs(!0)})})})});a.modifyWifi=!1;a.secType=3},200)};a.convertKey=function(a){var b="";if(a)for(var c=0;c<a.length;c++)b+="&bull;";
return b=unescape(b)};a.setMaxlength=function(a){return 1===Number(a)?13:63};a.secChanged=function(){0==a.secType?(a.dispSecurity="WPA2 Key",a.secKey=a.wireless.security.wpa.key):1==a.secType?(a.dispSecurity="WEP Key",a.secKey=a.wireless.security.wep.settings[0].key):3==a.secType?(a.dispSecurity="WPA2 Key",a.secKey=a.wireless.security.wpa.key):(a.dispSecurity="None",a.secKey="");a.oldKey=a.secKey;a.isNewWifiPw=!1};a.handleKeyPress=function(){a.isNewPassword=a.password!==a.newPassword};a.handleSsidChange=
function(){a.isNewSsid=a.oldSsid!==a.wireless.ssid;a.restoreEnabled=a.oldSsid!==a.wireless.ssid?!0:!1};a.handleSsid1Change=function(){a.isNewSsid1=a.oldSsid1!==a.wireless1.ssid;a.restoreEnabled=a.oldSsid1!==a.wireless1.ssid?!0:!1};a.handleWifiPwChange=function(){a.isNewWifiPw=a.oldKey!==a.secKey;a.restoreEnabled=a.oldKey!==a.secKey?!0:!1};a.handleGuestSsidChange=function(){a.isNewGuestSsid=a.oldGuestSsid!==a.wirelessGuest.ssid};a.handleGuestWifiPwChange=function(){a.isNewGuestWifiPw=a.oldGuestWifiPw!==
a.wpaGuest.key};a.editWifi=function(){a.modifyWifi=!0};a.errorPageOk=function(){a.showErrorPage=!1;window.scrollTo(0,0)};a.acceptSettings=function(){var b=!1;a.tempGuestEnabled&&(a.openGuestWifi||0==a.wpaGuest.key.length&&(b=!0));b?l.showSetupHelpGuestWifiPrompt("","",!0,[""]):a.acceptSettingsAfterValidation()};a.acceptSettingsAfterValidation=function(){a.errorMessages=[];a.isNewSsid&&(1>a.wireless.ssid.length||32<a.wireless.ssid.length||!/^[0-9a-zA-Z\!\"\#\$\%\&\u2019\'\(\)\*\+\,\-\.\/\:\;\<\=\>\?\@\[\\\]\^\_\`\{\|\}\~\ ]+$/i.test(a.wireless.ssid))&&
a.errorMessages.push("2.4 GHz Wi-Fi Service Set Identifier must consist of 1 to 32 printable ASCII characters.");a.isNewSsid1&&(1>a.wireless1.ssid.length||32<a.wireless1.ssid.length||!/^[0-9a-zA-Z\!\"\#\$\%\&\u2019\'\(\)\*\+\,\-\.\/\:\;\<\=\>\?\@\[\\\]\^\_\`\{\|\}\~\ ]+$/i.test(a.wireless1.ssid))&&a.errorMessages.push("5 GHz Wi-Fi Service Set Identifier must consist of 1 to 32 printable ASCII characters.");2!=a.secType&&(0==a.secType||3==a.secType?8>a.secKey.length?a.errorMessages.push("Wi-Fi Password has to be at least 8 characters long."):
/^[\x20-\x7E]+$/i.test(a.secKey)||a.errorMessages.push("Invalid Wi-Fi Password. Only ASCII characters are allowed."):13!=a.secKey.length?a.errorMessages.push("The WEP key must be a string of 13 characters."):/[\x21-\x7E]{13}$/i.test(a.secKey)||a.errorMessages.push("Invalid WEP Key. Only ASCII characters are allowed."));a.isNewPassword&&(a.newPassword!=a.rePassword?a.errorMessages.push("Passwords do not match."):0==a.newPassword.length&&a.errorMessages.push("A password must be specified."));a.tempGuestEnabled&&
((1>a.wirelessGuest.ssid.length||32<a.wirelessGuest.ssid.length||!/^[0-9a-zA-Z\!\"\#\$\%\&\u2019\'\(\)\*\+\,\-\.\/\:\;\<\=\>\?\@\[\\\]\^\_\`\{\|\}\~\ ]+$/i.test(a.wirelessGuest.ssid))&&a.errorMessages.push("Guest Wi-Fi name must be 1 to 32 printable ASCII characters.."),a.openGuestWifi||(0==a.wpaGuest.key.length?a.errorMessages.push("Please create a password for the Guest Wi-Fi network or select the option to Create without a password."):(8>a.wpaGuest.key.length||63<a.wpaGuest.key.length||!/^[\x20-\x7E]+$/i.test(a.wpaGuest.key))&&
a.errorMessages.push("Guest Wi-Fi password has to be at least 8 characters long.")));if(0<a.errorMessages.length)a.showErrorPage=!0;else{a.saveAs(!1);a.restoreEnabled=!1;a.tempGuestEnabled!==a.oldGuestEnabled&&(a.restoreEnabled=!0);if(a.tempGuestEnabled){if(a.isNewGuestSsid||a.isNewGuestWifiPw)a.restoreEnabled=!0;a.openGuestWifi!==a.oldOpenGuestWifi&&(a.restoreEnabled=!0)}if(a.isNewSsid||a.isNewSsid1||a.isNewWifiPw)a.restoreEnabled=!0}};a.saveSettings=function(){var b=[],c={id:2,security:{}};c.security.wpa=
{};c.enabled=!1;a.tempGuestEnabled?(c.enabled=!0,c.ssid=a.wirelessGuest.ssid,c.radioFreq=1,a.openGuestWifi?(c.security.wpa.key="",c.security.wpa.noPassword=!0):(c.security.wpa.key=a.wpaGuest.key,c.security.wpa.noPassword=!1)):(c.ssid=a.oldGuestSsid,c.radioFreq=-1);var d={security:{}},e={security:{}};d.id=0;e.id=1;d.ssid=a.wireless.ssid;e.ssid=a.wireless1.ssid;d.security.enabled=2!=a.secType;e.security.enabled=2!=a.secType;d.security.enabled&&(1==a.secType?(d.security.type=0,e.security.type=0):0==
a.secType?(d.security.type=1,e.security.type=1):3==a.secType&&(d.security.type=2,e.security.type=2),0==a.secType||3==a.secType?(d.security.wpa={key:a.secKey},e.security.wpa={key:a.secKey}):(d.security.wep={activeSetting:0,settings:[{key:a.secKey,keyLength:1,entryMethod:1}]},e.security.wep={activeSetting:0,settings:[{key:a.secKey,keyLength:1,entryMethod:1}]}));b.push(d);b.push(e);b.push(c);n.update({},{wifi:b},function(){});a.page=6};a.confirmSettings=function(){a.page=5};a.saveFile=function(){};a.checkCurrentConnection=
function(){a.isWireless?(a.page=7,a.notConnected=!1,s=0):a.page=9};a.checkConnection=function(){a.page=7;a.notConnected=!0;h.get(function(){k(function(){a.page=8},2E3)},function(b){200!=b.status&&(s++,3==s?(a.page=7,a.notConnected=!1,s=0):window.setTimeout(a.checkConnection,2E3))})};a.back=function(){switch(a.page){case 2:a.page=1;break;case 5:a.page=2}};a.keyPress=function(c){if(13==c.keyCode)switch(a.page){case 0:a.getStarted();break;case 1:a.nextAction();break;case 2:a.acceptSettings();break;case 4:a.confirmSettings();
break;case 5:a.saveSettings();break;case 6:a.checkCurrentConnection();break;case 7:a.checkConnection();break;case 8:a.showLastPage();break;case 9:b.path("/main")}}}]);function Route(a){var b={};b.type=a;b.destination="0.0.0.0";b.netmask="0.0.0.0";b.gateway="0.0.0.0";b.metric=3;return b}function setDeviceStyle(a,b){var c;switch(a.icon){case 0:c="computer";break;case 1:c="tablet";break;case 2:c="camera";break;case 3:c="printer";break;case 4:c="ip-stb";break;case 5:c="phone";break;case 6:c="nas";break;default:c="unknown"}c+="-image";a.status||(c+=" inact");""!=b&&(c+=" "+b);a.styleName=c}
angular.module("network.controllers",[]).controller("NetworkCtrl",["$scope","$route","Devices","$location","IPv6","securityTips","StopIPDevices",function(a,b,c,d,e,f,g){a.tab=b.current.tab;a.section=b.current.section;a.hasList0=!1;a.hasList1=!1;a.showList0=!1;a.showList1=!1;a.list0Count=0;a.list1Count=0;a.customSort=function(a,b){return"802.11b"==a.wifiModeStr&&"802.11b"==b.wifiModeStr?a.status&&b.status?0:a.status?-1:1:"802.11b"==a.wifiModeStr?-1:1};a.devices=c.query(function(){a.list0Count=0;a.list1Count=
0;a.hasList0=!1;a.hasList1=!1;for(var b=0;b<a.devices.length;b++){6!=a.devices[b].connectionType?a.list0Count++:6==a.devices[b].connectionType&&a.devices[b].approved&&a.list1Count++;a.devices[b].wifiModeStr=4==a.devices[b].connectionType||5==a.devices[b].connectionType||6==a.devices[b].connectionType||7==a.devices[b].connectionType?"802.11"+a.devices[b].wifiMode.toLowerCase():"";if(null==a.devices[b].isIptvClient||void 0==a.devices[b].isIptvClient)a.devices[b].isIptvClient=!1;if(null==a.devices[b].isInvalidatingIptvClient||
void 0==a.devices[b].isInvalidatingIptvClient)a.devices[b].isInvalidatingIptvClient=!1}a.devices.sort(a.customSort);3<a.list0Count&&(a.hasList0=!0);3<a.list1Count&&(a.hasList1=!0)});a.showDevice=function(b,c){return 0==b?a.showList0?!0:3>c?!0:!1:a.showList1?!0:3>c?!0:!1};a.toggleList=function(b,c){0==b?a.showList0=0==c?!1:!0:a.showList1=0==c?!1:!0};a.ipv6=e.get();a.deviceTypes=function(b){var c=0;angular.forEach(a.devices,function(a){a.connectionType==b?c+=1:5==b&&6==a.connectionType?c+=1:4==b&&7==
a.connectionType&&(c+=1);setDeviceStyle(a,"device");checkDeviceIP(a)});return c};a.checkNetworkConnections=function(){d.path("/network/connections")};a.blockDevice=function(b){for(var e,f=0;f<a.devices.length;f++)a.devices[f].id==b&&(a.devices[f].blocked=a.devices[f].blocked?!1:!0,e=a.devices[f]);c.update({id:b},e,function(){d.path("/network");window.scrollTo(0,0)})};a.stopIPTV=function(b){for(var c,e=0;e<a.devices.length;e++)a.devices[e].id==b&&(a.devices[e].isInvalidatingIptvClient=!0,c=a.devices[e]);
g.update({id:c.id},c,function(){d.path("/network");window.scrollTo(0,0)})};a.nonGuestDevice=function(a){return 6==Number(a.connectionType)?!1:!0};a.guestDevice=function(a){return 6==Number(a.connectionType)&&a.approved?!0:!1};a.clickBadConnectionDevicePopup=function(){f.showBadConnectionDevicePopup("","",!0,[""])}}]).controller("NetworkConnectionsCtrl",["$scope","$route","$location","NetworkConnections","$routeParams","SystemSettings","$templateCache","Devices","$rootScope","securityTips",function(a,
b,c,d,e,f,g,h,k,l){a.tab=b.current.tab;a.section=b.current.section;a.detectBroadband=!1;a.restarting=!1;a.rebootingPage=!1;a.getStyleName=function(a){switch(a){case 0:return"Network";case 1:return"Network";case 2:return"Wireless";case 3:return"Wireless";case 4:return"Ethernet";case 5:return"Coax";default:return"Network"}};null!=e.fromdevicenetwork&&c.path("/network/connections/0");a.checkForDevicesNow=function(a,b){var c=!1,d="";switch(String(b)){case "2":d="4";break;case "3":d="5";break;case "4":d=
"0";break;default:return!1}if(0<a.length){for(var e=0;e<a.length;e++){if(String(a[e].connectionType)==String(d)&&!0==a[e].status){c=!0;break}if("6"==String(a[e].connectionType)&&a[e].approved&&"5"==String(d)&&!0==a[e].status){c=!0;break}if("7"==String(a[e].connectionType)&&"4"==String(d)&&!0==a[e].status){c=!0;break}}return c}return!1};var r,m=h.query(function(){r=d.query(function(){a.names=[];for(var b=[],c=0;c<r.length;c++)if(!r[c].done&&(r[c].done=!0,r[c].isChild=!1,r[c].styleName=a.getStyleName(r[c].connectionId),
r[c].hasConnectedDeviceNow=a.checkForDevicesNow(m,r[c].connectionId),b.push(r[c]),a.names.push(unescape(r[c].name)),r[c].availableBridges))for(var d=0;d<r[c].availableBridges.length;d++){var e=r[c].availableBridges[d];r[c].bridged[d]&&(r[e].isChild=!0,r[e].done||(r[e].styleName="BridgedItem "+a.getStyleName(r[e].connectionId),b.push(r[e]),a.names.push(unescape(r[e].name)),r[e].done=!0,r[e].hasConnectedDeviceNow=a.checkForDevicesNow(m,r[e].connectionId)))}a.connections=b})});a.showChildren=k.connectionListIsAdvanced;
a.detectConfirm=function(){systemSettings.warnBeforeChanges?a.detectBroadband=!0:a.doDetectBroadband()};a.detectCancel=function(){a.detectBroadband=!1};a.doDetectBroadband=function(){d.update({id:1},{detectBroadband:!0},function(){a.rebootingPage=!0;window.setTimeout(a.testConnection,0)})};a.testConnection=function(){f.get(function(){window.setTimeout(a.testConnection,3E3)},function(b){401==b.status?(a.restarting=!0,g.removeAll(),window.location="/redirect.html?v=v1.0.184"):window.setTimeout(a.testConnection,
3E3)})};a.toggleChildren=function(){a.showChildren=!a.showChildren;k.connectionListIsAdvanced=!0==a.showChildren?!0:!1};a.checkNetworkConnections=function(){c.path("/network/connections")}}]).controller("NetworkConnectionCtrl",["$scope","$route","$routeParams","$location","NetworkConnections","Devices","securityTips",function(a,b,c,d,e,f,g){a.tab=b.current.tab;a.section=b.current.section;a.fromString="";a.oldFrom="";a.prev="";a.deviceBridge=[];if(null!=c.from){a.fromString="?from="+c.from;b=c.from.split("-");
"arptable"==b[b.length-1]?a.back="/advanced/arptable":"connlist"==b[b.length-1]?a.back="/advanced/dhcp/connections":"edit"==b[b.length-1]?a.back="/network/connections/0/edit":-1!=b[b.length-1].indexOf("dev_")?a.back="/network/device/details/"+b[b.length-1].substr(4):""===b[b.length-1]||isNaN(b[b.length-1])||(a.back="/network/connections/"+b[b.length-1]);for(var h=0;h<b.length-1;h++)0!=h&&(a.oldFrom+="-"),a.oldFrom+=b[h];""!==a.oldFrom&&(a.prev="?from="+a.oldFrom)}else a.back="/network/connections";
a.deviceNames=[];a.checkForDevicesNow=function(a,b){var c=!1,d="";switch(String(b)){case "2":d="4";break;case "3":d="5";break;case "4":d="0";break;default:return!1}if(0<a.length){for(var e=0;e<a.length;e++){if(String(a[e].connectionType)==String(d)&&!0==a[e].status){c=!0;break}if("6"==String(a[e].connectionType)&&a[e].approved&&"5"==String(d)&&!0==a[e].status){c=!0;break}if("7"==String(a[e].connectionType)&&"4"==String(d)&&!0==a[e].status){c=!0;break}}return c}return!1};a.showBridgeDeviceList=function(b){for(var c=
0;c<a.deviceBridge.length;c++)if(a.deviceBridge[c].name==b)return a.deviceBridge[c].toShowOut;return!0};a.findDeviceNames=function(b){for(var c=0;c<a.deviceBridge.length;c++)if(a.deviceBridge[c].name==b)return a.deviceBridge[c].realDeviceName};var k,l=f.query(function(){k=e.get({id:c.id},function(){a.name=unescape(k.name);a.deviceBridge=[];if(k.availableBridges)for(var b=0;b<k.availableBridges.length;b++){var c={};c.name=k.availableBridges[b];c.toShowOut=k.bridged[b];a.deviceBridge.push(c)}k.hasConnectedDeviceNow=
a.checkForDevicesNow(l,k.connectionId);a.connections=e.query(function(){for(var b=0;b<a.connections.length;b++);a.underlyingDevicesNames=[];if(k.underlyingDevices)for(angular.forEach(k.availableBridges,function(b){angular.forEach(a.connections,function(c){c.connectionId==b&&(a.underlyingDevicesNames.push(b),a.deviceNames.push(unescape(c.name)))})}),b=0;b<a.deviceBridge.length;b++)for(var c=0;c<a.connections.length;c++)if(a.connections[c].connectionId==a.deviceBridge[b].name){a.deviceBridge[b].realDeviceName=
unescape(a.connections[c].name);break}a.connection=k;a.connFromString=""===a.fromString?"?from="+a.connection.connectionId:a.fromString+"-"+a.connection.connectionId;a.showIpv6=!1;void 0!==k.ipv6Address&&"::"!==k.ipv6Address&&""!==k.ipv6Address&&(a.showIpv6=!0)})})});a.errorPageOk=function(){a.showErrorPage=!1;window.scrollTo(0,0)};a.refreshContentsNow=function(){location.reload()};a.toggleEnabled=function(){e.update({id:k.connectionId},{enabled:!k.enabled},function(){3==k.connectionId||2==k.connectionId?
(a.savePopup=g.showSaving1("Save Settings","Saving your settings. Please wait..."),window.setTimeout(a.refreshContentsNow,2E4)):a.refreshContentsNow()})};a.toggleCoaxEnabled=function(){e.update({id:k.connectionId},{coaxEnabled:!k.coaxEnabled},function(){3==k.connectionId||2==k.connectionId?(a.savePopup=g.showSaving1("Save Settings","Saving your settings. Please wait..."),window.setTimeout(a.refreshContentsNow,2E4)):a.refreshContentsNow()})};a.cancelBtn=function(){window.scrollTo(0,0);null!=c.fromsystemtraffic?
d.url("/monitoring/traffic"):null!=c.fromsystemfullstatus?d.url("/monitoring/fullstatus"):null!=c.fromdevicenetwork?d.url("/network/device/details/"+c.devicenum+"?fromdevicenetwork=true&devicenum="+c.devicenum):null!=c.connEdit?d.url("/network/connections/"+c.connEdit+"/edit"):d.url(a.back+a.prev)};a.saveName=function(b){a.errorMessages=[];a.connection.name=escape(a.name.replace(/^\s+|\s+$/g,"")).replace(/\+/g,"%2B");if(0==a.connection.name.length)a.errorMessages.push("Connection Name: Connection Name cannot be empty.");
else for(var f=0;f<a.connections.length;f++)f!=a.connection.connectionId&&unescape(a.connection.name)==unescape(a.connections[f].name)&&a.errorMessages.push("Connection Name:  Connection Name already in use.");0<a.errorMessages.length?(a.showErrorPage=!0,window.scrollTo(0,0)):e.update({id:b.connectionId},{name:a.connection.name},function(){window.scrollTo(0,0);null!=c.fromsystemtraffic?d.url("/monitoring/traffic"):null!=c.fromsystemfullstatus?d.url("/monitoring/fullstatus"):null!=c.fromdevicenetwork?
d.url("/network/device/details/"+c.devicenum+"?fromdevicenetwork=true&devicenum="+c.devicenum):null!=c.connEdit?d.url("/network/connections/"+c.connEdit+"/edit"):""==a.oldFrom?d.path(a.back).search({}):d.path(a.back).search({from:a.oldFrom})})};a.checkNetworkConnections=function(){d.path("/network/connections")};a.keyPress=function(b){13==b.keyCode&&d.path()=="/network/connections/"+c.id&&a.saveName(a.connection)}}]).controller("NetworkConnectionEditCtrl",["$scope","$route","$routeParams","$location",
"DhcpOptions","NetworkConnections","DhcpConnections","Routes","Devices","FirewallDMZ","QuantumSecurity",function(a,b,c,d,e,f,g,h,k,l,r){a.tab=b.current.tab;a.section=b.current.section;a.confirm=!1;a.messages=[];a.staticConnections=[];a.routesConnections=[];a.oldCoaxPassword="";var m={},n;a.coTempIPAddress="";a.coTempHomeName="";a.tempStatic={};a.listOfNetworkIPAddress=[];a.fromString=c.from?"?from="+c.from+"&connectionEdit="+c.id:"?connectionEdit="+c.id;a.getStyleName=function(a){switch(a){case 0:return"Network";
case 1:return"Network";case 2:return"Wireless";case 3:return"Wireless";case 4:return"Ethernet";case 5:return"Coax";default:return"Network"}};a.checkForDevicesNow=function(a,b){var c=!1,d="";switch(String(b)){case "2":d="4";break;case "3":d="5";break;case "4":d="0";break;default:return!1}if(0<a.length){for(var e=0;e<a.length;e++){if(String(a[e].connectionType)==String(d)&&!0==a[e].status){c=!0;break}if("6"==String(a[e].connectionType)&&a[e].approved&&"5"==String(d)&&!0==a[e].status){c=!0;break}if("7"==
String(a[e].connectionType)&&"4"==String(d)&&!0==a[e].status){c=!0;break}}return c}return!1};m=r.get(function(){a.qsOn=m.qsEnabled;n=k.query(function(){a.connection=f.get({id:c.id},function(){a.connection.styleName=a.getStyleName(c.id);if(a.connection.dhcpExpires){var b=a.connection.dhcpExpires;a.connection.dhcpExpireTime=0!=b?Math.ceil(b/60)+" minutes":"Expired"}a.name=unescape(a.connection.name);a.connection.name=unescape(a.connection.name);a.connection.hasConnectedDeviceNow=a.checkForDevicesNow(n,
a.connection.connectionId);a.oldsubnet=a.connection.subnetMask;a.oldProtocolUsed=a.connection.protocolUsed;switch(a.connection.type){case 3:a.connectionType="Ethernet";break;case 5:a.connectionType="Coax";break;case 4:a.connectionType="AP";break;default:a.connectionType="Basic"}1==a.connection.connectionId&&(a.tempStatic={ipAddress:a.connection.ipAddress,defaultGateway:a.connection.defaultGateway,primaryDnsServer:a.connection.primaryDnsServer,secondaryDnsServer:a.connection.secondaryDnsServer,subnetMask:a.connection.subnetMask},
a.connection.ipAddress=void 0!=a.connection.staticIpAddress?a.connection.staticIpAddress:a.connection.ipAddress,a.connection.defaultGateway=void 0!=a.connection.staticDefaultGateway?a.connection.staticDefaultGateway:a.connection.defaultGateway,a.connection.primaryDnsServer=void 0!=a.connection.staticPrimaryDnsServer?a.connection.staticPrimaryDnsServer:a.connection.primaryDnsServer,a.connection.secondaryDnsServer=void 0!=a.connection.staticSecondaryDnsServer?a.connection.staticSecondaryDnsServer:a.connection.secondaryDnsServer,
a.connection.subnetMask=void 0!=a.connection.staticSubnetMask?a.connection.staticSubnetMask:a.connection.subnetMask);a.connection.ipAddress&&(a.initialIpAddress=a.connection.ipAddress,a.ipAddress=splitIpArr(a.connection.ipAddress),a.subnetMask=splitIpArr(a.connection.subnetMask),null!=a.connection.defaultGateway&&(a.defaultGateway=splitIpArr(a.connection.defaultGateway)),a.connection.primaryDnsServer&&(a.primaryDnsServer=splitIpArr(a.connection.primaryDnsServer),a.secondaryDnsServer=splitIpArr(a.connection.secondaryDnsServer)));
1==a.connection.connectionId&&(a.oldCoaxPassword=a.connection.coaxPassword);a.bridges=null;a.connection.availableBridges&&(a.bridges=[],a.allConnections=f.query(function(){for(var b=0;b<a.connection.availableBridges.length;b++)for(var c=0;c<a.allConnections.length;c++)if(a.allConnections[c].connectionId==a.connection.availableBridges[b]){a.bridges.push(a.allConnections[c]);a.bridges[b].fromString=""===a.fromString?"?from=edit&connEdit="+a.connection.connectionId:a.fromString+"-edit&connEdit="+a.connection.connectionId;
a.bridges[b].styleName=a.getStyleName(a.bridges[b].connectionId);a.bridges[b].bridged=a.connection.bridged[b];a.bridges[b].name=unescape(a.bridges[b].name);a.bridges[b].hasConnectedDeviceNow=a.checkForDevicesNow(n,a.bridges[b].connectionId);break}}));a.dmz=l.get(function(){});a.connections=f.query(function(){var b=0;a.listOfNetworkIPAddress=[];for(var d=0;d<a.connections.length;d++){if(null!=a.connections[d].bridged)for(var f=0;f<a.connections[d].bridged.length;f++)a.connections[d].bridged[f]&&(a.connections[a.connections[d].availableBridges[f]].name=
2==a.connections[d].availableBridges[f]?unescape(a.connections[d].name)+" Wireless 802.11 2.4 GHz Access Point":3==a.connections[d].availableBridges[f]?unescape(a.connections[d].name)+" Wireless 802.11 5.0 GHz Access Point":unescape(a.connections[d].name+" "+a.connections[a.connections[d].availableBridges[f]].name));a.connections[d].name=unescape(a.connections[d].name);0==a.connections[d].connectionId&&(a.coTempHomeName=unescape(a.connections[d].name),a.coTempIPAddress=a.connections[d].ipAddress);
if(0==a.connections[d].connectionId||1==a.connections[d].connectionId)f={},f.id=a.connections[d].connectionId,f.ip=a.connections[d].ipAddress,f.name=unescape(a.connections[d].name),a.listOfNetworkIPAddress.push(f);a.connections[d].hasOwnProperty("connectionUsed")||(a.routesConnections[b]=a.connections[d],b++)}if(a.connection.dhcpSettings){a.dhcpOptions=e.query();a.dhcpStartIpAddress=splitIpArr(a.connection.dhcpSettings.startIpAddress);a.dhcpEndIpAddress=splitIpArr(a.connection.dhcpSettings.endIpAddress);
a.initialDhcpEndAddress=a.connection.dhcpSettings.endIpAddress;b=a.connection.dhcpSettings.winsServer;0==b.length&&(b="0.0.0.0");a.dhcpWinsServer=splitIpArr(b);var h=g.query({id:c.id},function(){for(var b=0;b<h.length;b++)1==h[b].ipAddressSource&&a.staticConnections.push(h[b].ipAddress)})}0!=c.id&&1!=c.id||a.refreshRoutes()})})})});a.enableCoax=function(){f.update({id:c.id},{coaxEnabled:!0},function(){a.connection=f.get({id:c.id})})};a.disableCoax=function(){f.update({id:c.id},{coaxEnabled:!1},function(){a.connection=
f.get({id:c.id})})};a.dhcpRelease=function(){f.save({id:c.id},{dhcpRelease:!0},function(){a.connection=f.get({id:c.id})})};a.dhcpRenew=function(){f.save({id:c.id},{dhcpRenew:!0},function(){a.connection=f.get({id:c.id})})};a.errorPageOk=function(){a.showErrorPage=!1;window.scrollTo(0,0)};a.checkMsg=function(a,b){for(var c=!1,d=0;d<a.length;d++)if(a[d]==b){c=!0;break}return c};a.checkMsg=function(a,b){for(var c=!1,d=0;d<a.length;d++)if(a[d]==b){c=!0;break}return c};a.save=function(){a.errorMessages=
[];a.messages=[];if(2==a.connection.mtuType){var b=!1;validRange(a.connection.mtu,68,1500)?checkForWholeNumbers(a.connection.mtu)&&(b=!0):b=!0;b&&a.errorMessages.push("MTU: The maximum transfer unit of "+a.connection.name+" should be between 68 and 1500. ")}var e=b=!1,f=!1,g=!1,h=!1,l=!1,r=!1,k="",m=!0;if(a.connection.ipAddress){if(2==a.connection.protocolUsed){var n=!1,t=!1;validateIp(a.ipAddress)?"0.0.0.0"==getNumIpString(a.ipAddress)&&(a.errorMessages.push("IP address may not be 0.0.0.0. IP address must consist of 4 fields. Each field's value must be between 0 and 255, without any spaces. At least one of the values must be greater than 0."),
t=n=!0):(a.errorMessages.push("IP Address: IP address must consist of 4 fields. Each field's value must be between 0 and 255, without any spaces."),t=n=!0);if(223<a.ipAddress[0]||0==a.ipAddress[0]||n)a.errorMessages.push("IP Address: Device IP address should start with a value between 1-223."),b=!0;0==a.connection.connectionId&&t&&a.errorMessages.push("IP Address already in use: IP address item is already in use by Port Forwarding.");validateIp(a.ipAddress)&&checkAllNetworks(a.listOfNetworkIPAddress,
a.ipAddress,a.connection.connectionId)&&(a.errorMessages.push("IP Address Already Exists: IP Address address "+getNumIpString(a.ipAddress)+" is already in use by "+checkAllNetworks4Name(a.listOfNetworkIPAddress,a.ipAddress,a.connection.connectionId)+"."),e=!0);b||e||!checkFor127(a.ipAddress)||(a.errorMessages.push("IP Address: IP addresses starting with 127 are not valid because they are reserved for loopback addresses."),h=!0)}t=n=!1;if(2==a.connection.protocolUsed||1==a.connection.protocolUsed)if(t=
!0,1!=a.connection.protocolUsed||a.connection.overrideSubnetMask||(t=!1),t){if(!validateIp(a.subnetMask)||checkFullListOfSubnetMaskRange(a.subnetMask))"0.0.0.0"!=getIpString(a.subnetMask)&&(n=!0,1==a.connection.connectionId&&1==a.connection.protocolUsed&&a.connection.overrideSubnetMask&&(n=!1),n?a.errorMessages.push("Subnet Mask: Subnet mask must consist of 4 fields. Each field's value must be between 0 and 255, constructing a contiguous string of binary ones. The default mask value is 255.255.255.0."):
a.errorMessages.push("Override Subnet Mask: Subnet mask must consist of 4 fields. Each field's value must be between 0 and 255, constructing a contiguous string of binary ones. The default mask value is 255.255.255.0.")),n=!0}else validateIp(a.subnetMask)||("0.0.0.0"!=getIpString(a.subnetMask)&&(n=!0,1==a.connection.connectionId&&1==a.connection.protocolUsed&&a.connection.overrideSubnetMask&&(n=!1),n?a.errorMessages.push("Subnet Mask: Subnet mask must consist of 4 fields. Each field's value must be between 0 and 255, constructing a contiguous string of binary ones. The default mask value is 255.255.255.0."):
a.errorMessages.push("Override Subnet Mask: Subnet mask must consist of 4 fields. Each field's value must be between 0 and 255, constructing a contiguous string of binary ones. The default mask value is 255.255.255.0.")),n=!0);0==a.connection.connectionId&&(checkForValidSubnetMaskRange(a.subnetMask)||n)&&(a.errorMessages.push("Subnet Mask: Subnet mask must be between 255.0.0.0 and 255.255.255.252."),n=!0);2==a.connection.protocolUsed&&a.defaultGateway&&!validateIp(a.defaultGateway)&&(a.errorMessages.push("Default Gateway: IP address must consist of 4 fields. Each field's value must be between 0 and 255, without any spaces."),
m=!1,l=!0);!b&&!1==n&&2==a.connection.protocolUsed&&validateIp(a.ipAddress)&&"0.0.0.0"!=getNumIpString(a.ipAddress)&&(checkHostVsSubmask(a.ipAddress,a.subnetMask)?(k="IP Address and Subnet Mask combination: The combination of IP address and subnet mask is invalid. All of the bits in the host address portion of the IP address are set to "+checkBits(a.ipAddress)+".",a.errorMessages.push(k),r=!0):(n=compareIpMaskNetwork(a.ipAddress,a.subnetMask),"2"!=n&&(k="IP Address and Subnet Mask combination: The combination of IP address and subnet mask is invalid. All of the bits in the network address portion of the IP address are set to "+
n+".",a.errorMessages.push(k),r=!0)));if(2==a.connection.protocolUsed&&a.defaultGateway&&m&&!r&&validateIp(a.ipAddress)&&getNumIpString(a.ipAddress)==getNumIpString(a.defaultGateway)){if(""!=k){f=[];for(n=0;n<a.errorMessages.length;n++)k!=a.errorMessages[n]&&f.push(a.errorMessages[n]);a.errorMessages=f}a.errorMessages.push("Incorrect Gateway IP: The Gateway cannot have the same IP address as the specified Wireless Broadband Router IP address.");f=!0}a.connection.primaryDnsServer&&1==a.connection.dnsMode&&
(validateIp(a.primaryDnsServer)||1!=a.connection.connectionId||a.errorMessages.push("Primary DNS Server: IP address must consist of 4 fields. Each field's value must be between 0 and 255, without any spaces."),validateIp(a.secondaryDnsServer)||1!=a.connection.connectionId||a.errorMessages.push("Secondary DNS Server: IP address must consist of 4 fields. Each field's value must be between 0 and 255, without any spaces."));(null==a.connection.deviceMetric||""===a.connection.deviceMetric||isNaN(a.connection.deviceMetric)||
0>a.connection.deviceMetric||255<a.connection.deviceMetric)&&a.errorMessages.push("Device Metric: Please enter a numeric value between 0 and 255.");k=getIpString(a.ipAddress);a.connection.dnsMode=parseInt(a.connection.dnsMode);t=m="";a.connection.primaryDnsServer&&(m=getIpString(a.primaryDnsServer),t=getIpString(a.secondaryDnsServer));var z=parseInt(a.connection.protocolUsed),B=a.connection.subnetMask;if(2==z||1==z)B=getIpString(a.subnetMask);var C=a.connection.defaultGateway;a.defaultGateway&&(C=
getIpString(a.defaultGateway));1==a.connection.type&&(a.connection.coaxPrivacy?a.connection.coaxAutoDetection?a.connection.coaxPasswordManual=a.oldCoaxPassword:((12>a.connection.coaxPasswordManual.length||17<a.connection.coaxPasswordManual.length)&&a.errorMessages.push("Coax Link Password: Password length should be between 12 and 17 characters."),0==a.connection.coaxPasswordManual.length?a.errorMessages.push("Coax Link Password: A number must be specified."):/^[0-9]+$/i.test(a.connection.coaxPasswordManual)||
a.errorMessages.push("Coax Link Password:  Only digits can be used for the number.")):a.connection.coaxPasswordManual=a.oldCoaxPassword);if(0==a.connection.type)"0.0.0.0"==B&&a.errorMessages.push((1==z&&a.connection.overrideSubnetMask?"Override ":"Subnet Mask: ")+"Subnet mask may not be 0.0.0.0. Subnet mask must consist of 4 fields. Each field's value must be between 0 and 255, constructing a contiguous string of binary ones. The default mask value is 255.255.255.0.");else if(1==a.connection.type){var D=
a.subnetMask;a.connection.overrideSubnetMask||1!=z||(D=splitIpArr(B));if((2==z||1==z&&a.connection.overrideSubnetMask)&&validateIp(D)){for(var E=!0,H=!1,n=0;4>n;n++){for(var F=7;-1<F;F--){var I=1==(D[n]>>F&1);if(I&&H){E=!1;break}I||(H=!0)}if(!E)break}n=!1;"0.0.0.0"==B&&(n=!0,1==a.connection.connectionId&&1==a.connection.protocolUsed&&a.connection.overrideSubnetMask&&(n=!1),n?a.errorMessages.push("Subnet Mask: Subnet mask may not be 0.0.0.0. Subnet mask must consist of 4 fields. Each field's value must be between 0 and 255, constructing a contiguous string of binary ones. The default mask value is 255.255.255.0."):
a.errorMessages.push("Override Subnet Mask: Subnet mask may not be 0.0.0.0. Subnet mask must consist of 4 fields. Each field's value must be between 0 and 255, constructing a contiguous string of binary ones. The default mask value is 255.255.255.0."),n=!0);if(!E)n=!0,1==a.connection.connectionId&&1==a.connection.protocolUsed&&a.connection.overrideSubnetMask&&(n=!1),l="",l=n?"Subnet Mask: Subnet mask must consist of 4 fields. Each field's value must be between 0 and 255, constructing a contiguous string of binary ones. The default mask value is 255.255.255.0.":
"Override Subnet Mask: Subnet mask must consist of 4 fields. Each field's value must be between 0 and 255, constructing a contiguous string of binary ones. The default mask value is 255.255.255.0.",a.checkMsg(a.errorMessages,l)||a.errorMessages.push(l);else if(2==z&&a.connection.defaultRoute&&"0.0.0.0"==C)a.errorMessages.push("Default Gateway: The Default Gateway must not be 0.0.0.0 while the Default Route is set.");else if(2==z&&"0.0.0.0"!=C&&!n&&validateIp(a.ipAddress)&&!(b||e||h||r||l)){for(n=
0;4>n;n++)if((D[n]&a.defaultGateway[n])!=(a.subnetMask[n]&a.ipAddress[n])){a.errorMessages.push("Wireless Broadband Router and Default Gateway Are Not on the Same Subnet: Under the given Netmask, the IP Address does not belong to the same Subnet as the Default Gateway.");g=!0;break}g||(checkHostVsSubmask(a.defaultGateway,a.subnetMask)?(a.errorMessages.push("Wireless Broadband Router and Default Gateway Are Not on the Same Subnet: Under the given Netmask, the IP Address does not belong to the same Subnet as the Default Gateway."),
g=!0):(n=compareIpMaskNetwork(a.defaultGateway,a.subnetMask),"2"!=n&&(a.errorMessages.push("Wireless Broadband Router and Default Gateway Are Not on the Same Subnet: Under the given Netmask, the IP Address does not belong to the same Subnet as the Default Gateway."),g=!0)))}}}0==a.connection.protocolUsed||1!=a.connection.dnsMode||1!=a.connection.connectionId||!a.connection.primaryDnsServer||b||e||f||g||h||(k==m&&1!=a.connection.protocolUsed?a.errorMessages.push("Primary DNS Server: DNS Server cannot have the IP address of Wireless Broadband Router "+
unescape(a.connection.name)+"."):m==a.coTempIPAddress&&a.errorMessages.push("Primary DNS Server: DNS Server cannot have the IP address of Wireless Broadband Router "+a.coTempHomeName+"."),k==t&&1!=a.connection.protocolUsed?a.errorMessages.push("Secondary DNS Server: DNS Server cannot have the IP address of Wireless Broadband Router "+unescape(a.connection.name)+"."):t==a.coTempIPAddress&&a.errorMessages.push("Secondary DNS Server: DNS Server cannot have the IP address of Wireless Broadband Router "+
a.coTempHomeName+"."),"0.0.0.0"!=m&&m==t&&a.errorMessages.push("Redundant DNS Entries: 'Primary' and 'Secondary' values may not point to the same DNS server."),"255.255.255.255"==m&&a.errorMessages.push("Primary DNS Server: "+m+" is invalid."),"255.255.255.255"==t&&a.errorMessages.push("Secondary DNS Server: "+t+" is invalid."));if(0!=a.errorMessages.length){a.showErrorPage=!0;window.scrollTo(0,0);return}2==a.connection.protocolUsed?(a.connection.ipAddress=k,a.defaultGateway&&(a.connection.defaultGateway=
C)):a.defaultGateway&&(a.connection.defaultGateway=null);void 0!==a.connection.routingMode&&(a.connection.routingMode=parseInt(a.connection.routingMode));a.connection.primaryDnsServer=m;a.connection.secondaryDnsServer=t;a.connection.protocolUsed=z;a.connection.subnetMask=B;0==c.id&&1==a.connection.protocolUsed&&2==a.oldProtocolUsed&&(a.messages.push({type:"DHCP Client:",data:"Configuring an internal connection to obtain an IP address automatically might make the connection inaccessible in case no IP address is obtained."}),
2==a.connection.dhcpSettings.mode&&a.messages.push({type:"IP Address Distribution:",data:"IP addresses cannot be distributed until the connection obtains its IP address."}));a.connection.ipAddress!=a.initialIpAddress&&(a.waitOnConfirm=!0,0==a.connection.connectionId&&a.messages.push({type:"Bridge IP Changed:",data:"  Please open a new browser with new address("+a.connection.ipAddress+") to access GUI"}),a.connection.dhcpSettings&&0!=a.connection.dhcpSettings.mode&&a.messages.push({type:"DHCP Leases:",
data:"There are dynamic DHCP leases outside the DHCP IP address range. All connected DHCP clients will need to request new IP addresses."}),0==a.connection.connectionId&&a.dmz.enabled&&(checkIf2IPAreInTheSameSubnetRange(a.ipAddress,splitIpArr(a.dmz.ip),a.subnetMask)||a.messages.push({type:"DMZ Host:",data:"DMZ Host will be disabled because the IP address currently assigned as the DMZ Host will be outside the valid IP address range. To enable DMZ Host please assign a valid IP address as the DMZ Host."})));
1==a.connection.connectionId&&1==a.connection.dnsMode&&"0.0.0.0"==a.connection.primaryDnsServer&&"0.0.0.0"==a.connection.secondaryDnsServer&&0!=a.connection.protocolUsed&&a.messages.push({type:"DNS Servers:",data:"No DNS Servers entered for this connection. This might cause name resolution problems."})}3!=a.connection.type&&5!=a.connection.type||!a.connection.coaxPrivacy||((12>a.connection.coaxPasswordManual.length||17<a.connection.coaxPasswordManual.length)&&a.errorMessages.push("Coax Link Password: Password length should be between 12 and 17 characters."),
0==a.connection.coaxPasswordManual.length?a.errorMessages.push("Coax Link Password: A number must be specified."):/^[0-9]+$/i.test(a.connection.coaxPasswordManual)||a.errorMessages.push("Coax Link Password: Only digits can be used for the number."));2!=a.connection.protocolUsed&&(a.connection.ipAddress=null);1!=a.connection.dnsMode&&(a.connection.primaryDnsServer=null,a.connection.secondaryDnsServer=null);if(0!=a.errorMessages.length)a.showErrorPage=!0,window.scrollTo(0,0);else{if(a.connection.dhcpSettings){b=
splitIpArr(a.connection.ipAddress);e=splitIpArr(a.connection.subnetMask);a.connection.dhcpSettings.mode=parseInt(a.connection.dhcpSettings.mode);if(2==a.connection.dhcpSettings.mode){if(a.connection.ipAddress!=a.initialIpAddress&&getIpString(a.dhcpEndIpAddress)==a.initialDhcpEndAddress)for(n=0;4>n;n++)a.dhcpStartIpAddress[n]=b[n]&e[n]|a.dhcpStartIpAddress[n]&~e[n],a.dhcpEndIpAddress[n]=b[n]&e[n]|a.dhcpEndIpAddress[n]&~e[n];for(n=0;n<a.staticConnections.length;n++)if(!isInRange(a.dhcpStartIpAddress,
a.dhcpEndIpAddress,splitIpArr(a.staticConnections[n]))){a.messages.push({type:"Static Leases:",data:"The Static lease configured IP's are no longer valid and requires manual UI updating to reflect the new IP configuration."});break}a.errorMessages=validateIPv4DhcpSettings(b,a.dhcpStartIpAddress,a.dhcpEndIpAddress,e,a.dhcpWinsServer,a.connection.dhcpSettings.leaseTime,a.connection.connectionId,a.connection.protocolUsed,a.connection.overrideSubnetMask,a.listOfNetworkIPAddress,!1);if(0!=a.errorMessages.length){a.showErrorPage=
!0;window.scrollTo(0,0);return}}a.connection.dhcpSettings.leaseTime=parseInt(a.connection.dhcpSettings.leaseTime);a.connection.dhcpSettings.mode=parseInt(a.connection.dhcpSettings.mode);a.connection.dhcpSettings.startIpAddress=getIpString(a.dhcpStartIpAddress);a.connection.dhcpSettings.endIpAddress=getIpString(a.dhcpEndIpAddress);validateIp(a.dhcpWinsServer)?(b=getIpString(a.dhcpWinsServer),a.connection.dhcpSettings.winsServer="0.0.0.0"!=b?b:""):a.connection.dhcpSettings.winsServer=""}if(a.bridges)for(!a.connection.bridged[0]&&
a.bridges[0].bridged&&a.messages.push({type:"Warning:",data:"Changing this configuration setting will impact router performance, and negatively impact video services and features.When in the 'bridge mode', the router and broadband service cannot be supported by the Service provider. Proceed with caution."}),n=0;n<a.bridges.length;n++)a.connection.bridged[n]=a.bridges[n].bridged;a.connection.mtuType=parseInt(a.connection.mtuType);1==a.connection.connectionId&&(0==a.connection.protocolUsed?(a.connection.staticIpAddress=
"",a.connection.staticDefaultGateway="",a.connection.staticPrimaryDnsServer="",a.connection.staticSecondaryDnsServer="",a.connection.staticSubnetMask=""):(1==a.connection.protocolUsed?1==a.connection.dnsMode?(a.connection.staticIpAddress="",a.connection.staticDefaultGateway="",a.connection.staticPrimaryDnsServer=a.connection.primaryDnsServer,a.connection.staticSecondaryDnsServer=a.connection.secondaryDnsServer):(a.connection.staticIpAddress="",a.connection.staticDefaultGateway="",a.connection.staticPrimaryDnsServer=
"",a.connection.staticSecondaryDnsServer=""):2==a.connection.dnsMode?(a.connection.staticIpAddress=a.connection.ipAddress,a.connection.staticDefaultGateway=a.connection.defaultGateway,a.connection.staticPrimaryDnsServer="",a.connection.staticSecondaryDnsServer=""):(a.connection.staticIpAddress=a.connection.ipAddress,a.connection.staticDefaultGateway=a.connection.defaultGateway,a.connection.staticPrimaryDnsServer=a.connection.primaryDnsServer,a.connection.staticSecondaryDnsServer=a.connection.secondaryDnsServer),
a.connection.staticSubnetMask=a.connection.subnetMask),a.connection.ipAddress=a.tempStatic.ipAddress,a.connection.defaultGateway=a.tempStatic.defaultGateway,1!=a.connection.dnsMode&&(a.connection.primaryDnsServer=a.tempStatic.primaryDnsServer,a.connection.secondaryDnsServer=a.tempStatic.secondaryDnsServer),a.connection.subnetMask=a.tempStatic.subnetMask);if(0!=a.messages.length&&systemSettings.warnBeforeChanges)a.confirm=!0,window.scrollTo(0,0);else{var J=a.connection.connectionId;a.connection.$update(function(){d.path("/network/connections/"+
J)})}}};a.changePrivacy=function(b){a.connection.coaxAutoDetection=!0};a.confirmChanges=function(){var b=a.connection.connectionId;a.connection.$update(function(){d.path("/network/connections/"+b)})};a.toggleEnabled=function(){};a.mtuTypeChanged=function(){a.connection.mtu=1500};a.protocolChanged=function(){1==a.connection.protocolUsed?a.connection.dnsMode=0:0==a.connection.dnsMode&&(a.connection.dnsMode=1)};a.refreshRoutes=function(){var b=h.get(function(){a.routes=[];for(var c=0;c<b.routes.length;c++)b.routes[c].type==
a.connection.connectionId&&a.routes.push(b.routes[c])})};if(0==c.id||1==c.id)a.connections=f.query(function(){for(var b=0;b<a.connections.length;b++){if(null!=a.connections[b].bridged)for(var c=0;c<a.connections[b].bridged.length;c++)a.connections[a.connections[b].availableBridges[c]].name=unescape(a.connections[b].name+a.connections[a.connections[b].availableBridges[c]].name);a.connections[b].name=unescape(a.connections[b].name)}}),a.editingRoute=!1,a.addNewRoute=function(){a.routeIndex=-1;a.routeEditing=
{type:a.connection.connectionId,destination:[0,0,0,0],netmask:[255,255,255,255],gateway:[0,0,0,0],metric:0};a.editingRoute=!0},a.editRoute=function(b){a.editingRoute=!0;var c=a.routes[b];a.routeIndex=b;a.routeEditing={type:c.type,destination:splitIpArr(c.destination),netmask:splitIpArr(c.netmask),gateway:splitIpArr(c.gateway),metric:c.metric}},a.deleteRoute=function(b){h.remove({id:a.routes[b].id},function(){a.refreshRoutes()})},a.cancelRouteEdit=function(){a.editingRoute=!1},a.saveRoute=function(){a.errorMessages=
[];validateIp(a.routeEditing.destination)||a.errorMessages.push("Destination: IP address must consist of 4 fields. Each field's value must be between 0 and 255, without any spaces.");validateIp(a.routeEditing.netmask)||a.errorMessages.push("Netmask: Subnet mask must consist of 4 fields. Each field's value must be between 0 and 255, constructing a contiguous string of binary ones. The default mask value is 255.255.255.0.");"0.0.0.0"==getIpString(a.routeEditing.netmask)&&a.errorMessages.push("Netmask: Subnet mask may not be 0.0.0.0. Subnet mask must consist of 4 fields. Each field's value must be between 0 and 255, constructing a contiguous string of binary ones. The default mask value is 255.255.255.0.");
"0.0.0.0"==getIpString(a.routeEditing.gateway)&&a.errorMessages.push("Gateway: IP Address may not be 0.0.0.0.");validateIp(a.routeEditing.gateway)||a.errorMessages.push("Gateway: IP address must consist of 4 fields. Each field's value must be between 0 and 255, without any spaces.");(null==a.routeEditing.metric||""===a.routeEditing.metric||isNaN(a.routeEditing.metric)||0>a.routeEditing.metric||255<a.routeEditing.metric)&&a.errorMessages.push("Metric: Please enter a numeric value between 0 and 255.");
0<a.errorMessages.length?(a.showErrorPage=!0,window.scrollTo(0,0)):(a.editingRoute=!1,a.routeEditing.type=parseInt(a.routeEditing.type),a.routeEditing.destination=getIpString(a.routeEditing.destination),a.routeEditing.netmask=getIpString(a.routeEditing.netmask),a.routeEditing.gateway=getIpString(a.routeEditing.gateway),a.routeEditing.metric=parseInt(a.routeEditing.metric),-1!=a.routeIndex?h.update({id:a.routes[a.routeIndex].id},a.routeEditing,function(){a.refreshRoutes()}):h.save(a.routeEditing,function(){a.refreshRoutes()}))};
a.checkNetworkConnections=function(){d.path("/network/connections")};a.keyPress=function(b){13==b.keyCode&&d.path()=="/network/connections/"+c.id+"/edit"&&(a.editingRoute||a.save())}}]).controller("DeviceDetailsCtrl",["$scope","$route","$routeParams","$location","Devices","NetworkConnections","Diagnostics","PortForward",function(a,b,c,d,e,f,g,h){a.tab=b.current.tab;a.section=b.current.section;a.close="#/network";a.forwards=["None"];a.showErrorPage=!1;a.devices=e.query();null!=c.from&&(a.close="#/"+
c.from);var k=f.get({id:0},function(){a.subnetMask=k.subnetMask});a.device=e.get({id:c.id},function(){setDeviceStyle(a.device,"");a.device=checkDeviceIP(a.device);a.oldName=a.device.name;a.connection=f.get({id:a.device.networkConnection},function(){a.connection.name=unescape(a.connection.name)});var b=h.query(function(){for(var c=[],d=0;d<b.length;d++)if(b[d].deviceIp==a.device.ipAddress){if(/^PortForward\_.*$/.test(b[d].name)){b[d].displayName="Destination Ports ";for(var e=[],f=0;f<b[d].protocols.length;f++){var g=
b[d].protocols[f];if(1==g.outgoingPorts){if(a.contains(e,g.outgoingPortStart))continue}else if(2==g.outgoingPorts&&a.contains(e,g.outgoingPortStart+"-"+g.outgoingPortEnd))continue;0<f&&(b[d].displayName+=",");b[d].displayName=0==g.outgoingPorts?b[d].displayName+"Any":1==g.outgoingPorts?b[d].displayName+g.outgoingPortStart:b[d].displayName+(g.outgoingPortStart+"-"+g.outgoingPortEnd)}}else b[d].displayName=b[d].name;c.push(b[d].displayName)}0!=c.length&&(a.forwards=c)})});a.contains=function(a,b){for(var c=
0;c<a.length;c++)if(a[c]===b)return!0;return!1};a.pingTest=function(){g.save({destination:a.device.ipAddress,count:4},function(){d.path("/advanced/diagnostics")})};a.errorPageOk=function(){a.showErrorPage=!1;window.scrollTo(0,0)};a.iconChanged=function(){a.device.icon=parseInt(a.device.icon);setDeviceStyle(a.device,"")};a.save=function(){a.errorMessages=[];for(var b=0;b<a.devices.length;b++)if(a.device.id!=b&&String(a.device.name).toLowerCase()==String(a.devices[b].name).toLowerCase()){a.errorMessages.push("Name: Name already exists in Wireless Broadband Router's database.");
break}63<a.device.name.length?a.errorMessages.push("New Name: Name may not contain spaces. Only letters, digits and the special characters dash (-), underscore (_) and dot (.) may be used. These special characters may not appear at the beginning or at the end of a name. The maximum length of a label (text between two dots) is 63."):validateHostnameDevice(a.device.name)||a.errorMessages.push("New Name: Name may not contain spaces. Only letters, digits and the special characters dash (-), underscore (_) and dot (.) may be used. These special characters may not appear at the beginning or at the end of a name. The maximum length of a label (text between two dots) is 63.");
0<a.errorMessages.length?(a.showErrorPage=!0,window.scrollTo(0,0)):a.device.$update(function(){d.path("/network")})};a.checkNetworkConnections=function(){d.path("/network/connections")};a.keyPress=function(a){13==a.keyCode&&d.path()=="/network/device/details/"+c.id&&(c.fromdevicenetwork?d.path("/network"):d.path("/main"))}}]).controller("WanCoaxStatsCtrl",["$scope","$route","$routeParams","$location","NetworkConnections",function(a,b,c,d,e){a.tab=b.current.tab;a.section=b.current.section;a.checkNetworkConnections=
function(){d.path("/network/connections")};a.coax=e.get({id:1});a.close=function(){c.fromdevicenetwork?d.path("/network").search({}):d.path("/network/connections/1/edit")}}]).controller("LanCoaxStatsCtrl",["$scope","$route","$routeParams","$location","NetworkConnections",function(a,b,c,d,e){a.tab=b.current.tab;a.section=b.current.section;a.checkNetworkConnections=function(){d.path("/network/connections")};a.coax=e.get({id:5});a.close=function(){c.fromdevicenetwork?d.path("/network").search({}):d.path("/network/connections/5/edit")}}]);angular.module("parental.controllers",[]).controller("ParentalAddCtrl",["$scope","$route","$routeParams","$location","Parental","Devices","SystemSettings","GuestDevices","QuantumSecurity",function(a,b,c,d,e,f,g,h,k){a.qsOn=!1;a.tab=b.current.tab;a.section=b.current.section;a.showErrorPage=!1;a.days=[!1,!1,!1,!1,!1,!1,!1];a.activeType=0;a.startHour=1;a.startMinute=0;a.startTime=0;a.endHour=1;a.endMinute=0;a.endTime=0;a.selectedAvailable=[];a.selectedUsed=[];a.availableDevices=[];a.usedDevices=[];a.embeddedKeyword=
"";a.website="";a.blocks=[];a.blockedItems=[];a.pageToShow=0;a.hasParentalRules=!1;a.sysSettings=g.get();a.togglePage=function(b){a.pageToShow=b;window.scrollTo(0,0)};a.changeDisplayNum=function(a){return 1<String(a).length?a:"0"+a};a.$watch("parentalControl.accessType",function(){a.checkAccessValue()});a.checkAccessValue=function(){if("Block_Selected"==a.parentalControl.name||"Allow_Only_Selected"==a.parentalControl.name||"Block_All"==a.parentalControl.name)0==a.parentalControl.accessType?a.parentalControl.name=
"Block_Selected":1==a.parentalControl.accessType?a.parentalControl.name="Allow_Only_Selected":2==a.parentalControl.accessType&&(a.parentalControl.name="Block_All");if("Block only websites with any of the listed words in their URLs."==a.parentalControl.description||"Allow only websites with any of the listed words in their URLs."==a.parentalControl.description||"Block access to all Internet services and websites."==a.parentalControl.description)0==a.parentalControl.accessType?a.parentalControl.description=
"Block only websites with any of the listed words in their URLs.":1==a.parentalControl.accessType?a.parentalControl.description="Allow only websites with any of the listed words in their URLs.":2==a.parentalControl.accessType&&(a.parentalControl.description="Block access to all Internet services and websites.")};a.parentalControl={name:"Block_Selected",enabled:!0,description:"Block only websites with any of the listed words in their URLs.",schedule:{name:"",activeDuring:!0,timeSegments:[{daysOfTheWeek:[],
hourRanges:[{startTimeHour:0,startTimeMinute:0,endTimeHour:0,endTimeMinute:0}]}]},accessType:0,restrictions:[],hosts:[],status:!0};var l=[],r={},m=e.query(function(){l=f.query(function(){r=k.get(function(){a.qsOn=r.qsEnabled;for(var b=0;b<l.length;b++)if(6!=l[b].connectionType){for(var d=!1,e=0;e<m.length;e++)for(var f=m[e],g=0;g<f.hosts.length;g++)if(f.hosts[g]==l[b].mac){d=!0;break}d||l[b].isStb||a.availableDevices.push(l[b].name)}for(b=0;b<l.length;b++)if(6==l[b].connectionType&&l[b].approved){d=
!1;for(e=0;e<m.length;e++)for(f=m[e],g=0;g<f.hosts.length;g++)if(f.hosts[g]==l[b].mac){d=!0;break}d||l[b].isStb||a.availableDevices.push(l[b].name)}if(void 0!==c.id&&m.length>c.id){f=m[c.id];a.parentalControl.accessType=f.accessType;a.parentalControl.name=f.name;a.parentalControl.description=f.description;a.parentalControl.schedule.activeDuring=f.schedule.activeDuring;for(g=0;g<f.schedule.timeSegments[0].daysOfTheWeek.length;g++)a.days[f.schedule.timeSegments[0].daysOfTheWeek[g]]=!0;b=f.schedule.timeSegments[0].hourRanges[0].startTimeHour;
d=f.schedule.timeSegments[0].hourRanges[0].startTimeMinute;e=f.schedule.timeSegments[0].hourRanges[0].endTimeHour;g=f.schedule.timeSegments[0].hourRanges[0].endTimeMinute;a.startHour=0==b?12:12<b?b-12:b;a.startHour=1<String(a.startHour).length?a.startHour:"0"+a.startHour;a.startTime=12<=b?1:0;a.startMinute=45==d?3:30==d?2:15==d?1:0;a.endHour=0==e?12:12<e?e-12:e;a.endHour=1<String(a.endHour).length?a.endHour:"0"+a.endHour;a.endTime=12<=e?1:0;a.endMinute=45==g?3:30==g?2:15==g?1:0;for(g=0;g<f.hosts.length;g++)for(b=
0;b<l.length;b++)f.hosts[g]==l[b].mac&&a.usedDevices.push(l[b].name);a.addDevices();for(g=0;g<f.restrictions.length;g++)a.parentalControl.restrictions.push(f.restrictions[g]),0==f.restrictions[g].type?a.blockedItems.push("Website: "+f.restrictions[g].value):a.blockedItems.push("Keyword: "+f.restrictions[g].value)}})})});a.errorPageOk=function(){a.showErrorPage=!1;window.scrollTo(0,0)};a.addDevices=function(){for(var b=0;b<a.selectedAvailable.length;b++)for(var c=0;c<a.availableDevices.length;c++)if(a.selectedAvailable[b]==
a.availableDevices[c]){a.availableDevices.splice(c,1);a.usedDevices.push(a.selectedAvailable[b]);break}a.selectedAvailable=[]};a.removeDevices=function(){for(var b=0;b<a.selectedUsed.length;b++)for(var c=0;c<a.usedDevices.length;c++)if(a.selectedUsed[b]==a.usedDevices[c]){a.usedDevices.splice(c,1);a.availableDevices.push(a.selectedUsed[b]);break}};a.addControls=function(){a.errorMessages=[];a.blockedWebsites=[];a.blockedKeywords=[];for(var b=0;b<a.blockedItems.length;b++){var c=a.blockedItems[b];
"website"==c.toString().split(":",1)[0].toLowerCase()?a.blockedWebsites.push(c):a.blockedKeywords.push(c)}if(50<=a.blockedWebsites.length&&""!=a.website)a.errorMessages.push("Blacklist Websites must not exceed 50 entries.");else if(50<=a.blockedKeywords.length&&""!=a.embeddedKeyword)a.errorMessages.push("Blacklist Keywords must not exceed 50 entries.");else{if(""!=a.embeddedKeyword)if(/^[0-9A-Z]+$/i.test(a.embeddedKeyword)){b=!0;for(c=0;c<a.parentalControl.restrictions.length;c++)if(1==a.parentalControl.restrictions[c].type&&
a.embeddedKeyword==a.parentalControl.restrictions[c].value){b=!1;break}b&&(a.parentalControl.restrictions.push({type:1,value:a.embeddedKeyword}),a.blockedItems.push("Keyword: "+a.embeddedKeyword))}else a.errorMessages.push("Keyword cannot contain special characters");if(""!=a.website)if(/^[0-9A-Z\*][0-9A-Z\.\-\*]+[0-9A-Z\*]$/i.test(a.website)){b=!0;for(c=0;c<a.parentalControl.restrictions.length;c++)if(0==a.parentalControl.restrictions[c].type&&a.website==a.parentalControl.restrictions[c].value){b=
!1;break}b&&(a.parentalControl.restrictions.push({type:0,value:a.website}),a.blockedItems.push("Website: "+a.website))}else a.errorMessages.push("Please input website only, not webpage address")}0<a.errorMessages.length&&(a.showErrorPage=!0,window.scrollTo(0,0))};a.removeControls=function(){for(var b=0;b<a.blocks.length;b++)for(var c=0;c<a.blockedItems.length;c++)if(a.blocks[b]==a.blockedItems[c]){a.blockedItems.splice(c,1);a.parentalControl.restrictions.splice(c,1);break}};a.cfmApplySettings=function(){e.save(a.parentalControl,
function(){d.path("/parental/summary");window.scrollTo(0,0)})};a.applySettings=function(){a.errorMessages=[];a.checkAccessValue();var b=0;""==a.parentalControl.name&&a.errorMessages.push("Policy: Rule name must be specified.");angular.forEach(m,function(d){d.name===a.parentalControl.name&&b!=c.id&&a.errorMessages.push("Policy: This name is already used by another rule.");b++});/^[0-9A-Z\!\-\_\.#']+$/i.test(a.parentalControl.name)||""===a.parentalControl.name||a.errorMessages.push('Policy: Rule name should consist of standard characters only (ASCII 32-126) excluding the special character space and any of :@"|\\/=+<>()[]{}&%^$*?,;');
2!=a.parentalControl.accessType&&0==a.parentalControl.restrictions.length&&a.errorMessages.push("Filter Websites or Keywords: List cannot be empty.");for(var f=!1,g=0;g<a.days.length;g++)a.days[g]&&(f=!0);f||a.errorMessages.push("Days of Week: At least one day must be selected.");if(0<a.errorMessages.length)a.showErrorPage=!0,window.scrollTo(0,0);else{for(g=0;g<a.usedDevices.length;g++)for(f=0;f<l.length;f++)if(l[f].name==a.usedDevices[g]){a.parentalControl.hosts.push(l[f].mac);break}for(g=0;g<a.days.length;g++)a.days[g]&&
a.parentalControl.schedule.timeSegments[0].daysOfTheWeek.push(g);g=parseInt(a.startHour)+12*a.startTime;0==g%12&&(g-=12);a.parentalControl.schedule.timeSegments[0].hourRanges[0].startTimeHour=g;g=parseInt(a.endHour)+12*a.endTime;0==g%12&&(g-=12);a.parentalControl.schedule.timeSegments[0].hourRanges[0].endTimeHour=g;a.parentalControl.schedule.timeSegments[0].hourRanges[0].startTimeMinute=15*a.startMinute;a.parentalControl.schedule.timeSegments[0].hourRanges[0].endTimeMinute=15*a.endMinute;void 0!==
c.id?e.update({id:c.id},a.parentalControl,function(){d.search({});d.path("/parental/summary");window.scrollTo(0,0)}):a.hasParentalRules?a.cfmApplySettings():!0==a.sysSettings.warnBeforeChanges?a.togglePage(1):a.cfmApplySettings()}};a.keyPress=function(b){13==b.keyCode&&"/parental"==d.path()&&a.applySettings()}}]).controller("ParentalSummaryCtrl",["$scope","$route","$location","Devices","Parental","SystemSettings","QuantumSecurity",function(a,b,c,d,e,f,g){a.qsOn=!1;a.tab=b.current.tab;a.section=b.current.section;
a.viewingRule=-1;a.pageToShow=0;a.selectedIndex=-1;a.enableRuleList=[];a.sysSettings=f.get();a.togglePage=function(b){a.pageToShow=b;window.scrollTo(0,0)};a.refresh=function(){a.qsOn=!1;a.enableRuleList=[];var b={};a.devices=d.query(function(){a.rules=e.query(function(){b=g.get(function(){a.qsOn=b.qsEnabled;for(var c=0;c<a.rules.length;c++){for(var d=0;d<a.rules[c].hosts.length;d++)for(var e=a.rules[c].hosts[d],f=0;f<a.devices.length;f++)if(e==a.devices[f].mac){a.rules[c].hosts[d]=a.devices[f].name;
break}a.rules[c].selected=a.rules[c].hosts[0]}})})})};a.togglePage=function(b){a.pageToShow=b;window.scrollTo(0,0)};a.refresh();a.editRule=function(a){c.path("/parental").search({id:a})};a.viewRule=function(b){a.viewingRule=b;a.selected=a.rules[b];a.selectedRestrictions=[];for(b=0;b<a.selected.restrictions.length;b++){var c=a.selected.restrictions[b];switch(c.type){case 0:a.selectedRestrictions.push("Website:"+c.value);break;default:a.selectedRestrictions.push("Keyword:"+c.value)}}b=[];printSchedule(0,
[a.selected.schedule],b);a.scheduleString=b[0][0]};a.cfmDeleteControl=function(){e.remove({id:a.selectedIndex},function(){a.togglePage(0);a.refresh()})};a.deleteRule=function(b){a.selectedIndex=b;!0==a.sysSettings.warnBeforeChanges?a.togglePage(1):a.cfmDeleteControl()};a.close=function(){a.viewingRule=-1};a.setSelected=function(b){var c=!1;a.rules[b].enabled=a.rules[b].enabled?!1:!0;if(null==a.enableRuleList||void 0==a.enableRuleList||0==a.enableRuleList.length)a.enableRuleList.push({id:b,rule:a.getMacHostsRule(a.rules[b])});
else{for(var d=0;d<a.enableRuleList.length;d++)if(a.enableRuleList[d].id==b){a.enableRuleList[d].rule=a.getMacHostsRule(a.rules[b]);c=!0;break}c||a.enableRuleList.push({id:b,rule:a.getMacHostsRule(a.rules[b])})}};a.getMacHostsRule=function(b){b=angular.copy(b);for(var c,d=0;d<b.hosts.length;d++){c=b.hosts[d];for(var e=0;e<a.devices.length;e++)if(c==a.devices[e].name||c==a.devices[e].mac){b.hosts[d]=a.devices[e].mac;break}}return b};a.restSelection=function(){a.refresh();a.togglePage(0)};a.applySettings=
function(){if(null!=a.enableRuleList&&0!=a.enableRuleList.length){for(var b=0;b<a.enableRuleList.length;b++)e.update({id:a.enableRuleList[b].id},a.enableRuleList[b].rule);a.refresh();a.togglePage(0)}};a.keyPress=function(b){13==b.keyCode&&"/parental/summary"==c.path()&&a.applySettings()}}]);angular.module("system.controllers",[]).controller("MonitoringCtrl",["$scope","$route","NetworkConnections","FirmwareUpgrade","SystemSettings","$timeout","$location",function(a,b,c,d,e,f,g){a.tab=b.current.tab;a.section=b.current.section;a.bb=null;a.valid=!0;a.autoRefresh=systemSettings.autoRefreshSystemMonitoring;a.timer=null;a.$on("$destroy",function(){a.valid=!1;clearTimeout(a.timer)});a.initialLoad=!0;a.refresh=function(){if(a.initialLoad||a.autoRefresh)a.initialLoad=!1,a.refreshContents(),a.autoRefresh&&
a.valid&&(a.timer=setTimeout(function(){a.refresh()},1E4))};a.refreshContents=function(){var b=e.get(function(){a.stats=b;var c=a.stats.uptime.split(":");2==c.length&&(a.stats.uptime=parseInt(c[0])+" hours, "+parseInt(c[1])+" minutes")}),f=c.get({id:1},function(){a.bb=f}),g=d.get(function(){a.fw=g})};a.refreshing=function(){location.reload()};a.toggleAutoRefresh=function(){clearTimeout(a.timer);a.systmSetngs=e.get();a.autoRefresh=!a.autoRefresh;a.systmSetngs.autoRefreshSystemMonitoring=a.autoRefresh;
a.systmSetngs.$update(function(){systemSettings=a.systmSetngs;a.autoRefresh&&a.refresh()})};a.refresh()}]).controller("MonitoringAdvCtrl",["$scope","$route","$routeParams",function(a,b,c){a.tab=b.current.tab;a.section=b.current.section;a.warning=!1;null!=c.warn&&(a.warning=!0)}]).controller("FullStatusCtrl",["$scope","$route","NetworkConnections","$location","$timeout","$routeParams","SystemSettings","Login","Devices","IPv6",function(a,b,c,d,e,f,g,h,k,l){a.tab=b.current.tab;a.section=b.current.section;
a.valid=!0;a.timer=null;a.autoRefresh=systemSettings.autoRefreshSystemMonitoring;a.$on("$destroy",function(){a.valid=!1;e.cancel(void 0);clearTimeout(a.timer)});a.refreshData=function(){a.initialLoad=!0;a.refresh()};a.checkForDevicesNow=function(a,b){var c=!1,d="";switch(String(b)){case "2":d="4";break;case "3":d="5";break;case "4":d="0";break;default:return!1}if(0<a.length){for(var e=0;e<a.length;e++){if(String(a[e].connectionType)==String(d)&&!0==a[e].status){c=!0;break}if("6"==String(a[e].connectionType)&&
a[e].approved&&"5"==String(d)&&!0==a[e].status){c=!0;break}if("7"==String(a[e].connectionType)&&"4"==String(d)&&!0==a[e].status){c=!0;break}}return c}return!1};a.initialLoad=!0;a.refresh=function(){if(a.initialLoad||a.autoRefresh){a.initialLoad=!1;var b,d=k.query(function(){a.ipv6=l.get(function(){b=c.query(function(){a.connections=b;for(var c=0;c<a.connections.length;c++)if(void 0!==a.connections[c].ipv6Address&&"::"!==a.connections[c].ipv6Address&&""!==a.connections[c].ipv6Address&&(a.showIpv6=
!0),a.connections[c].displayName=unescape(a.connections[c].name),a.connections[c].hasConnectedDeviceNow=a.checkForDevicesNow(d,a.connections[c].connectionId),a.connections[c].underlyingDevicesTempList=[],a.connections[0].availableBridges)for(var e=a.connections[c].connectionId,f=a.connections[0].availableBridges.length,g=0;g<f;g++)if(!0==a.connections[0].bridged[e]){a.connections[0].underlyingDevicesTempList.push(a.connections[0].availableBridges[e]);break}a.autoRefresh&&a.valid&&(a.timer=setTimeout(function(){a.refresh()},
1E4))})})})}};a.toggleAutoRefresh=function(){clearTimeout(a.timer);a.systmSetngs=g.get();a.autoRefresh=!a.autoRefresh;a.systmSetngs.autoRefreshSystemMonitoring=a.autoRefresh;a.systmSetngs.$update(function(){systemSettings=a.systmSetngs;a.autoRefresh&&a.refresh()})};a.close=function(){null!=f.frommain?d.url(d.path("/main")):(d.path("/monitoring/advanced"),window.scrollTo(0,0))};a.refresh()}]).controller("BandwidthCtrl",["$scope","$route","NetworkConnections","SystemSettings","$location",function(a,
b,c,d,e){a.tab=b.current.tab;a.section=b.current.section;a.valid=!0;a.timer=null;a.refreshData=function(){a.initialLoad=!0;a.refresh()};a.autoRefresh=systemSettings.autoRefreshSystemMonitoring;a.$on("$destroy",function(){a.valid=!1;clearInterval(a.timer)});a.initialLoad=!0;a.refresh=function(){if(a.initialLoad||a.autoRefresh){a.initialLoad=!1;var b=c.get({id:1},function(){a.bb=b;a.autoRefresh&&a.valid&&(a.timer=setTimeout(function(){a.refresh()},1E4))})}};a.toggleAutoRefresh=function(){clearTimeout(a.timer);
a.systmSetngs=d.get();a.autoRefresh=!a.autoRefresh;a.systmSetngs.autoRefreshSystemMonitoring=a.autoRefresh;a.systmSetngs.$update(function(){systemSettings=a.systmSetngs;a.autoRefresh&&a.refresh()})};a.refresh()}]).controller("SystemLogCtrl",["$scope","$route","$http","Log","SystemSettings",function(a,b,c,d,e){a.sysSettings=e.get();a.tab=b.current.tab;a.section=b.current.section;a.canClearLog=!0;a.logType="System";a.enableLogging=systemSettings.enableLogging;setupLoggingCtrl(a,0,c,d)}]).controller("SecurityLogCtrl",
["$scope","$route","$http","Log","SystemSettings",function(a,b,c,d,e){a.sysSettings=e.get();a.tab=b.current.tab;a.section=b.current.section;a.logType="Security";a.canClearLog=!0;a.enableLogging=systemSettings.enableLogging;setupLoggingCtrl(a,1,c,d)}]).controller("AdvancedLogCtrl",["$scope","$route","$http","Log","SystemSettings",function(a,b,c,d,e){a.sysSettings=e.get();a.tab=b.current.tab;a.section=b.current.section;a.logType="Advanced";a.canClearLog=!0;a.enableLogging=systemSettings.enableLogging;
setupLoggingCtrl(a,2,c,d)}]).controller("FirewallLogCtrl",["$scope","$route","$http","Log","SystemSettings",function(a,b,c,d,e){a.tab=b.current.tab;a.section=b.current.section;a.logType="Firewall";a.enableLogging=systemSettings.enableLogging;setupLoggingCtrl(a,3,c,d)}]).controller("WandhcpLogCtrl",["$scope","$route","$http","Log","SystemSettings",function(a,b,c,d,e){a.tab=b.current.tab;a.section=b.current.section;a.logType="WAN DHCP";a.enableLogging=systemSettings.enableLogging;setupLoggingCtrl(a,
4,c,d)}]).controller("LandhcpLogCtrl",["$scope","$route","$http","Log","SystemSettings",function(a,b,c,d,e){a.tab=b.current.tab;a.section=b.current.section;a.logType="LAN DHCP";a.enableLogging=systemSettings.enableLogging;setupLoggingCtrl(a,5,c,d)}]);function getIpString(a){return a[0]+"."+a[1]+"."+a[2]+"."+a[3]}function getTimeString(a){return a[0]+":"+a[1]}function getMacString(a){return a[0]+":"+a[1]+":"+a[2]+":"+a[3]+":"+a[4]+":"+a[5]}function splitIpArr(a){a=a.split(".");for(var b=0;b<a.length;b++)a[b]=parseInt(a[b],10);return a}function splitDateArr(a){return a.split(":")}function splitMacArr(a){return a.split(":")}
function validateIp(a){if(4!=a.length)return!1;for(var b=0;b<a.length;b++)if(""==String(a[b])||null==a[b]||isNaN(a[b])||isNotaInt(a[b])||0>a[b]||255<a[b]||!checksForValidIPInput(a[b])||!checksForWholeNumber(a[b]))return!1;return!0}function validateChecksForWholeNumber(a){for(var b=!0,c=0;c<a.length;c++)checksForWholeNumber(a[c])||(b=!1);return b}function isNotaInt(a){return null!=a&&void 0!=a?Number(a)===parseInt(Number(a))?!1:!0:!0}
function validateMulticastAddr(a){return validateIp(a)?224<=a[0]&&239>=a[0]:!1}function validateSubnetMask(a){if(!validateIp(a)||0==a[0])return!1;for(var b=!0,c=!1,d=0;4>d;d++){for(var e=7;-1<e;e--){var f=1==(a[d]>>e&1);if(f&&c){b=!1;break}f||(c=!0)}if(!b)break}return b}function validateMac(a){return/^[0-9A-F]{12}$/i.test(a.replace(RegExp(":","g"),""))}
function validateWepSettings(a,b,c,d){if(b||""!==a.key)switch(a.keyLength){case 0:switch(a.entryMethod){case 0:10==a.key.length?/[0-9A-F]{10}$/i.test(a.key)||d.push("Invalid "+c+" Password. Allowable values are 0-9 and a-f."):d.push(c+" Password must be a hexadecimal number of 10 digits.");break;case 1:5!=a.key.length?d.push(c+" Password must be a string of 5 characters."):/[\x21-\x7E]{5}$/i.test(a.key)||d.push("Invalid "+c+" Password. Only ASCII characters are allowed.")}break;case 1:switch(a.entryMethod){case 0:26==
a.key.length?/[0-9A-F]{26}$/i.test(a.key)||d.push("Invalid "+c+" Password. Allowable values are 0-9 and a-f."):d.push(c+" Password must be a hexadecimal number of 26 digits.");break;case 1:13!=a.key.length?d.push(c+" Password must be a string of 13 characters."):/[\x21-\x7E]{13}$/i.test(a.key)||d.push("Invalid "+c+" Password. Only ASCII characters are allowed.")}}}function validRange(a,b,c){return!(isNaN(a)||a<b||a>c)}
function validateTransmissionSettings(a,b,c,d,e){d&&e.groupKeyUpdateIntervalEnabled&&(!isNaN(e.groupKeyUpdateInterval)&&null!=e.groupKeyUpdateInterval&&checksForDecimalNumber(e.groupKeyUpdateInterval)&&checksForWholeNumber(e.groupKeyUpdateInterval)?(900>e.groupKeyUpdateInterval||86400<e.groupKeyUpdateInterval)&&c.push(b+" Group Key Update Interval:  Please enter a numeric value between 900 and 86400."):c.push(b+" Group Key Update Interval: Please enter a numeric value."));!isNaN(a.beaconInterval)&&
null!=a.beaconInterval&&checksForDecimalNumber(a.beaconInterval)&&checksForWholeNumber(a.beaconInterval)?(20>a.beaconInterval||1E3<a.beaconInterval)&&c.push(b+" Beacon Interval:  Beacon interval out of range (from=20, to=1000)"):c.push(b+" Beacon Interval: Please enter a numeric value.");!isNaN(a.dtimInterval)&&null!=a.dtimInterval&&checksForDecimalNumber(a.dtimInterval)&&checksForWholeNumber(a.dtimInterval)?(1>a.dtimInterval||255<a.dtimInterval)&&c.push(b+" DTIM Interval:  DTIM interval out of range (from=1, to=255)"):
c.push(b+" DTIM Interval: Please enter a numeric value.");!isNaN(a.fragmentationThreshold)&&null!=a.fragmentationThreshold&&checksForDecimalNumber(a.fragmentationThreshold)&&checksForWholeNumber(a.fragmentationThreshold)?(256>a.fragmentationThreshold||2346<a.fragmentationThreshold)&&c.push(b+" Fragmentation Threshold:  Fragmentation threshold out of range (from=256, to=2346)"):c.push(b+" Fragmentation Threshold: Please enter a numeric value.");null!=a.rtsThreshold&&""!==a.rtsThreshold&&!isNaN(a.rtsThreshold)&&
checksForDecimalNumber(a.rtsThreshold)&&checksForWholeNumber(a.rtsThreshold)?(0>a.rtsThreshold||2347<a.rtsThreshold)&&c.push(b+" RTS Threshold:  RTS Threshold out of range (from=0, to=2347)"):c.push(b+" RTS Threshold: Please enter a numeric value.");!isNaN(a.frameBurstMax)&&checksForDecimalNumber(a.frameBurstMax)&&checksForWholeNumber(a.frameBurstMax)?(2>a.frameBurstMax||255<a.frameBurstMax)&&c.push(b+" Frame Burst - Max Number: Max number of frames in a burst is out of range (from=2, to=255)"):c.push(b+
" Frame Burst - Max Number: Please enter a numeric value.");null!=a.frameBurstTime&&""!==a.frameBurstTime&&!isNaN(a.frameBurstTime)&&checksForDecimalNumber(a.frameBurstTime)&&checksForWholeNumber(a.frameBurstTime)?(0>a.frameBurstTime||1023<a.frameBurstTime)&&c.push(b+" Frame Burst - Burst Time: Burst time out of range (from=0, to=1023)"):c.push(b+" Frame Burst - Burst Time: Please enter a numeric value.");!isNaN(a.power)&&checksForDecimalNumber(a.power)&&checksForWholeNumber(a.power)?(1>a.power||
100<a.power)&&c.push(b+" Transmit Power: Please enter a numeric value between 1 and 100."):c.push(b+" Transmit Power: Please enter a numeric value.")}function isInRange(a,b,c){for(var d=0;4>d;d++)if(a[d]>c[d]||b[d]<c[d])return!1;return!0}
function validateIPv4DhcpSettings(a,b,c,d,e,f,g,h,k,l,r){var m=[],n=getSubnetID(a,d),v=angular.copy(n);v[3]=100;n=angular.copy(n);n[3]=150;var s=!1;validateIp(a)?r&&(validateChecksForWholeNumber(a)||(s=!0)):s=!0;s&&m.push("Invalid IP Address provided. Values must be between 0 and 255");s=!1;validateIp(b)?r&&(validateChecksForWholeNumber(b)||(s=!0)):s=!0;s&&m.push("Start IP Address: IP address must consist of 4 fields. Each field's value must be between 0 and 255, without any spaces.");s=!1;validateIp(c)?
r&&(validateChecksForWholeNumber(c)||(s=!0)):s=!0;s&&m.push("End IP Address: IP address must consist of 4 fields. Each field's value must be between 0 and 255, without any spaces.");validateIp(a)&&null!=l&&checkAllNetworks(l,a,g)&&$scope.errorMessages.push("IP Address Already Exists: IP Address address "+getNumIpString(a)+" is already in use by "+checkAllNetworks4Name(l,a,g)+".");r=l=!1;if(2==h||1==h)if(r=!0,1!=h||k||(r=!1),r){if(!validateIp(d)||checkFullListOfSubnetMaskRange(d))"0.0.0.0"!=getIpString(d)&&
m.push("Subnet Mask: Subnet mask must consist of 4 fields. Each field's value must be between 0 and 255, constructing a contiguous string of binary ones. The default mask value is 255.255.255.0."),l=!0}else validateIp(d)||("0.0.0.0"!=getIpString(d)&&m.push("Subnet Mask: Subnet mask must consist of 4 fields. Each field's value must be between 0 and 255, constructing a contiguous string of binary ones. The default mask value is 255.255.255.0."),l=!0);isIPWithinRange(b,v,n)&&isIPWithinRange(c,v,n)&&
m.push("Start IP Address, End IP Address: IP addresses between "+getIpString(v)+" and "+getIpString(n)+" are used for FiOS TV. Please select a start and/or end IP address outside of this reserved range.");0!=g||!checkForValidSubnetMaskRange(d)&&!0!=l||(m.push("Subnet Mask: Subnet mask must be between 255.0.0.0 and 255.255.255.252."),l=!0);!1==l&&2==h&&validateIp(a)&&"0.0.0.0"!=getNumIpString(a)&&(checkHostVsSubmask(a,d)?m.push("IP Address and Subnet Mask combination: The combination of IP address and subnet mask is invalid. All of the bits in the host address portion of the IP address are set to "+
checkBits(a)+"."):(g=compareIpMaskNetwork(a,d),"2"!=g&&m.push("IP Address and Subnet Mask combination: The combination of IP address and subnet mask is invalid. All of the bits in the network address portion of the IP address are set to "+g+".")));(!validateIp(e)||255<e[0]||255<e[1]||255<e[2]||255<e[3])&&m.push("WINS Server: IP address must consist of 4 fields. Each field's value must be between 0 and 255, without any spaces.");(isNaN(f)||1>f||43200<f||0!==f%1||!checksForWholeNumber(f))&&m.push("Lease Time in Minutes: Please enter a numeric value between 1 and 43200.");
"0.0.0.0"==getIpString(b)?m.push("Start IP Address: IP address may not be 0.0.0.0. IP address must consist of 4 fields. Each field's value must be between 0 and 255, without any spaces. At least one of the values must be greater than 0."):checkHostVsSubmask(b,d)&&"1"==checkBits(b)&&m.push("Start IP Address: "+b[0]+"."+b[1]+"."+b[2]+"."+b[3]+" isn't a valid address");"0.0.0.0"==getIpString(c)?m.push("End IP Address:  IP address may not be 0.0.0.0. IP address must consist of 4 fields. Each field's value must be between 0 and 255, without any spaces. At least one of the values must be greater than 0."):
checkHostVsSubmask(c,d)&&"1"==checkBits(c)&&m.push("End IP Address: "+c[0]+"."+c[1]+"."+c[2]+"."+c[3]+" isn't a valid address");if(0<m.length)return m;h=g=f=!0;e=!1;if((a[0]&d[0])!=(b[0]&d[0])||(a[1]&d[1])!=(b[1]&d[1])||(a[2]&d[2])!=(b[2]&d[2])||(a[3]&d[3])!=(b[3]&d[3]))g=!1;if((a[0]&d[0])!=(c[0]&d[0])||(a[1]&d[1])!=(c[1]&d[1])||(a[2]&d[2])!=(c[2]&d[2])||(a[3]&d[3])!=(c[3]&d[3]))h=!1;g&&h?validateDHCPRange(b,c,a,d)||m.push("Start IP Address, End IP Address: The DHCP IP address range does not conform to the connection IP address and the DHCP subnet mask."):
m.push((g?"":"Start IP Address")+(g||h?"":", ")+(h?"":"End IP Address")+":  The DHCP IP address range does not conform to the connection IP address and the DHCP subnet mask.");if(255==d[0]&&255==d[1]&&255==d[2]&&255==d[3]||d[0]<d[1]||d[1]<d[2]||d[2]<d[3])f=!1;g=!1;for(h=0;4>h;h++){for(k=7;-1<k;k--){if((v=1==(d[h]>>k&1))&&g){f=!1;break}v||(g=!0)}if(!f)break}if(f){f=f=d=!1;for(g=0;4>g;g++){h=b[g];k=c[g];h=Number(h);k=Number(k);k>h&&(f=!0);if(h>k&&!f)break;h!=k&&(d=!0)}getIpString(b)===getIpString(c)&&
(d=!0);d||(e=!0,m.push("IP Addresses: Start IP address is greater than End IP address."));if(f=isIPWithinRange(a,b,c))e=!0,m.push("IP Addresses: The Device's IP address should not be in the range of the IP pool");e||checkIPRange(b,c)||m.push("The number of IP Addresses in the DHCP IP address range must not be more than 256.")}else m.push("Subnet Mask: Subnet mask must consist of 4 fields. Each field's value must be between 0 and 255, constructing a contiguous string of binary ones. The default mask value is 255.255.255.0.");
return m}function validateIPv6(a){a=a.split(":");if(3>a.length||8<a.length)return!1;for(var b=0,c=0;c<a.length;c++)if(""===a[c])b++;else if(!/^[a-f0-9]{1,4}$/i.test(a[c]))return!1;return 1==b?""!==a[a.length-1]&&""!==a[0]:2==b?""===a[a.length-1]&&""===a[a.length-2]||""===a[1]&&""===a[0]:3==b&&3==a.length?!0:2<b?!1:8==a.length}
function getPrefixLength(a){if(!validateIPv6(a))return-1;a=a.split(":");for(var b=0,c=0,d=!1,c=a.length-1;0<=c;c--)if(""!==a[c]){var e=parseInt(a[c],16);if(0!==e){for(b=0;16>b;b++)if(1==(e>>b&1)){d=!0;break}if(d)break}}return d?16-b+16*c:-1}function validatePrefixLength(a){a=a.split("/");if(2!=a.length||!validateIPv6(a[0])||""===a[1]||isNaN(a[1]))return!1;var b=getPrefixLength(a[0]);return-1!=b&&128!=b&&b<=parseInt(a[1])&&16<=parseInt(a[1])}
function validateHostname(a){if(!/[a-z0-9]/i.test(a)||!/^[a-z0-9]$|^[a-z0-9][a-z0-9\_\-]{0,}[a-z0-9]$|^[a-z0-9][a-z0-9]{0,}[\.]{1}[a-z0-9]{0,}$|^[a-z0-9][a-z0-9]{0,}[\.]{1}[a-z0-9]{0,}[\.]{1}$|^(([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])\.){3}([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])$/i.test(a))return!1;a=a.split(".");for(var b=0;b<a.length;b++)if(63<a[b].length)return!1;return!0}
function validateHostnameDevice(a){if(!(/[a-z0-9]/i.test(a)&&/^[a-z0-9\_\-\.]{0,}$/i.test(a)&&/^[a-z0-9]$/i.test(a.substr(a.length-1))&&/^[a-z0-9]$/i.test(a.substr(0,1))))return!1;a=a.split(".");for(var b=0;b<a.length;b++)if(63<a[b].length)return!1;return!0}
function validateHostnameDNSServer(a){if(!/[a-z0-9]/i.test(a)||!/^[a-z0-9]$/i.test(a.substr(a.length-1)))return!1;if(-1!=a.indexOf("."))for(var b=a.split("."),c=0;c<b.length;c++){if(0==b[c].length||!/^[a-z0-9][a-z0-9\-\_]{0,}$/i.test(b[c])||!/^[a-z0-9]$/i.test(b[c].substr(b[c].length-1)))return!1}else if(!/^[a-z0-9][a-z0-9\-]{0,}[\.]{1}[a-z0-9][a-z0-9\-]{0,}[\.]{1}[a-z0-9][a-z0-9\-]{0,}[\.]{1}[a-z0-9][a-z0-9\-]{0,}[\.]{1}[a-z0-9]{0,}$|^[a-z0-9][a-z0-9\-]{0,}[\.]{1}[a-z0-9][a-z0-9\-]{0,}[\.]{1}[a-z0-9][a-z0-9\-]{0,}[\.]{1}[a-z0-9]{0,}$|^[a-z0-9][a-z0-9\-]{0,}[\.]{1}[a-z0-9][a-z0-9\-]{0,}[\.]{1}[a-z0-9]{0,}$|^[a-z0-9]$|^[a-z0-9][a-z0-9\_\-]{0,}[a-z0-9]$|^[a-z0-9][a-z0-9]{0,}[\.]{1}[a-z0-9]{0,}$|^[a-z0-9][a-z0-9]{0,}[\.]{1}[a-z0-9]{0,}[\.]{1}$|^(([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])\.){3}([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])$/i.test(a))return!1;
if(-1!=a.indexOf("--")||-1!=a.indexOf("-_")||-1!=a.indexOf("_-")||-1!=a.indexOf("__"))return!1;a=a.split(".");for(c=0;c<a.length;c++)if(63<a[c].length)return!1;return!0}
function validateHostnameDatetime(a){var b=/((\.\-|\-\.)|(\.\_|\_\.))/g,c=!1;if(!/[a-z0-9]/i.test(a)||!/^[a-z0-9][a-z0-9-_.]{0,}$/i.test(a)||-1!=a.search(/r?\.{2}?/g)||-1!=a.search(b))return!1;a=a.split(".");for(b=0;b<a.length;b++){if(63<a[b].length)return!1;4!=a.length&&/^.*[a-z][0-9]{0,}[^a-z0-9]*$/i.test(a[b])&&(c=!0)}return 4==a.length||c?!0:!1}
function validateLocalDomain(a){if(!/[a-z0-9]/i.test(a)||!/^[a-z0-9]$|^[a-z0-9][a-z0-9\-\_\.]{0,}[a-z0-9]$/i.test(a))return!1;a=a.split(".");for(var b=0;b<a.length;b++)if(63<a[b].length)return!1;return!0}
function validateLocalDomains(a){if(!/[a-z0-9]/i.test(a)||!/^[a-z0-9]$|^[a-z0-9][a-z0-9\-\_\.]{0,}[a-z0-9]$/i.test(a))return!1;for(var b=a.split("."),c=0;c<b.length;c++)if(63<b[c].length||0==b[c].length)return!1;return-1==a.indexOf("--")&&-1==a.indexOf("-.")&&-1==a.indexOf(".-")&&-1==a.indexOf("_-")&&-1==a.indexOf("__")&&-1==a.indexOf("_.")&&-1==a.indexOf("._")}function hasADot(a){return null!=a&&void 0!=a&&-1!=a.indexOf(".")?!0:!1}
function validateIpDomain(a){var b=splitIpArr(a);return validateIp(b)||validateIPv6(a)?!0:validateHostname(a)}function validateIpDomainDatetime(a){splitIpArr(a);return validateIPv6(a)?!0:validateHostnameDatetime(a)}
function isScheduleActive(a,b){if(null===a||"Always"===a||""===a)return"Active";var c=["Active","Inactive"];a.activeDuring||(c=["Inactive","Active"]);var d=b.day();0==d&&(d=7);for(var d=d-1,e=b.hour(),f=b.minute(),g=0;g<a.timeSegments.length;g++)if(-1!=String(a.timeSegments[g].daysOfTheWeek).indexOf(d))for(var h=0;h<a.timeSegments[g].hourRanges.length;h++){var k=a.timeSegments[g].hourRanges[h].startTimeHour,l=a.timeSegments[g].hourRanges[h].endTimeHour,r=a.timeSegments[g].hourRanges[h].startTimeMinute,
m=a.timeSegments[g].hourRanges[h].endTimeMinute;if(k==l&&r<=m){if(k==e&&l==e&&r<=f&&m>f)return c[0]}else if(k<l){if(e>k&&e<l||k==e&&f>=r||l==e&&f<m)return c[0]}else if(k<e||k==e&&r<=f||l>e||l==e&&m>f)return c[0]}return c[1]}
function parsePartial(a,b,c){var d=0;do{var e={};e.time=b.substring(c,c+20);var f=moment().subtract("days",1),g=moment().subtract("weeks",1),h=moment(b.substring(c,c+20),"MMM DD hh:mm:ss YYYY");e.soYday=h>f?"yes":"no";e.lWeek=h>g?1:0;f=b.indexOf("\n",c);-1==f&&(f=b.length);c=b.substring(c+20,f);-1==c.indexOf(":")?c=f+1:(g=c.substring(0,c.indexOf(":")).split(" "),e.event=g[2],e.type=g[1].split(".")[1],e.details=c.substring(c.indexOf(":")+1),a.push(e),c=f+1,d++)}while(100>d&&c<b.length);return c}
function validateGivenHostName(a){var b=!0;return b=RegExp(/^(?!:\/\/)([a-zA-Z0-9]+\.)?[a-zA-Z0-9][a-zA-Z0-9-]+\.[a-zA-Z]{2,6}?$/).test(a)}
function setupLoggingCtrl(a,b,c,d){a.valid=!0;a.logId=b;a.DisplayNum=50;a.logOpts="op1";a.refresh=function(){a.FDisplayNum=50;a.enableLogging&&c.get("/api/settings/log/"+a.logId).success(function(b,c,d,h){a.items=[];a.log=b;a.index=0;a.parseLog()})};a.$on("$destroy",function(){a.valid=!1});a.dateConvert=function(a,b,c){var d=a+":"+b;if(void 0!==a&&void 0!==b&&void 0!==c)return a=Number(d.match(/^(\d+)/)[1]),d=Number(d.match(/:(\d+)/)[1]),"PM"==c&&12>a&&(a+=12),"AM"==c&&12==a&&(a-=12),c=a.toString(),
b=d.toString(),10>a&&(c="0"+c),10>d&&(b="0"+b),c+":"+b+":00"};a.viewOpts=function(){a.showOpts=!0};a.showFiltered=function(b,c,d){a.showOpts=!1;a.filterItems=[];b=moment(b,"MMM DD hh:mm:ss YYYY");c=moment(c,"MMM DD hh:mm:ss YYYY");if(d instanceof Array)for(var h=0;h<d.length;h++)moment(d[h].time,"MMM DD hh:mm:ss YYYY")>b&&moment(d[h].time,"MMM DD hh:mm:ss YYYY")<c&&a.filterItems.push(d[h])};a.showNewLog=function(b){a.showOpts=!1};a.clearLogger=function(b){b&&(a.isOK=!0)};a.loadMore=function(b){a.DisplayNum+=
50};a.cancelOK=function(){a.isOK=!1;a.showOpts=!1};a.clearLog=function(){a.isOK=!1;d.remove({id:a.logId},function(){a.refresh()})};a.parseLog=function(){window.setTimeout(function(){a.index=parsePartial(a.items,a.log,a.index);a.$apply();a.valid&&a.index<a.log.length&&a.parseLog()},1)};a.refresh()}function compare(a,b){return a.name<b.name?-1:a.name>b.name?1:0}
function sortListItems(a){for(var b=[],c=0;c<a.length;c++){a[c].name=unescape(a[c].name);a[c].description=unescape(a[c].description);a[c].displayLabel=a[c].name;""!=a[c].description&&(a[c].displayLabel+=" ("+a[c].description+")");var d={};d.name=a[c].name.toLowerCase();d.oldName=a[c].name;b.push(d)}b.sort(compare);for(var d=[],e,c=0;c<b.length;c++)for(var f=0;f<a.length;f++)if(a[f].name===b[c].oldName){e=a[f];d.push(e);a.splice(f,1);break}return d}
function uuid(){var a="",b,c;for(b=0;32>b;b++){c=16*Math.random()|0;if(8==b||12==b||16==b||20==b)a+="-";a+=(12==b?4:16==b?c&3|8:c).toString(16)}return a}function checkDeviceIP(a){a.shownIPAddress=a.ipAddress;a.shownIP6Address=a.ipv6Address;!1==a.status&&("0.0.0.0"==a.ipAddress&&(a.shownIPAddress="n/a"),"::"==a.ipv6Address&&(a.shownIP6Address="n/a"));return a}function filterOutStb(a){for(var b=0;b<a.length;b++)a[b].isStb&&(a.splice(b,1),b--);return a}
function validateEmail(a){return/^[_a-z0-9-]+(\.[_a-z0-9-]+)*@[a-z0-9-]+(\.[a-z0-9-]+)*(\.[a-z]{2,4})$/.test(a)?!0:!1}
function findTimeNow(a){var b=parseInt(a.timeZone);switch(parseInt(a.timeZone)){case -5:b="EST5EDT";break;case -6:b="CST6CDT";break;case -7:b="MST7MDT";break;case -8:b="PST8PDT";break;case -9:b="America/Anchorage";break;case -10:b="HST";break;case -11:b="MST";break;default:b="WET"}if(void 0==moment.tz)return a=window.moment.unix(a.localTime).tz(b),window.moment(a);a=moment.unix(a.localTime).tz(b);return moment(a)}
function getStatusTitle(a){switch(Number(a)){case 0:return"Updated";case 1:return"In progress...";case 2:return"Router offline";case 3:return"DDNS server offline";case 4:return"Failed - Settings";case 5:return"Failed - Other";case 6:return"DDNS Server Error"}}function validateSubMask(a){return 255>a[0]||255>a[1]||254>a[2]?!1:!0}
function checkHostVsSubmask(a,b){var c=!1;return c="255"==b[0]&&"255"==b[1]&&"255"==b[2]&&"255"==b[3]?!0:"255"==b[0]&&"255"==b[1]&&"255"==b[2]&&"254"==b[3]?!0:"255"==b[0]&&"255"==b[1]&&"255"==b[2]&&"252"==b[3]?checkHostVsSubmaskRange(a,4):"255"==b[0]&&"255"==b[1]&&"255"==b[2]&&"248"==b[3]?checkHostVsSubmaskRange(a,8):"255"==b[0]&&"255"==b[1]&&"255"==b[2]&&"240"==b[3]?checkHostVsSubmaskRange(a,16):"255"==b[0]&&"255"==b[1]&&"255"==b[2]&&"224"==b[3]?checkHostVsSubmaskRange(a,32):"255"==b[0]&&"255"==
b[1]&&"255"==b[2]&&"192"==b[3]?checkHostVsSubmaskRange(a,64):"255"==b[0]&&"255"==b[1]&&"255"==b[2]&&"128"==b[3]?checkHostVsSubmaskRange(a,128):"255"==b[0]&&"255"==b[1]&&"255"==b[2]&&"0"==b[3]?checkHostVsSubmaskRange(a,256):"255"==b[0]&&"255"==b[1]&&"254"==b[2]&&"0"==b[3]?checkHostVsSubmaskRanges(a,256,2):"255"==b[0]&&"255"==b[1]&&"252"==b[2]&&"0"==b[3]?checkHostVsSubmaskRanges(a,256,4):"255"==b[0]&&"255"==b[1]&&"248"==b[2]&&"0"==b[3]?checkHostVsSubmaskRanges(a,256,8):"255"==b[0]&&"255"==b[1]&&"240"==
b[2]&&"0"==b[3]?checkHostVsSubmaskRanges(a,256,16):"255"==b[0]&&"255"==b[1]&&"224"==b[2]&&"0"==b[3]?checkHostVsSubmaskRanges(a,256,32):"255"==b[0]&&"255"==b[1]&&"192"==b[2]&&"0"==b[3]?checkHostVsSubmaskRanges(a,256,64):"255"==b[0]&&"255"==b[1]&&"128"==b[2]&&"0"==b[3]?checkHostVsSubmaskRanges(a,256,128):"255"==b[0]&&"255"==b[1]&&"0"==b[2]&&"0"==b[3]?checkHostVsSubmaskRanges(a,256,256):"255"==b[0]&&"254"==b[1]&&"0"==b[2]&&"0"==b[3]?checkHostVsSubmaskRanges1(a,256,2):"255"==b[0]&&"252"==b[1]&&"0"==b[2]&&
"0"==b[3]?checkHostVsSubmaskRanges1(a,256,4):"255"==b[0]&&"248"==b[1]&&"0"==b[2]&&"0"==b[3]?checkHostVsSubmaskRanges1(a,256,8):"255"==b[0]&&"240"==b[1]&&"0"==b[2]&&"0"==b[3]?checkHostVsSubmaskRanges1(a,256,16):"255"==b[0]&&"224"==b[1]&&"0"==b[2]&&"0"==b[3]?checkHostVsSubmaskRanges1(a,256,32):"255"==b[0]&&"192"==b[1]&&"0"==b[2]&&"0"==b[3]?checkHostVsSubmaskRanges1(a,256,64):"255"==b[0]&&"128"==b[1]&&"0"==b[2]&&"0"==b[3]?checkHostVsSubmaskRanges1(a,256,128):"255"==b[0]&&"0"==b[1]&&"0"==b[2]&&"0"==b[3]?
checkHostVsSubmaskRanges1(a,256,256):"254"==b[0]&&"0"==b[1]&&"0"==b[2]&&"0"==b[3]?checkHostVsSubmaskRanges2(a,256,2):"252"==b[0]&&"0"==b[1]&&"0"==b[2]&&"0"==b[3]?checkHostVsSubmaskRanges2(a,256,4):"248"==b[0]&&"0"==b[1]&&"0"==b[2]&&"0"==b[3]?checkHostVsSubmaskRanges2(a,256,8):"240"==b[0]&&"0"==b[1]&&"0"==b[2]&&"0"==b[3]?checkHostVsSubmaskRanges2(a,256,16):"224"==b[0]&&"0"==b[1]&&"0"==b[2]&&"0"==b[3]?checkHostVsSubmaskRanges2(a,256,32):"192"==b[0]&&"0"==b[1]&&"0"==b[2]&&"0"==b[3]?checkHostVsSubmaskRanges2(a,
256,64):"128"==b[0]&&"0"==b[1]&&"0"==b[2]&&"0"==b[3]?checkHostVsSubmaskRanges2(a,256,128):!0}function checkHostVsSubmaskRange(a,b){var c=!1;""==String(a[3])&&(c=!0);if(255<a[3]||0>a[3])c=!0;if(0==a[3]%b||a[3]%b==b-1)c=!0;return c}function checkHostVsSubmaskRanges(a,b,c){var d=!1;""==String(a[3])&&(d=!0);if(255<a[3]||0>a[3])d=!0;0==a[2]%c&&0==a[3]%b&&(d=!0);a[2]%c==c-1&&a[3]%b==b-1&&(d=!0);return d}
function checkHostVsSubmaskRanges1(a,b,c){b=!1;""==String(a[3])&&(b=!0);if(255<a[3]||0>a[3])b=!0;0==a[1]%c&&0==a[3]&&0==a[2]&&(b=!0);a[1]%c==c-1&&255==a[3]&&255==a[2]&&(b=!0);return b}function checkHostVsSubmaskRanges2(a,b,c){b=!1;""==String(a[3])&&(b=!0);if(255<a[3]||0>a[3])b=!0;0==a[0]%c&&0==a[3]&&0==a[2]&&0==a[1]&&(b=!0);a[0]%c==c-1&&255==a[3]&&255==a[2]&&255==a[1]&&(b=!0);return b}
function checkForValidSubnetMaskRange(a){var b=!1;if("255"==a[0]&&"255"==a[1]&&"255"==a[2])switch(String(a[3])){case "252":case "248":case "240":case "224":case "192":case "128":case "0":b=!1;break;default:b=!0}else if("255"==a[0]&&"255"==a[1]&&"0"==a[3])switch(String(a[2])){case "255":case "254":case "252":case "248":case "240":case "224":case "192":case "128":case "0":b=!1;break;default:b=!0}else if("255"==a[0]&&"0"==a[2]&&"0"==a[3])switch(String(a[1])){case "255":case "254":case "252":case "248":case "240":case "224":case "192":case "128":case "0":b=
!1;break;default:b=!0}else b=!0;return b}
function checkForValidSubnetMaskRangeBroadband(a){var b=!1;if("255"==a[0]&&"255"==a[1]&&"255"==a[2])switch(String(a[3])){case "252":case "248":case "240":case "224":case "192":case "128":case "0":b=!1;break;default:b=!0}else if("255"==a[0]&&"255"==a[1]&&"0"==a[3])switch(String(a[2])){case "255":case "254":case "252":case "248":case "240":case "224":case "192":case "128":case "0":b=!1;break;default:b=!0}else if("255"==a[0]&&"0"==a[2]&&"0"==a[3])switch(String(a[1])){case "255":case "254":case "252":case "248":case "240":case "224":case "192":case "128":case "0":b=!1;
break;default:b=!0}else if("0"==a[1]&&"0"==a[2]&&"0"==a[3])switch(String(a[0])){case "255":case "254":case "252":case "248":case "240":b=!1;break;default:b=!0}else b=!0;return b}
function checkFullListOfSubnetMaskRange(a){var b=!1;return b="0"==a[0]&&"0"==a[1]&&"0"==a[2]&&"0"==a[3]?!0:"255"!=a[0]||"255"!=a[1]||"255"!=a[2]||checkSubListOfSubnetMaskRange(a[3])?"255"!=a[0]||"255"!=a[1]||checkSubListOfSubnetMaskRange(a[2])||"0"!=String(a[3])?"255"!=a[0]||checkSubListOfSubnetMaskRange(a[1])||"0"!=String(a[2])||"0"!=String(a[3])?checkSubListOfSubnetMaskRange(a[0])||"0"!=String(a[1])||"0"!=String(a[2])||"0"!=String(a[3])?!0:!1:!1:!1:!1}
function checkSubListOfSubnetMaskRange(a){var b=!1;switch(String(a)){case "255":case "254":case "252":case "248":case "240":case "224":case "192":case "128":case "0":b=!1;break;default:b=!0}return b}function checkBits(a){return 0==a[3]%2?"0":"1"}function getNumIpString(a){return Number(a[0])+"."+Number(a[1])+"."+Number(a[2])+"."+Number(a[3])}function checkPortForwarding(a,b){for(var c=0;c<a.length;c++)if(a[c].deviceIp==getNumIpString(b))return!0;return!1}
function checkAllNetworks(a,b,c){for(var d=0;d<a.length;d++)if(a[d].id!=c&&a[d].ip==getNumIpString(b))return!0;return!1}function checkAllNetworks4Name(a,b,c){for(var d=0;d<a.length;d++)if(a[d].id!=c&&a[d].ip==getNumIpString(b))return a[d].name;return""}function checkForWholeNumbers(a){return a!=Math.round(a)?!0:!1}function checkFor127(a){return 127==a[0]?!0:!1}
function compareIpMaskNetwork(a,b){for(var c=convertValueto8Bits(a),d=convertValueto8Bits(b),c=c.split(""),d=d.split(""),e="",f="",g=0;g<d.length;g++)if("1"==d[g])if(""==f)f=c[g],e=c[g];else{if(c[g]!=f){e="2";break}}else break;return e}function convertValueto8Bits(a){for(var b="",c=0;c<a.length;c++)b+=convertIPto8Bits(a[c]);return b}
function convertIPto8Bits(a){a=Number(a);var b="";128<=a?(a-=128,b+="1"):b+="0";64<=a?(a-=64,b+="1"):b+="0";32<=a?(a-=32,b+="1"):b+="0";16<=a?(a-=16,b+="1"):b+="0";8<=a?(a-=8,b+="1"):b+="0";4<=a?(a-=4,b+="1"):b+="0";2<=a?(a-=2,b+="1"):b+="0";return 1<=a?b+"1":b+"0"}function checksForDecimalNumber(a){var b=!0;parseInt(a)!=a&&(b=!1);return b}function checksForWholeNumber(a){var b=!0;/^[0-9]*$/i.test(a)||(b=!1);return b}
function checkSubnetIp(a,b){for(var c=convertValueto8Bits(a),d=convertValueto8Bits(b),c=c.split(""),d=d.split(""),e=!0,f=0;f<d.length;f++)if("0"==d[f]&&"1"==c[f]){e=!1;break}return e}function checkMulticastVsList(a,b,c,d){var e=!0;if(0<b.length)for(var f=0;f<b.length;f++)if(f!=c)if("ip"==d){if(isIpTheSame(a,b[f].ip)){e=!1;break}}else if("address"==d&&isIpTheSame(a,b[f].address)){e=!1;break}return e}
function isIpTheSame(a,b){var c=!1,d=splitIpArr(b);Number(a[0])==Number(d[0])&&Number(a[1])==Number(d[1])&&Number(a[2])==Number(d[2])&&Number(a[3])==Number(d[3])&&(c=!0);return c}function isIPWithinRange(a,b,c){var d=!1;a=calDevices(a);b=calDevices(b);c=calDevices(c);b<=a&&a<=c&&(d=!0);return d}function calDevices(a){var b=0;0!=Number(a[0])&&(b+=16777216*Number(a[0]));0!=Number(a[1])&&(b+=65536*Number(a[1]));0!=Number(a[2])&&(b+=256*Number(a[2]));0!=Number(a[3])&&(b+=Number(a[3]));return b}
function checkIPRange(a,b){var c=!0;256<calDevices(b)-calDevices(a)+1&&(c=!1);return c}function checkIf2IPAreInTheSameSubnetRange(a,b,c){var d=!0;if((Number(a[0])&Number(c[0]))!=(Number(b[0])&Number(c[0]))||(Number(a[1])&Number(c[1]))!=(Number(b[1])&Number(c[1]))||(Number(a[2])&Number(c[2]))!=(Number(b[2])&Number(c[2]))||(Number(a[3])&Number(c[3]))!=(Number(b[3])&Number(c[3])))d=!1;return d}
function getSubnetID(a,b){for(var c=getBinary(a),d=getBinary(b),e=[],f=[],g=0;4>g;g++)e[g]=addBinary(d[g],c[g]).toString(10),f[g]=toDecimal(e[g]);return f}function validateDHCPRange(a,b,c,d){var e=null,e=getDHCPRange(c,d);return void 0!=e&&null!=e&&isIPWithinRange(a,e.START_ADDR,e.END_ADDR)&&isIPWithinRange(b,e.START_ADDR,e.END_ADDR)?!0:!1}
function getDHCPRange(a,b){var c=null,d=null,d=d=null,c={},d=getSubnetID(a,b),c=angular.copy(d);c[3]=parseInt(c[3])+1;d=getBroadCastAddress(b,d);d=angular.copy(d);d[3]=parseInt(d[3])-1;return c={START_ADDR:c,END_ADDR:d}}function getBroadCastAddress(a,b){getBinary(a);for(var c=getBinary(b),d=getInverseBinary(a),e=[],f=[],g=0;4>g;g++)e[g]=orBinary(d[g],c[g]).toString(10),f[g]=toDecimal(e[g]);return f}
function orBinary(a,b){for(var c=[],d,e=0;8>e;e++)c[e]=(parseInt(a[e])|parseInt(b[e])).toString(10),d=0==e?c[e]:d+c[e];return d}function getInverseBinary(a){for(var b=[],c=0;4>c;c++)b[c]=toInverseBinary(a[c]);return b}function toInverseBinary(a){a=parseInt(a,10).toString(2);for(var b,c=[1,1,1,1,1,1,1,1],d=0;8>d;d++)b=0==d?parseInt(parseInt(c[d])^parseInt(a[d])).toString(10):b+parseInt(parseInt(c[d])^parseInt(a[d])).toString(10);return b}
function addBinary(a,b){for(var c=[],d,e=0;8>e;e++)c[e]=(parseInt(a[e])&parseInt(b[e])).toString(10),d=0==e?c[e]:d+c[e];return d}function getBinary(a){for(var b=[],c=0;4>c;c++)b[c]=toBinary(a[c]);return b}function toBinary(a){a=parseInt(a,10).toString(2);var b=null;if(8>a.length){for(var b="0",c=8-a.length;1<c;c--)b+="0";b+=a}null==b&&(b=a);return b}var toDecimal=function(a){return parseInt(a,2).toString(10)};
function validateHostNameDHCPConnections(a){var b=!0;if(1>a.length)b=!1;else{var c=String(a).split("");/[a-zA-Z0-9]/i.test(c[0])||(b=!1);if(b&&1<a.length){/[a-z0-9]/i.test(c[c.length-1])||(b=!1);if(b&&2<a.length)for(var d=1;d<c.length-1;d++)if(!/[a-z0-9\-\_\.]/i.test(c[d])){b=!1;break}if(b)for(c=a.split("."),d=0;d<c.length;d++)if(63<c[d].length||0==c[d].length)b=!1;!b||-1==a.indexOf("-.")&&-1==a.indexOf(".-")&&-1==a.indexOf("_.")&&-1==a.indexOf("._")||(b=!1)}}return b}
function isAddressValidIPPattern(a){var b=!0;/^[0-9\.]/i.test(a)?(a=splitIpArr(a),validateIp(a)||(b=!1)):b=!1;return b}function filterOutGuest(a){for(var b=0;b<a.length;b++)6==Number(a[b].connectionType)&&(a.splice(b,1),b--);return a}function filterOutNonGuest(a){for(var b=0;b<a.length;b++)6!=Number(a[b].connectionType)?(a.splice(b,1),b--):a[b].approved||(a.splice(b,1),b--);return a}
function getNextLocationForLocationChange(a){a=String(a).split("#");return-1!=String(a[1]).indexOf("?")?(a=String(a[1]).split("?"),a[0]):a[1]}function getNextLocationForLocationChangeSub(a){a=String(a).split("?");return 2>a.length?"":a[1]}
function notAcceptedMac(a){switch(a.toLowerCase()){case "00:00:00:00:00:00":case "ff:ff:ff:ff:ff:ff":case "01:00:00:00:00:00":case "03:00:00:00:00:00":case "05:00:00:00:00:00":case "07:00:00:00:00:00":case "09:00:00:00:00:00":case "0b:00:00:00:00:00":case "0d:00:00:00:00:00":case "0f:00:00:00:00:00":return!1;default:return!0}}function checksForValidIPInput(a){var b=!0;/^[0-9\.]*$/i.test(a)||(b=!1);return b};angular.module("wireless.controllers",[]).controller("WirelessCtrl",["$scope","$route","Wireless","$rootScope",function(a,b,c,d){a.tab=b.current.tab;a.section=b.current.section;a.wirelessName=["2.4 GHz","5 GHz"];a.nMode=["Performance Mode","N Only Mode"];a.wirelessInterfaces=c.query(function(){for(var b=0;2>b;b++)a.wirelessInterfaces[b].security.wpa.key=a.wirelessInterfaces[b].security.wpa.key,a.wirelessInterfaces[b].ssid=a.wirelessInterfaces[b].ssid;a.wep=[];a.wep.push(a.wirelessInterfaces[0].security.wep.settings[a.wirelessInterfaces[0].security.wep.activeSetting]);
a.wep.push(a.wirelessInterfaces[1].security.wep.settings[a.wirelessInterfaces[1].security.wep.activeSetting]);d.wpsLinkEnable=a.wirelessInterfaces[0].radioEnabled||a.wirelessInterfaces[1].radioEnabled?!0:!1})}]).controller("WirelessAdvanceCtrl",["$scope","$route","Wireless",function(a,b,c){a.tab=b.current.tab;a.section=b.current.section;a.wirelessInterfaces=c.query(function(){a.wirelessA=a.wirelessInterfaces[0];a.w24wType=-1;a.wirelessA.security.enabled&&(a.w24wType=0==a.wirelessA.security.type?0:
1==a.wirelessA.security.wpa.type?1:2);a.wirelessB=a.wirelessInterfaces[1];a.w50wType=-1;a.wirelessB.security.enabled&&0!=a.wirelessB.security.type&&(a.w50wType=1==a.wirelessB.security.wpa.type?1:2)})}]).controller("WirelessBasicCtrl",["$scope","$route","Wireless","securityTips","$timeout","$location","WPS","$rootScope","WirelessUpdateAll",function(a,b,c,d,e,f,g,h,k){a.tab=b.current.tab;a.section=b.current.section;a.errorMessages=[];a.showErrorPage=!1;a.saveChannel=!1;a.hasApplyChanges=!1;a.wpsIsEnabled=
!1;a.wireless5Changed=!1;a.wirelessASecurityMode=-2;a.oldWirelessASecurityMode=-2;a.wirelessBSecurityMode=-2;a.lastWirelessSecurityMode=-2;a.needToToggleWirelessAMode=!1;var l=c.query(function(){a.wireless5Changed=!1;a.needToToggleWirelessAMode=!1;a.wirelessA=l[0];a.wirelessB=l[1];a.wirelessC=l[2];a.wirelessD=l[3];a.saveChannel=a.wirelessA.saveChannel;a.wepA={keyLength:a.wirelessA.security.wep.settings[a.wirelessA.security.wep.activeSetting].keyLength,entryMethod:a.wirelessA.security.wep.settings[a.wirelessA.security.wep.activeSetting].entryMethod,
key:a.wirelessA.security.wep.settings[a.wirelessA.security.wep.activeSetting].key};a.wepB={keyLength:a.wirelessB.security.wep.settings[a.wirelessB.security.wep.activeSetting].keyLength,entryMethod:a.wirelessB.security.wep.settings[a.wirelessB.security.wep.activeSetting].entryMethod,key:a.wirelessB.security.wep.settings[a.wirelessB.security.wep.activeSetting].key};a.wepChanged(a.wepA);a.wepChanged(a.wepB);a.oldAType=a.wirelessA.security.type;a.oldBType=a.wirelessB.security.type;a.wirelessA.ssid=a.wirelessA.ssid;
a.wirelessB.ssid=a.wirelessB.ssid;a.wAtype=a.wirelessA.security.enabled?0==a.wirelessA.security.type?0:1:1;a.wBtype=a.wirelessB.security.enabled?0==a.wirelessB.security.type?0:1:1;a.previousAIsWEP=!1;a.wirelessA.security.enabled&&0==a.wirelessA.security.type&&(a.previousAIsWEP=!0);h.wpsLinkEnable=a.wirelessA.radioEnabled||a.wirelessB.radioEnabled?!0:!1;a.hasApplyChanges=!1;var b=g.get({id:0},function(){a.wpsIsEnabled=b.enabled;a.wpsIsEnabled=a.wpsIsEnabled?!0:!1});a.lastWirelessSecurityMode=-2;a.wirelessASecurityMode=
-2;a.wirelessBSecurityMode=-2;a.oldWirelessASecurityMode=-2;a.wirelessASecurityMode=a.wirelessA.security.enabled?0==a.wirelessA.security.type?0:1==a.wirelessA.security.wpa.type?1:2:-1;a.oldWirelessASecurityMode=a.wirelessASecurityMode;a.wirelessB.security.enabled?0!=a.wirelessB.security.type&&(a.wirelessBSecurityMode=1==a.wirelessB.security.wpa.type?1:2):a.wirelessBSecurityMode=-1});a.wireless=l;a.rdbtnChange=function(b){-1==b&&d.showWEPMessage().then(function(b){"cancel"!=b&&void 0!=b&&a.check5GHzEnabled()})};
a.hasChanged5G=function(){a.wireless5Changed=!0};a.check5GHzEnabled=function(){!a.wirelessB.radioEnabled&&a.wireless5Changed?d.showAutoConnectMsgBasic("","").then(function(b){"cancel"!=b&&a.showNotifyRestartMsgPopup()}):a.showNotifyRestartMsgPopup()};a.errorPageOk=function(){a.showErrorPage=!1;window.scrollTo(0,0)};a.wepChanged=function(a){var b=10,b=0==a.keyLength?0==a.entryMethod?10:5:0==a.entryMethod?26:13;a.key.length>b&&(a.key=a.key.substr(0,b));a.charactersLeft=b-a.key.length};a.validateSsid=
function(b,c){(1>b.length||32<b.length||!/^[0-9a-zA-Z\!\"\#\$\%\&\u2019\'\(\)\*\+\,\-\.\/\:\;\<\=\>\?\@\[\\\]\^\_\`\{\|\}\~\ ]+$/i.test(b))&&a.errorMessages.push(c+" Service Set Identifier must consist of 1 to 32 printable ASCII characters.")};a.wirelessUpdate=function(){a.needToToggleWirelessAMode&&(a.wirelessA.mode=4,a.needToToggleWirelessAMode=!1);a.wirelessA.ssid=a.wirelessA.ssid;a.wirelessB.ssid=a.wirelessB.ssid;a.hasApplyChanges=!0;a.wirelessTempA=JSON.parse(JSON.stringify(a.wirelessA));a.wirelessTempB=
JSON.parse(JSON.stringify(a.wirelessB));0==a.wirelessASecurityMode?(delete a.wirelessA.security.wpa,a.wirelessA.security.wep.settings[a.wirelessA.security.wep.activeSetting]=a.wepA,a.wirelessA.security.type=0,a.wirelessA.security.enabled=!0):1==a.wirelessASecurityMode?(delete a.wirelessA.security.wep,a.wirelessA.security.wpa.type=1,a.wirelessA.security.type=2,a.wirelessA.security.enabled=!0):2==a.wirelessASecurityMode?(delete a.wirelessA.security.wep,a.wirelessA.security.wpa.type=0,a.wirelessA.security.type=
1,a.wirelessA.security.enabled=!0):-1==a.wirelessASecurityMode&&(delete a.wirelessA.security.wep,delete a.wirelessA.security.wpa,delete a.wirelessA.security.type,a.wirelessA.security.enabled=!1);0==a.wirelessBSecurityMode?(delete a.wirelessB.security.wpa,a.wirelessB.security.type=0,a.wirelessB.security.enabled=!0):1==a.wirelessBSecurityMode?(delete a.wirelessB.security.wep,a.wirelessB.security.wpa.type=1,a.wirelessB.security.type=2,a.wirelessB.security.enabled=!0):2==a.wirelessBSecurityMode?(delete a.wirelessB.security.wep,
a.wirelessB.security.wpa.type=0,a.wirelessB.security.type=1,a.wirelessB.security.enabled=!0):-1==a.wirelessBSecurityMode&&(delete a.wirelessB.security.wep,delete a.wirelessB.security.wpa,delete a.wirelessB.security.type,a.wirelessB.security.enabled=!1);var b=[];b.push(a.wirelessA);b.push(a.wirelessB);k.update({},{wifi:b},function(){a.wirelessA=a.wirelessTempA;a.wirelessB=a.wirelessTempB;d.showSaving("Save Settings","Saving your settings. Please wait...",2E4)})};a.checkWEP=function(){a.wirelessA.radioEnabled&&
0==a.wirelessASecurityMode&&!a.previousAIsWEP&&a.wpsIsEnabled&&4==a.wirelessA.mode?a.enableWEP():!a.wirelessA.radioEnabled||0!=a.wirelessASecurityMode||a.previousAIsWEP||!a.wpsIsEnabled&&1!=a.wirelessA.mode&&8!=a.wirelessA.mode?a.check5GHzEnabled():a.enableWEP1()};a.enableWEP=function(){d.showCustomMessage("Warning",["If WEP is enabled for the 2.4 GHz wireless network, then WPS will be disabled for the 2.4 GHz wireless network.","Are you sure you want to enable WEP?"]).then(function(b){"cancel"!=
b&&void 0!=b&&a.check5GHzEnabled()})};a.enableWEP1=function(){d.showCustomMessage1("Warning",["Turning on WEP will change your 2.4 GHz wireless mode to Legacy Mode (802.11b/g) and disable Wi-Fi Protected Setup.","Press OK to continue or Cancel."]).then(function(b){"cancel"!=b&&void 0!=b&&(a.needToToggleWirelessAMode=!0,a.check5GHzEnabled())})};a.validateWpaKey=function(b,c){8>b.length?a.errorMessages.push(c+" Password has to be at least 8 characters long."):/^[\x20-\x7E]+$/i.test(b)||a.errorMessages.push("Invalid "+
c+" Password. Only ASCII characters are allowed.")};a.save=function(){!1==a.hasApplyChanges&&(a.errorMessages=[],a.wirelessA.channelDesired=parseInt(a.wirelessA.channelDesired),a.wirelessB.channelDesired=parseInt(a.wirelessB.channelDesired),a.wepA.keyLength=parseInt(a.wepA.keyLength),a.wepA.entryMethod=parseInt(a.wepA.entryMethod),a.wepB.keyLength=parseInt(a.wepB.keyLength),a.wepB.entryMethod=parseInt(a.wepB.entryMethod),0==a.wirelessASecurityMode?validateWepSettings(a.wepA,!0,"2.4 GHz Wi-Fi",a.errorMessages):
1==a.wirelessASecurityMode?a.validateWpaKey(a.wirelessA.security.wpa.key,"2.4 GHz Wi-Fi"):2==a.wirelessASecurityMode&&a.validateWpaKey(a.wirelessA.security.wpa.key,"2.4 GHz Wi-Fi"),0==a.wirelessBSecurityMode?validateWepSettings(a.wepB,!0,"5.0 GHz Wi-Fi",a.errorMessages):1==a.wirelessBSecurityMode?a.validateWpaKey(a.wirelessB.security.wpa.key,"5 GHz Wi-Fi"):2==a.wirelessBSecurityMode&&a.validateWpaKey(a.wirelessB.security.wpa.key,"5 GHz Wi-Fi"),a.validateSsid(a.wirelessA.ssid,"2.4 GHz Wi-Fi"),a.validateSsid(a.wirelessB.ssid,
"5.0 GHz Wi-Fi"),0<a.errorMessages.length?(a.showErrorPage=!0,window.scrollTo(0,0)):(a.wirelessA.saveChannel=a.saveChannel,a.wirelessB.saveChannel=a.saveChannel,a.checkWEP()))};a.keyPress=function(b){13==b.keyCode&&"/wireless/basic"==f.path()&&a.save()};a.showNotifyRestartMsgPopup=function(){d.showNotifyRestartMsg("Warning",[""]).then(function(b){"cancel"!=b&&void 0!=b&&a.wirelessUpdate()})};a.hasChangedClicked24GWirelessMode=function(b){a.wirelessASecurityMode=b;a.lastWirelessSecurityMode=b;a.needToToggleWirelessAMode=
!1;-1==a.wirelessASecurityMode&&d.showSecurityModeNonePopup("","",!0,[""])};a.hasChangedClicked5GWirelessMode=function(b){a.wirelessBSecurityMode=b;a.lastWirelessSecurityMode=b;-1==a.wirelessBSecurityMode&&d.showSecurityModeNonePopup("","",!0,[""])}}]).controller("WirelessSSIDBroadcast",["$scope","$route","$routeParams","$location","Wireless","securityTips","WPS",function(a,b,c,d,e,f,g){a.tab=b.current.tab;a.section=b.current.section;a.wirelessWpsAreOn=!0;var h=c.id;0==h?(a.wirelessName="2.4 GHz",
a.wirelessType=0):(a.wirelessName="5 GHz",a.wirelessType=1);var k=g.get({id:0},function(){a.wpsEnabled=k.enabled;var b=e.query(function(){a.wirelessARadioEnabled=b[0].radioEnabled;a.wirelessAWpsEnabled=b[0].wpsEnabled;a.wirelessBRadioEnabled=b[1].radioEnabled;a.wirelessBWpsEnabled=b[1].wpsEnabled;a.wirelessARadioEnabled||a.wirelessBRadioEnabled||(a.wirelessWpsAreOn=!1);a.wirelessAWpsEnabled||a.wirelessBWpsEnabled||(a.wirelessWpsAreOn=!1);a.wpsEnabled&&!a.wirelessWpsAreOn&&(a.wpsEnabled=!1)})}),l=
e.get({id:h},function(){a.ssidBroadcast=l.ssidBroadcast});a.wirelessUpdate=function(){e.update({id:h},{ssidBroadcast:a.ssidBroadcast},function(){d.path("/wireless/advanced")})};a.check5GHzBroadcast=function(){f.showAutoConnectMsgBroadcast("","").then(function(b){"cancel"!=b&&a.showNotifyRestartMsgPopup()})};a.showNotifyRestartMsgPopup=function(){f.showNotifyRestartMsg("Warning",[""]).then(function(b){"cancel"!=b&&void 0!=b&&a.wirelessUpdate()})};a.save=function(){a.wpsEnabled&&!a.ssidBroadcast?f.showCustomMessage("Warning",
["If SSID Broadcast is disabled for the "+a.wirelessName+" wireless network, then WPS will also be disabled for the "+a.wirelessName+" wireless network.","Are you sure you want to disable SSID Broadcast?"]).then(function(b){"cancel"!=b&&void 0!=b&&(0==a.wirelessType?a.showNotifyRestartMsgPopup():a.check5GHzBroadcast())}):a.ssidBroadcast?a.showNotifyRestartMsgPopup():0==a.wirelessType?a.showNotifyRestartMsgPopup():a.check5GHzBroadcast()}}]).controller("WirelessMode",["$scope","$route","$location",
"Wireless","securityTips",function(a,b,c,d,e){a.tab=b.current.tab;a.section=b.current.section;var f=d.query(function(){a.modeA=f[0].mode;a.modeB=f[1].mode;a.wirelessAEnabled=f[0].radioEnabled;a.wAtype=f[0].security.enabled?0==f[0].security.type?0:1:1});a.wirelessUpdate=function(){d.update({id:0},{mode:parseInt(a.modeA)},function(){d.update({id:1},{mode:parseInt(a.modeB)},function(){c.path("/wireless/advanced")})})};a.enableWEP=function(){0!=a.wAtype||!a.wirelessAEnabled||1!=a.modeA&&8!=a.modeA?a.showNotifyRestartMsgPopup():
e.showCustomMessage2("Warning",["Compatibility Mode and Performance Mode are not compatible with WEP security. You must first select WPA/WPA2 Mixed Mode or WPA2 security before enabling Compatibility or Performance mode."])};a.save=function(){a.enableWEP()};a.showNotifyRestartMsgPopup=function(){e.showNotifyRestartMsg("Warning",[""]).then(function(b){"cancel"!=b&&void 0!=b&&a.wirelessUpdate()})}}]).controller("WirelessTransmissionCtrl",["$scope","$route","$routeParams","$location","WirelessTransmission",
"securityTips","Wireless","WirelessUpdateAll",function(a,b,c,d,e,f,g,h){a.tab=b.current.tab;a.section=b.current.section;a.errorMessages=[];a.showErrorPage=!1;a.confirmed=!(null!=c.warn&&"true"==c.warn);a.trans1OldGrpKeyValue=0;a.trans2OldGrpKeyValue=0;a.wirelessASecurity={};a.wirelessBSecurity={};a.wirelessInterfaces=g.query(function(){a.wirelessASecurity={};a.wirelessBSecurity={};a.wirelessA=a.wirelessInterfaces[0];a.trans1IsWPA2=!1;a.wirelessA.security.enabled&&0!=a.wirelessA.security.type&&(a.trans1IsWPA2=
!0);a.wirelessASecurity.groupKeyUpdateIntervalEnabled=a.wirelessA.security.wpa.groupKeyUpdateIntervalEnabled;a.wirelessASecurity.groupKeyUpdateInterval=a.wirelessA.security.wpa.groupKeyUpdateInterval;a.wirelessB=a.wirelessInterfaces[1];a.trans2IsWPA2=!1;a.wirelessB.security.enabled&&0!=a.wirelessB.security.type&&(a.trans2IsWPA2=!0);a.wirelessBSecurity.groupKeyUpdateIntervalEnabled=a.wirelessB.security.wpa.groupKeyUpdateIntervalEnabled;a.wirelessBSecurity.groupKeyUpdateInterval=a.wirelessB.security.wpa.groupKeyUpdateInterval;
a.trans1=e.get({id:0},function(){a.trans1OldGrpKeyValue=a.wirelessASecurity.groupKeyUpdateIntervalEnabled});a.trans2=e.get({id:1},function(){a.trans2OldGrpKeyValue=a.wirelessBSecurity.groupKeyUpdateIntervalEnabled})});a.runFocus=!1;a.errorPageOk=function(){a.showErrorPage=!1;window.scrollTo(0,0)};a.isConfirmed=function(){a.confirmed=!0;a.runFocus=!0};a.keyPress=function(b){13==b.keyCode&&!a.showErrorPage&&a.confirmed&&a.save()};a.save=function(){a.errorMessages=[];a.trans1.ctsProtection=parseInt(a.trans1.ctsProtection);
a.trans1.ctsProtectionType=parseInt(a.trans1.ctsProtectionType);a.trans2.ctsProtection=parseInt(a.trans2.ctsProtection);a.trans2.ctsProtectionType=parseInt(a.trans2.ctsProtectionType);validateTransmissionSettings(a.trans1,"2.4 GHz Wi-Fi",a.errorMessages,a.trans1IsWPA2,a.wirelessASecurity);validateTransmissionSettings(a.trans2,"5.0 GHz Wi-Fi",a.errorMessages,a.trans2IsWPA2,a.wirelessBSecurity);0<a.errorMessages.length?(a.showErrorPage=!0,window.scrollTo(0,0)):a.showNotifyRestartMsgPopup()};a.saveSettings=
function(){var b=[],c={security:{wpa:{}}},e={security:{wpa:{}}};c.id=0;e.id=1;c.security.wpa.groupKeyUpdateIntervalEnabled=a.wirelessASecurity.groupKeyUpdateIntervalEnabled;c.security.wpa.groupKeyUpdateInterval=a.wirelessASecurity.groupKeyUpdateIntervalEnabled?a.wirelessASecurity.groupKeyUpdateInterval:0;e.security.wpa.groupKeyUpdateIntervalEnabled=a.wirelessBSecurity.groupKeyUpdateIntervalEnabled;e.security.wpa.groupKeyUpdateInterval=a.wirelessBSecurity.groupKeyUpdateIntervalEnabled?a.wirelessBSecurity.groupKeyUpdateInterval:
0;a.trans1IsWPA2&&b.push(c);a.trans2IsWPA2&&b.push(e);(a.trans1IsWPA2||a.trans2IsWPA2)&&h.update({},{wifi:b},function(){});d.path("/wireless/advanced")};a.showNotifyRestartMsgPopup=function(){f.showNotifyRestartMsg("Warning",[""]).then(function(b){"cancel"!=b&&void 0!=b&&(a.wirelessASecurity.groupKeyUpdateInterval=parseInt(a.wirelessASecurity.groupKeyUpdateInterval),a.wirelessBSecurity.groupKeyUpdateInterval=parseInt(a.wirelessBSecurity.groupKeyUpdateInterval),a.trans1.channelWidth=parseInt(a.trans1.channelWidth),
a.trans2.channelWidth=parseInt(a.trans2.channelWidth),a.trans1.beaconInterval=parseInt(a.trans1.beaconInterval),a.trans2.beaconInterval=parseInt(a.trans2.beaconInterval),a.trans1.dtimInterval=parseInt(a.trans1.dtimInterval),a.trans2.dtimInterval=parseInt(a.trans2.dtimInterval),a.trans1.fragmentationThreshold=parseInt(a.trans1.fragmentationThreshold),a.trans2.fragmentationThreshold=parseInt(a.trans2.fragmentationThreshold),a.trans1.rtsThreshold=parseInt(a.trans1.rtsThreshold),a.trans2.rtsThreshold=
parseInt(a.trans2.rtsThreshold),a.trans1.frameBurstMax=parseInt(a.trans1.frameBurstMax),a.trans2.frameBurstMax=parseInt(a.trans2.frameBurstMax),a.trans1.frameBurstTime=parseInt(a.trans1.frameBurstTime),a.trans2.frameBurstTime=parseInt(a.trans2.frameBurstTime),a.trans1.power=parseInt(a.trans1.power),a.trans2.power=parseInt(a.trans2.power),a.trans1.$update({id:0},function(){a.trans2.$update({id:1},function(){a.saveSettings()})}))})}}]).controller("WirelessWmmCtrl",["$scope","$route","$routeParams",
"$location","WirelessWmm","securityTips",function(a,b,c,d,e,f){a.tab=b.current.tab;a.section=b.current.section;a.wirelessName=0==c.id?"2.4 GHz":"5 GHz";a.qos=e.get({id:c.id});a.enabledClick=function(){a.qos.enabled||(a.qos.powerSave=!1)};a.save=function(){a.showNotifyRestartMsgPopup()};a.saveNow=function(){a.qos.$update({id:c.id},function(){location.reload()})};a.showNotifyRestartMsgPopup=function(){f.showNotifyRestartMsg("Warning",[""]).then(function(b){"cancel"!=b&&void 0!=b&&a.saveNow()})};a.keyPress=
function(b){13==b.keyCode&&d.path()=="/wireless/wmm/"+c.id&&a.save()}}]).controller("WirelessWEPCtrl",["$scope","$route","$routeParams","$location","WEP","securityTips","WPS","Wireless",function(a,b,c,d,e,f,g,h){a.tab=b.current.tab;a.section=b.current.section;a.showErrorPage=!1;a.errorMessages=[];var k=c.id;a.wirelessName=0==k?"2.4 GHz":"5 GHz";a.wep=e.get({id:k},function(){var b=g.get({id:0},function(){a.wpsIsEnabled=b.enabled;a.wirelessCmd=h.query(function(){a.wirelessACmd=a.wirelessCmd[0];a.wpsIsEnabled=
a.wpsIsEnabled?!0:!1;a.ipAddress=splitIpArr(a.wep.serverIp)})})});a.errorPageOk=function(){a.showErrorPage=!1;window.scrollTo(0,0)};a.wepChanged=function(b){b=a.wep.settings[b];var c=10,c=0==b.keyLength?0==b.entryMethod?10:5:0==b.entryMethod?26:13;b.key.length>c&&(b.key=b.key.substr(0,c))};a.wirelessUpdate=function(b){e.update({id:k},{activeSetting:a.wep.activeSetting,mode:a.wep.mode,authenticationType:a.wep.authenticationType,settings:a.wep.settings},function(){1==b?h.update({id:0},{mode:4},function(){d.path("/wireless/advanced")}):
d.path("/wireless/advanced")})};a.checkWEP=function(){a.wirelessACmd.radioEnabled&&a.wpsIsEnabled&&4==a.wirelessACmd.mode?a.enableWEP():a.wirelessACmd.radioEnabled&&(a.wpsIsEnabled||1==a.wirelessACmd.mode||8==a.wirelessACmd.mode)?a.enableWEP1():a.showNotifyRestartMsgPopup(0)};a.enableWEP=function(){f.showCustomMessage("Warning",["If WEP is enabled for the 2.4 GHz wireless network, then WPS will be disabled for the 2.4 GHz wireless network.","Are you sure you want to enable WEP?"]).then(function(b){"ok"==
b&&a.showNotifyRestartMsgPopup(0)})};a.enableWEP1=function(){f.showCustomMessage1("Warning",["Turning on WEP will change your 2.4 GHz wireless mode to Legacy Mode (802.11b/g) and disable Wi-Fi Protected Setup.","Press OK to continue or Cancel."]).then(function(b){"ok"==b&&a.showNotifyRestartMsgPopup(1)})};a.save=function(){a.errorMessages=[];a.wep.authenticationType=parseInt(a.wep.authenticationType);for(var b=0;b<a.wep.settings.length;b++)a.wep.settings[b].entryMethod=parseInt(a.wep.settings[b].entryMethod),
a.wep.settings[b].keyLength=parseInt(a.wep.settings[b].keyLength),validateWepSettings(a.wep.settings[b],b==a.wep.activeSetting,"Key #"+(b+1),a.errorMessages);0<a.errorMessages.length?(a.showErrorPage=!0,window.scrollTo(0,0)):a.checkWEP()};a.showNotifyRestartMsgPopup=function(b){f.showNotifyRestartMsg("Warning",[""]).then(function(c){"cancel"!=c&&void 0!=c&&a.wirelessUpdate(b)})}}]).controller("WirelessWPACtrl",["$scope","$route","$routeParams","$location","WPA","securityTips",function(a,b,c,d,e,f){a.tab=
b.current.tab;a.section=b.current.section;a.whichKey=1;a.keyType=0;a.errorMessages=[];a.showErrorPage=!1;var g=c.id;a.wirelessName=0==g?"2.4 GHz":"5 GHz";a.wpaType=0==b.current.wpa?"WPA2/WPA mixed mode":"WPA2";a.wpa=e.get({id:g},function(){a.wpa.key=a.wpa.key;a.wpa.type=b.current.wpa});a.errorPageOk=function(){a.showErrorPage=!1;window.scrollTo(0,0)};a.validateWpaKey=function(b){8>b.length?a.errorMessages.push("Pre-Shared Key: Pass-Phrase has to be at least 8 characters long."):/^[\x21-\x7E]+$/i.test(b)||
a.errorMessages.push("Pre-Shared Key: Invalid Key. Only ASCII characters are allowed.")};a.save=function(){a.errorMessages=[];a.wpa.groupKeyUpdateIntervalEnabled&&(isNaN(a.wpa.groupKeyUpdateInterval)||900>a.wpa.groupKeyUpdateInterval||86400<a.wpa.groupKeyUpdateInterval||!checksForDecimalNumber(a.wpa.groupKeyUpdateInterval))&&a.errorMessages.push("Group Key Update Interval: Please enter a numeric value between 900 and 86400.");a.validateWpaKey(a.wpa.key);0!=a.errorMessages.length?(a.showErrorPage=
!0,window.scrollTo(0,0)):a.showNotifyRestartMsgPopup()};a.showNotifyRestartMsgPopup=function(){f.showNotifyRestartMsg("Warning",[""]).then(function(b){"cancel"!=b&&void 0!=b&&a.saveData()})};a.saveData=function(){a.wpa.groupKeyUpdateIntervalEnabled||(a.wpa.groupKeyUpdateInterval=0);a.wpa.encryptionAlgorithm=parseInt(a.wpa.encryptionAlgorithm);e.update({id:g},{type:a.wpa.type,mode:a.wpa.mode,encryptionAlgorithm:a.wpa.encryptionAlgorithm,groupKeyUpdateInterval:a.wpa.groupKeyUpdateInterval,groupKeyUpdateIntervalEnabled:a.wpa.groupKeyUpdateIntervalEnabled,
key:a.wpa.key},function(){d.path("/wireless/advanced")})}}]).controller("WirelessMACFilterCtrl",["$scope","$route","$location","WirelessMACFilter","Wireless","securityTips","WPS",function(a,b,c,d,e,f,g){a.tab=b.current.tab;a.section=b.current.section;a.warningFlg=!1;a.newMac="";a.filter0=d.get({id:0});a.filter1=d.get({id:1});a.errorPageOk=function(){a.showErrorPage=!1;window.scrollTo(0,0)};a.checkFilters=function(b){for(var c=0;c<b.length;c++)if(17!=b[c].length||!validateMac(b[c])||/[0\:]{17}$/.test(b[c])||
/[f\:]{17}$/i.test(b[c])||parseInt(b[c].split(":")[0],16)&1){a.errorMessages.push("Invalid MAC Address format: Please try again.");break}};a.save=function(){a.errorMessages=[];a.checkFilters(a.filter0.macs);0==a.errorMessages.length&&a.checkFilters(a.filter1.macs);0<a.errorMessages.length?(a.showErrorPage=!0,window.scrollTo(0,0)):(a.filter0.mode=parseInt(a.filter0.mode),a.filter1.mode=parseInt(a.filter1.mode),a.filter0.$update({id:0},function(){a.filter1.$update({id:1},function(){c.path("/wireless/advanced")})}))};
a.chkBeforeSaveNow=function(){f.showNotifyRestartMsg("Warning",[""]).then(function(b){"cancel"!=b&&void 0!=b&&a.save()})};a.chkBeforeSave=function(){var b=!0,c=e.query(function(){var d=g.get({id:0},function(){a.wpsEnabled=d.enabled;b=!0;a.wire0=c[0].radioEnabled;a.wire1=c[1].radioEnabled;var e=c[0].wpsEnabled,g=c[1].wpsEnabled;a.wire0||a.wire1||(b=!1);e||g||(b=!1);a.wpsEnabled&&!b&&(a.wpsEnabled=!1);var g=e=!1,n="",v="";a.filter0.enabled&&0==a.filter0.mode&&0==a.filter0.macs.length&&(e=!0);a.filter1.enabled&&
0==a.filter1.mode&&0==a.filter1.macs.length&&(g=!0);a.warningFlg=a.wpsEnabled?e||g?!0:!1:!1;a.warningFlg?(e&&g?(n="2.4 GHz and 5.0 GHz",v="networks"):g?(n="5.0 GHz",v="network"):e&&(n="2.4 GHz",v="network"),f.showCustomMessage1("Warning",["If Access List (MAC address filter) is enabled with no accepted devices (an empty white list) for the "+n+" wireless "+v+", then WPS will be disabled for the "+n+" wireless "+v+".","Are you sure you want to enable Access List with no accepted devices?","Press OK to continue or Cancel."]).then(function(b){"cancel"!=
b&&void 0!=b&&a.check5GHZList()})):a.check5GHZList()})})};a.check5GHZList=function(){a.filter1.enabled?f.showAutoConnectMsgAuth("","").then(function(b){"cancel"!=b&&a.chkBeforeSaveNow()}):a.chkBeforeSaveNow()};a.removeMac=function(b,c){0==b?a.filter0.macs.splice(c,1):a.filter1.macs.splice(c,1)};a.addFilter=function(b){a.errorMessages=[];if(0==b)if(angular.isUndefined(a.newMac0))a.errorMessages.push("MAC Address: MAC address must consist of 6 fields. Each field's value must be between 00 and FF (in hexadecimal representation), without any spaces. The LSB of the first byte must be zero.");
else if(0!=a.errorMessages.length||validateMac(a.newMac0)&&notAcceptedMac(a.newMac0)&&/^([0-9A-Fa-f]{2}[:]){5}([0-9A-Fa-f]{2})$/.test(a.newMac0)){for(b=0;b<a.filter0.macs.length;b++)if(a.newMac0==a.filter0.macs[b]){a.errorMessages.push("This client MAC address is already included in the MAC address authentication list.");a.showErrorPage=!0;window.scrollTo(0,0);return}if(60==a.filter0.macs.length){a.errorMessages.push("You are limited to 60 devices with specified MAC addresses per Wi-Fi radio (2.4 & 5 GHz individually) that can be connected via MAC Authentication. If you want to add another it will be necessary to remove one of the existing MAC addresses.");
a.showErrorPage=!0;window.scrollTo(0,0);return}a.filter0.macs.push(a.newMac0);a.newMac0=""}else a.errorMessages.push("MAC Address: MAC address must consist of 6 fields. Each field's value must be between 00 and FF (in hexadecimal representation), without any spaces. The LSB of the first byte must be zero.");else if(angular.isUndefined(a.newMac1))a.errorMessages.push("MAC Address: MAC address must consist of 6 fields. Each field's value must be between 00 and FF (in hexadecimal representation), without any spaces. The LSB of the first byte must be zero.");
else if(0!=a.errorMessages.length||validateMac(a.newMac1)&&notAcceptedMac(a.newMac1)&&/^([0-9A-Fa-f]{2}[:]){5}([0-9A-Fa-f]{2})$/.test(a.newMac1)){for(b=0;b<a.filter1.macs.length;b++)if(a.newMac1==a.filter1.macs[b]){a.errorMessages.push("This client MAC address is already included in the MAC address authentication list.");a.showErrorPage=!0;window.scrollTo(0,0);return}if(60==a.filter1.macs.length){a.errorMessages.push("You are limited to 60 devices with specified MAC addresses per Wi-Fi radio (2.4 & 5 GHz individually) that can be connected via MAC Authentication. If you want to add another it will be necessary to remove one of the existing MAC addresses.");
a.showErrorPage=!0;window.scrollTo(0,0);return}a.filter1.macs.push(a.newMac1);a.newMac1=""}else a.errorMessages.push("MAC Address: MAC address must consist of 6 fields. Each field's value must be between 00 and FF (in hexadecimal representation), without any spaces. The LSB of the first byte must be zero.");0<a.errorMessages.length&&(a.showErrorPage=!0,window.scrollTo(0,0))}}]).controller("WifiSetupCtrl",["$scope","$route","$location","WPS","Devices","Wireless","securityTips","WirelessMACFilter",
function(a,b,c,d,e,f,g,h){a.tab=b.current.tab;a.section=b.current.section;a.valid=!0;a.apLockDown=!1;a.erEnabled=!1;a.apPin="";a.erCanEnabled=!0;a.onlyNumbers=/^\d+$/;a.wirelessWpsAreOn=!0;a.hasSavePopup=!1;a.$on("$destroy",function(){a.valid=!1});var k=0;a.refresh=function(){var b=d.get({id:0},function(){var c=f.query(function(){a.filter0=h.get({id:0},function(){a.filter1=h.get({id:1},function(){a.wirelessWpsAreOn=!0;a.wire0=c[0].radioEnabled;a.wire1=c[1].radioEnabled;var d=c[0].wpsEnabled,e=c[1].wpsEnabled;
a.wire0||a.wire1||(a.wirelessWpsAreOn=!1);d||e||(a.wirelessWpsAreOn=!1);if(!0==b.apLockDown||!1==b.apLockDown)a.apLockDown=b.apLockDown;if(!0==b.erEnabled||!1==b.erEnabled)a.erEnabled=b.erEnabled;if(b.apPin)for(a.apPin=b.apPin;8>String(a.apPin).length;)a.apPin="0"+String(a.apPin);""!=a.apPin&&(a.erCanEnabled=!1);a.enabled=b.enabled;a.enabled&&!a.wirelessWpsAreOn&&(a.enabled=!1);a.trigger=b.trigger;d=!1;!0==a.isCancelled&&(b.status=0,a.timeString="",a.isCancelled=!1);if(0==a.currentStep)0!=b.status&&
(a.currentStep=1,k=(new Date).getTime(),a.timeString="2 minutes",d=!0);else if(3==a.currentStep)3==b.lastStatus?a.currentStep=5:4==b.lastStatus?(a.mac=b.device,a.currentStep=4):0==b.status&&1==b.lastStatus?a.currentStep=0:d=!0;else if(1==a.currentStep||2==a.currentStep){2==b.status?(a.currentStep=3,d=!0):3==b.lastStatus?a.currentStep=5:4==b.lastStatus?(a.mac=b.device,a.currentStep=4):0==b.status&&1==b.lastStatus?a.currentStep=0:d=!0;if(!d)return;e=120-Math.floor(((new Date).getTime()-k)/1E3);if(0>=
e){a.currentStep=5;return}d=Math.floor(e/60);e%=60;a.timeString="";0<d&&(a.timeString=d+" minute"+(1<d?"s":"")+(0<e?", ":""));0<e&&(a.timeString+=e+" second"+(1<e?"s":""));d=!0}d&&a.valid&&window.setTimeout(a.refresh,1E3);a.hasSavePopup&&(a.savePopup.close(),a.hasSavePopup=!1)})})})})};a.refresh();a.currentStep=0;a.clientWpsPin="";a.toggleOnOffSave=function(){d.update({id:0},{enabled:!a.enabled},function(){a.savePopup=g.showSaving1("Apply Settings","Applying your settings. Please wait...");a.hasSavePopup=
!0;a.currentStep=0;window.setTimeout(a.toggleOnOffSaveRefresh,3E3)})};a.toggleOnOffSaveRefresh=function(){a.refresh()};a.toggleOnOff=function(){a.enabled?a.toggleOnOffSave():a.wire0||a.wire1?a.wirelessWpsAreOn?a.toggleOnOffSave():g.showCustomMessage3("Warning",["Wi-Fi Protected Setup (WPS) cannot be used if WEP security is enabled or SSID broadcast is disabled or if MAC address authentication is enabled with an empty white list.","To use WPS, change your wireless security mode and/or enable SSID broadcast and/or add a MAC address to the mac authentication table."]):
g.showCustomMessage3("Warning",["Wi-Fi Protected Setup (WPS) is disabled because both Wi-Fi radios(2.4 GHz and 5 GHz) have been turned off.","Please enable Wi-Fi on one or both radios to enable WPS."])};a.pushButtonConfig=function(){d.update({id:0},{trigger:!a.trigger},function(){k=(new Date).getTime();a.currentStep=1;window.setTimeout(a.testConnection,3E3)})};a.testConnection=function(){a.refresh()};a.errorPageOk=function(){a.showErrorPage=!1;window.scrollTo(0,0)};a.register=function(){a.errorMessages=
[];var b=!1;-1==String(a.clientWpsPin).indexOf("-")&&-1==String(a.clientWpsPin).indexOf(" ")?/^[0-9]{8}$/.test(a.clientWpsPin)||/^[0-9]{4}$/.test(a.clientWpsPin)||(b=!0):/^[0-9- ]{9}$/.test(a.clientWpsPin)||/^[0-9- ]{5}$/.test(a.clientWpsPin)||(b=!0);b&&a.errorMessages.push("Error: Invalid PIN. Please enter a valid WPS PIN, which consists of either four or eight numeric digits, and can typically be found printed on your wireless client device or in its documentation.");if(0<a.errorMessages.length)a.showErrorPage=
!0,window.scrollTo(0,0);else if(""==a.clientWpsPin)a.pushButtonConfig();else var b=a.clientWpsPin.replace(/ /g,"").replace(/-/g,""),c=d.update({id:0},{pin:b},function(){"00000000"==c.pin?(a.errorMessages.push("Error: Invalid PIN. Please enter a valid WPS PIN, which consists of either four or eight numeric digits, and can typically be found printed on your wireless client device or in its documentation."),0<a.errorMessages.length&&(a.showErrorPage=!0,window.scrollTo(0,0))):(k=(new Date).getTime(),
a.currentStep=2,window.setTimeout(a.testConnection,3E3))})};a.cancel=function(){d.update({id:0},{trigger:!a.trigger},function(){a.currentStep=0;a.isCancelled=!0;k=0})};a.connect=function(){a.currentStep=4};a.completed=function(){a.currentStep=0;a.clientWpsPin=""};a.sendErEnabled=function(b){d.update({id:0},{erEnabled:b},function(){a.refresh()})}}]).controller("GuestWifiSetupTabCtrl",["$scope","$route","$location","Wireless",function(a,b,c,d){a.tab=b.current.tab;a.pageToShow=0;a.currentTab=-1;a.bothDisabled=
!1;a.basicGuestWifiEnabled=!1;a.guestPassWifiEnabled=!1;a.guestWifiEnum={BASIC_GUEST_WIFI:2};a.tabsEnum={1:"partials/wireless/guestDevicesTab.html?v=v1.0.184",2:"partials/wireless/basicGuestWifiTab.html?v=v1.0.184"};a.section=b.current.section;b=c.path();-1!=b.indexOf("/wireless/guestWifiSetup/devices")?a.currentTab=1:-1!=b.indexOf("/wireless/guestWifiSetup/basic")?a.currentTab=2:a.wireless1=d.query(function(){a.wirelessA1=a.wireless1[0];a.basicGuestWifi1=a.wireless1[a.guestWifiEnum.BASIC_GUEST_WIFI];
c.url("/wireless/guestWifiSetup/basic")});a.mainRefresh=function(){a.basicGuestWifiEnabled=!1;a.bothDisabled=!1;a.wireless=d.query(function(){a.wirelessA=a.wireless[0];a.basicGuestWifi=a.wireless[a.guestWifiEnum.BASIC_GUEST_WIFI];void 0!=a.basicGuestWifi&&null!=a.basicGuestWifi&&(a.basicGuestWifi.enabled&&a.wirelessA.radioEnabled?(a.basicGuestWifiEnabled=!0,a.bothDisabled=!1):a.bothDisabled=!0)});a.togglePage(0)};a.togglePage=function(b){a.pageToShow=b;window.scrollTo(0,0)};a.mainRefresh();a.isActive=
function(b){return a.currentTab===b};a.setActive=function(a){switch(a){case 1:c.url("/wireless/guestWifiSetup/devices");break;case 2:c.url("/wireless/guestWifiSetup/basic");break;default:c.url("/wireless/guestWifiSetup/basic")}};a.getActive=function(){return a.currentTab}}]).controller("GuestWifiSetupCtrl",["$scope","$route","$location","Wireless","GuestDevices","GuestPassDevices","Devices","$rootScope","securityTips",function(a,b,c,d,e,f,g,h,k){a.tab=b.current.tab;a.bothDisable=!1;a.pageToShow=0;
a.tab=b.current.tab;a.section=b.current.section;a.tempDevices=null;a.refresh=function(){a.guestDevices=null;a.wireless=d.query(function(){a.basicGuestWifi=a.wireless[a.guestWifiEnum.BASIC_GUEST_WIFI];a.basicGuestWifi.enabled?a.guestDevices=g.query(function(){for(var b=0;b<a.guestDevices.length;b++)a.guestDevices[b].toDisplay=!1,6==a.guestDevices[b].connectionType&&(a.basicGuestWifi.enabled&&(a.guestDevices[b].ssid=a.basicGuestWifi.ssid),a.guestDevices[b].toDisplay=!0,setDeviceStyle(a.guestDevices[b],
""))}):a.bothDisable=!0});a.togglePage(0)};a.togglePage=function(b){a.pageToShow=b;window.scrollTo(0,0)};a.refresh();a.toggleOnOffSave=function(b){a.tempDevices=b;a.toggleOnOffSaveNow(a.tempDevices)};a.toggleOnOffSaveMsg=function(){k.showNotifyRestartMsg("Warning",[""]).then(function(b){"cancel"!=b&&void 0!=b&&a.toggleOnOffSaveNow(a.tempDevices)})};a.toggleOnOffSaveNow=function(b){b.blocked=!b.blocked;g.update({id:b.id},b,function(){a.refresh()})}}]).controller("BasicGuestCtrl",["$scope","$route",
"$location","Wireless","GuestDevices","WPA","securityTips","$sce","$rootScope","Devices",function(a,b,c,d,e,f,g,h,k,l){a.tab=b.current.tab;a.warningFlag=!1;a.pageToShow=0;a.tab=b.current.tab;a.section=b.current.section;a.keySet=!1;a.showPassword=!0;k.editingGuest=!1;k.guestHasChanges=!1;a.countDownPopup=null;a.fakeTimer=!1;a.openGuestWifiNoPasswordChk=!1;a.tempWpaShowKeyInUI=!1;a.listener=null;a.tempWPAkey="";a.togglePage=function(b){a.pageToShow=b;window.scrollTo(0,0)};a.refresh=function(){a.showPassword=
!0;a.wireless=d.query(function(){a.wirelessA=a.wireless[0];a.wirelessB=a.wireless[1];a.basicGuestWifi=a.wireless[a.guestWifiEnum.BASIC_GUEST_WIFI];a.basicGuestWifi.ssid=a.basicGuestWifi.ssid;a.tempWPAkey="";void 0!=a.basicGuestWifi&&null!=a.basicGuestWifi&&(a.guestDevices=l.query(function(){a.guestDevices=filterOutNonGuest(a.guestDevices)}),a.wpa=f.get({id:a.guestWifiEnum.BASIC_GUEST_WIFI},function(){void 0!=a.wpa.key&&(a.wpa.key=a.wpa.key,a.tempWPAkey=h.trustAsHtml(a.convertKey(a.wpa.key)),a.keySet=
""!==a.wpa.key?!0:!1);a.openGuestWifiNoPasswordChk=a.wpa.noPassword}));a.warningFlag=void 0==a.basicGuestWifi||null==a.basicGuestWifi||a.basicGuestWifi.enabled?!1:!0});a.mainRefresh();a.togglePage(0)};a.convertKey=function(a){var b="";if(a)for(var c=0;c<a.length;c++)b+="&bull;";return b=unescape(b)};a.refresh();a.toggleOnOffSave=function(){a.wirelessA.radioEnabled?a.basicGuestWifi.enabled?a.showAutoConnectMsg(1,""):a.openGuestWifiNoPasswordChk?a.showAutoConnectMsg(0,""):a.keySet?a.showAutoConnectMsg(0,
""):a.showAutoConnectMsg(2,""):g.showWirelease24GPrompt("","").then(function(a){})};a.showAutoConnectMsg=function(b,c){g.showAutoConnectMsgGuest("","").then(function(c){"cancel"==c?a.refresh():0==b?a.saveSettings(!0):1==b?(a.basicGuestWifi.enabled=!1,a.saveToggle(!0)):2==b&&a.showKeyForm()})};a.saveSettings=function(b){a.basicGuestWifi.enabled=!0;a.saveToggle(b)};a.saveToggle=function(b){a.basicGuestWifi.radioFreq=a.wirelessA.radioEnabled?1:-1;clearTimeout(a.fakeTimer);a.countDownPopup=g.showSavingNow("Save Settings",
"Saving your settings. Please wait...");a.countDownPopup.open();a.fakeTimer=window.setTimeout(a.closeCountDownPopup1,2E4);!1==b&&(a.basicGuestWifi.security.wpa.wpaShowKeyInUI=a.tempWpaShowKeyInUI);a.basicGuestWifi.security.wpa.noPassword=a.openGuestWifiNoPasswordChk;d.update({id:a.guestWifiEnum.BASIC_GUEST_WIFI},a.basicGuestWifi,function(){b?a.refresh():a.saveWifiKey()})};a.showKeyForm=function(){g.showCreateGuestWifiPassword("Create Password","Please create a password to activate your Guest Wi-Fi.",
a.wpa).then(function(b){if("cancel"==b.result||void 0==b.result)a.refresh();else{var c=!1;if(b.noPassword)a.wpa.key="",c=!1;else if(void 0==b.returnObj)c=!0;else if(a.wpa.key=b.returnObj,8>a.wpa.key.length||63<a.wpa.key.length||!/^[\x20-\x7E]+$/i.test(a.wpa.key))c=!0;c?a.openValidationPopup():a.showNotifyRestartMsg1Popup(b)}})};a.openValidationPopup=function(){g.showWarningMsgGuestWifi("","Password has to be at least 8 characters long",!1,[""]).then(function(b){"ok"==b&&a.showKeyForm()})};a.openValidationPopup1=
function(){g.showWarningMsgGuestWifi("","Password has to be at least 8 characters long",!1,[""]).then(function(a){})};a.openValidationPopup2=function(){g.showWarningMsgGuestWifi("","SSID must be 1 to 32 characters",!1,[""]).then(function(a){})};a.openValidationPopup3=function(){g.showWarningMsgGuestWifi2("","SSID must be 1 to 32 characters",!1,[""]).then(function(a){})};a.saveWifiKey=function(){a.wpa.encryptionAlgorithm=parseInt(a.wpa.encryptionAlgorithm);f.update({id:a.guestWifiEnum.BASIC_GUEST_WIFI},
{type:a.wpa.type,mode:a.wpa.mode,encryptionAlgorithm:a.wpa.encryptionAlgorithm,groupKeyUpdateInterval:a.wpa.groupKeyUpdateInterval,groupKeyUpdateIntervalEnabled:a.wpa.groupKeyUpdateIntervalEnabled,key:a.wpa.key,noPassword:a.openGuestWifiNoPasswordChk},function(){})};a.editWifiSettings=function(){k.editingGuest=!0;k.guestHasChanges=!1};a.saveWifiCredentials=function(){a.basicGuestWifi.ssid=a.basicGuestWifi.ssid;clearTimeout(a.fakeTimer);a.countDownPopup=g.showSavingNow("Save Settings","Saving your settings. Please wait...");
a.countDownPopup.open();a.fakeTimer=window.setTimeout(a.closeCountDownPopup,2E4);d.update({id:a.guestWifiEnum.BASIC_GUEST_WIFI},a.basicGuestWifi,function(){f.update({id:a.guestWifiEnum.BASIC_GUEST_WIFI},{wpaShowKeyInUI:a.wpa.wpaShowKeyInUI},function(){a.saveWifiKey();a.guestWiFiKeyCopy=""})})};a.applyGuestEnabledWifiChanges=function(){g.showNotifyRestartMsg1("","").then(function(b){"cancel"!=b&&(a.openGuestWifiNoPasswordChk&&(a.wpa.key=""),a.saveWifiCredentials())})};a.applyGuestWifiChanges=function(){g.showGuestWifiSaveWarning("",
"").then(function(b){"cancel"!=b&&("okandenablewifi"==b?(a.tempWpaShowKeyInUI=a.wpa.wpaShowKeyInUI,a.openGuestWifiNoPasswordChk&&(a.wpa.key=""),a.saveSettings(!1)):(a.tempWpaShowKeyInUI=a.wpa.wpaShowKeyInUI,a.basicGuestWifi.security.wpa.wpaShowKeyInUI=a.wpa.wpaShowKeyInUI,a.openGuestWifiNoPasswordChk&&(a.wpa.key=""),a.saveWifiCredentials()))})};a.saveWifiSettings=function(){var b=!1,c=!1;if("undefined"===typeof a.wpa.key||""===a.wpa.key)b=!0;else if(8>a.wpa.key.length||63<a.wpa.key.length||!/^[\x20-\x7E]+$/i.test(a.wpa.key))b=
!0;if(1>a.basicGuestWifi.ssid.length||32<a.basicGuestWifi.ssid.length||!/^[0-9a-zA-Z\!\"\#\$\%\&\u2019\'\(\)\*\+\,\-\.\/\:\;\<\=\>\?\@\[\\\]\^\_\`\{\|\}\~\ ]+$/i.test(a.basicGuestWifi.ssid))c=!0;c&&b&&!a.openGuestWifiNoPasswordChk?(a.cancelRedirect(),a.openValidationPopup3()):c&&!a.openGuestWifiNoPasswordChk?(a.cancelRedirect(),a.openValidationPopup2()):b&&!a.openGuestWifiNoPasswordChk?(a.cancelRedirect(),a.openValidationPopup1()):a.basicGuestWifi.enabled?a.applyGuestEnabledWifiChanges():a.applyGuestWifiChanges()};
a.closeCountDownPopup1=function(){a.countDownPopup.close();a.countDownPopup=null;a.basicGuestWifi.ssid="";a.refresh();k.editingGuest=!1};a.closeCountDownPopup=function(){a.countDownPopup.close();a.countDownPopup=null;k.locationChangeActivate?a.redirect():(a.basicGuestWifi.ssid="",a.refresh(),k.editingGuest=!1)};a.cancel=function(){a.refresh();k.editingGuest=!1;k.guestHasChanges=!1};a.change=function(){k.guestHasChanges=!0};a.chkOpenGuestWifi=function(){a.openGuestWifiNoPasswordChk?(a.guestWiFiKeyCopy=
a.wpa.key,a.wpa.key="",g.showSetupHelpGuestWifiOpen("","",!0,[""])):a.wpa.key=a.guestWiFiKeyCopy};a.saveContents1Function=function(b){a.saveWifiSettings()};a.listener=k.$on("saveContents1",a.saveContents1Function);a.$on("$destroy",function(){a.listener()});a.redirect=function(){k.locationChangeActivate=!1;k.editingGuest=!1;k.guestHasChanges=!1;""==getNextLocationForLocationChangeSub(k.locationChangeNext)?c.path(getNextLocationForLocationChange(k.locationChangeNext)):c.path(getNextLocationForLocationChange(k.locationChangeNext)).search(getNextLocationForLocationChangeSub(k.locationChangeNext))};
a.toggleShowPassword=function(){f.update({id:a.guestWifiEnum.BASIC_GUEST_WIFI},{wpaShowKeyInUI:a.wpa.wpaShowKeyInUI},function(){})};a.cancelRedirect=function(){k.locationChangeActivate=!1};a.showNotifyRestartMsgPopup=function(){g.showNotifyRestartMsg1("Warning",[""]).then(function(b){"cancel"!=b&&void 0!=b&&(a.basicGuestWifi.ssid=a.basicGuestWifi.ssid,clearTimeout(a.fakeTimer),a.countDownPopup=g.showSavingNow("Save Settings","Saving your settings. Please wait..."),a.countDownPopup.open(),a.fakeTimer=
window.setTimeout(a.closeCountDownPopup,2E4),d.update({id:a.guestWifiEnum.BASIC_GUEST_WIFI},a.basicGuestWifi,function(){f.update({id:a.guestWifiEnum.BASIC_GUEST_WIFI},{wpaShowKeyInUI:a.wpa.wpaShowKeyInUI},function(){a.saveWifiKey()})}))})};a.showNotifyRestartMsg1Popup=function(b){g.showNotifyRestartMsg1("Warning",[""]).then(function(c){"cancel"!=c&&void 0!=c&&(a.tempWpaShowKeyInUI=b.wpaShowKeyInUI,a.openGuestWifiNoPasswordChk=b.noPassword,f.update({id:a.guestWifiEnum.BASIC_GUEST_WIFI},{wpaShowKeyInUI:b.wpaShowKeyInUI},
function(){a.saveSettings(!1)}))})}}]).controller("BasicGuestCtrlPopup",["$scope","WPA","model","dialog",function(a,b,c,d){a.key=c.key;a.wpaPopup=c.wpa;a.wpaPopup.openGuestWifi=!1;a.buttons=c.buttons;a.title=c.title;a.message=c.message;a.close=function(b){d.close({result:b,returnObj:a.key,wpaShowKeyInUI:a.wpaPopup.wpaShowKeyInUI,noPassword:a.wpaPopup.openGuestWifi})}}]).controller("GuestPassWifiCtrl",["$scope","$route","$location","Wireless","GuestPassDevices","securityTips","Devices","$rootScope",
function(a,b,c,d,e,f,g,h){a.tab=b.current.tab;a.warningFlag=!1;a.pageToShow=0;a.tab=b.current.tab;a.section=b.current.section;h.editingGuest=!1;h.guestHasChanges=!1;a.listener=null;a.countDownPopup=null;a.fakeTimer=null;a.togglePage=function(b){a.pageToShow=b;window.scrollTo(0,0)};a.refresh=function(){a.wireless=d.query(function(){a.wirelessA=a.wireless[0];a.wirelessB=a.wireless[1];a.basicGuestWifi=a.wireless[a.guestWifiEnum.BASIC_GUEST_WIFI];a.guestPassWifi=a.wireless[a.guestWifiEnum.GUEST_PASS];
a.guestPassWifi.ssid=a.guestPassWifi.ssid;void 0!=a.guestPassWifi&&null!=a.guestPassWifi&&(a.guestDevices=g.query(function(){a.guestDevices=filterOutNonGuest(a.guestDevices)}));a.warningFlag=void 0!=a.guestPassWifi&&null!=a.guestPassWifi&&!a.guestPassWifi.enabled&&void 0!=a.basicGuestWifi&&null!=a.basicGuestWifi&&a.basicGuestWifi.enabled?!0:!1});a.mainRefresh();a.togglePage(0)};a.refresh();a.toggleOnOffSave=function(){a.wirelessA.radioEnabled?a.guestPassWifi.enabled?(a.guestPassWifi.enabled=!1,a.saveToggle()):
a.basicGuestWifi.enabled?f.showWarningMsgGuestWifi3("","This will disable Basic Guest Wi-Fi and open your Wi-Fi to an unsecure security model.",!0,[""]).then(function(b){"cancel"!=b&&void 0!=b&&(a.guestPassWifi.enabled=!0,a.basicGuestWifi.enabled=!1,a.saveToggle())}):(a.guestPassWifi.enabled=!0,a.saveToggle()):f.showWirelease24GPrompt("","").then(function(a){})};a.saveToggle=function(){a.basicGuestWifi.radioFreq=a.wirelessA.radioEnabled?1:-1;a.guestPassWifi.radioFreq=a.wirelessA.radioEnabled?1:-1;
a.guestPassWifi.ssid=a.guestPassWifi.ssid;clearTimeout(a.fakeTimer);a.countDownPopup=f.showSavingNow("Save Settings","Saving your settings. Please wait...");a.countDownPopup.open();a.fakeTimer=window.setTimeout(a.closeCountDownPopup,2E4);d.update({id:a.guestWifiEnum.GUEST_PASS},a.guestPassWifi,function(){})};a.closeCountDownPopup=function(){a.countDownPopup.close();a.countDownPopup=null;h.locationChangeActivate?a.redirect():(a.guestPassWifi.ssid="",a.refresh(),h.editingGuest=!1)};a.editWifiSettings=
function(){h.editingGuest=!0;h.guestHasChanges=!1};a.openValidationPopup2=function(){f.showWarningMsgGuestWifi("","SSID must be 1 to 32 characters",!1,[""]).then(function(a){})};a.saveWifiSettings=function(){var b=!1;if(1>a.guestPassWifi.ssid.length||32<a.guestPassWifi.ssid.length||!/^[0-9a-zA-Z\!\"\#\$\%\&\u2019\'\(\)\*\+\,\-\.\/\:\;\<\=\>\?\@\[\\\]\^\_\`\{\|\}\~\ ]+$/i.test(a.guestPassWifi.ssid))b=!0;b?(a.cancelRedirect(),a.openValidationPopup2()):a.saveToggle()};a.cancel=function(){a.refresh();
h.editingGuest=!1;h.guestHasChanges=!1};a.change=function(){h.guestHasChanges=!0};a.saveContents2Function=function(b){a.saveWifiSettings()};a.listener=h.$on("saveContents2",a.saveContents2Function);a.$on("$destroy",function(){a.listener()});a.redirect=function(){h.locationChangeActivate=!1;h.editingGuest=!1;h.guestHasChanges=!1;""==getNextLocationForLocationChangeSub(h.locationChangeNext)?c.path(getNextLocationForLocationChange(h.locationChangeNext)):c.path(getNextLocationForLocationChange(h.locationChangeNext)).search(getNextLocationForLocationChangeSub(h.locationChangeNext))};
a.cancelRedirect=function(){h.locationChangeActivate=!1}}]);
